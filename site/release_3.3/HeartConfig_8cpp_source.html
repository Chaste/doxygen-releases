<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Chaste: heart/src/problem/HeartConfig.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.2 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_00fd64de1ddbc54ef2abd1d1cb971e60.html">heart</a>&nbsp;&raquo;&nbsp;<a class="el" href="dir_6c06f4963d9338dfda5a596973f9f14f.html">src</a>&nbsp;&raquo;&nbsp;<a class="el" href="dir_61ded7a83e2ebbbf2648cce602f62d52.html">problem</a>
  </div>
</div>
<div class="contents">
<h1>HeartConfig.cpp</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"></span>
<a name="l00003"></a>00003 <span class="comment">Copyright (c) 2005-2015, University of Oxford.</span>
<a name="l00004"></a>00004 <span class="comment">All rights reserved.</span>
<a name="l00005"></a>00005 <span class="comment"></span>
<a name="l00006"></a>00006 <span class="comment">University of Oxford means the Chancellor, Masters and Scholars of the</span>
<a name="l00007"></a>00007 <span class="comment">University of Oxford, having an administrative office at Wellington</span>
<a name="l00008"></a>00008 <span class="comment">Square, Oxford OX1 2JD, UK.</span>
<a name="l00009"></a>00009 <span class="comment"></span>
<a name="l00010"></a>00010 <span class="comment">This file is part of Chaste.</span>
<a name="l00011"></a>00011 <span class="comment"></span>
<a name="l00012"></a>00012 <span class="comment">Redistribution and use in source and binary forms, with or without</span>
<a name="l00013"></a>00013 <span class="comment">modification, are permitted provided that the following conditions are met:</span>
<a name="l00014"></a>00014 <span class="comment"> * Redistributions of source code must retain the above copyright notice,</span>
<a name="l00015"></a>00015 <span class="comment">   this list of conditions and the following disclaimer.</span>
<a name="l00016"></a>00016 <span class="comment"> * Redistributions in binary form must reproduce the above copyright notice,</span>
<a name="l00017"></a>00017 <span class="comment">   this list of conditions and the following disclaimer in the documentation</span>
<a name="l00018"></a>00018 <span class="comment">   and/or other materials provided with the distribution.</span>
<a name="l00019"></a>00019 <span class="comment"> * Neither the name of the University of Oxford nor the names of its</span>
<a name="l00020"></a>00020 <span class="comment">   contributors may be used to endorse or promote products derived from this</span>
<a name="l00021"></a>00021 <span class="comment">   software without specific prior written permission.</span>
<a name="l00022"></a>00022 <span class="comment"></span>
<a name="l00023"></a>00023 <span class="comment">THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;</span>
<a name="l00024"></a>00024 <span class="comment">AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
<a name="l00025"></a>00025 <span class="comment">IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span>
<a name="l00026"></a>00026 <span class="comment">ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE</span>
<a name="l00027"></a>00027 <span class="comment">LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR</span>
<a name="l00028"></a>00028 <span class="comment">CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE</span>
<a name="l00029"></a>00029 <span class="comment">GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)</span>
<a name="l00030"></a>00030 <span class="comment">HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</span>
<a name="l00031"></a>00031 <span class="comment">LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT</span>
<a name="l00032"></a>00032 <span class="comment">OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00033"></a>00033 <span class="comment"></span>
<a name="l00034"></a>00034 <span class="comment">*/</span>
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="comment">// Work-around for newer Boost versions</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="CheckpointArchiveTypesIfNeeded_8hpp.html">CheckpointArchiveTypesIfNeeded.hpp</a>&quot;</span>
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="UblasCustomFunctions_8hpp.html">UblasCustomFunctions.hpp</a>&quot;</span>
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;HeartConfig.hpp&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;OutputFileHandler.hpp&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="Exception_8hpp.html">Exception.hpp</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;ChastePoint.hpp&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;Version.hpp&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;AbstractChasteRegion.hpp&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;HeartFileFinder.hpp&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;Warnings.hpp&quot;</span>
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;HeartRegionCodes.hpp&quot;</span>
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;SimpleStimulus.hpp&quot;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;RegularStimulus.hpp&quot;</span>
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 <span class="preprocessor">#include &lt;string&gt;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &lt;istream&gt;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &lt;fstream&gt;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &lt;cassert&gt;</span>
<a name="l00059"></a>00059 <span class="preprocessor">#include &lt;map&gt;</span>
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 <span class="preprocessor">#include &quot;XmlTools.hpp&quot;</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &lt;xsd/cxx/tree/exceptions.hxx&gt;</span>
<a name="l00063"></a>00063 <span class="keyword">using namespace </span>xsd::cxx::tree;
<a name="l00064"></a>00064 
<a name="l00065"></a>00065 <span class="comment">// Coping with changes to XSD interface</span>
<a name="l00066"></a>00066 <span class="preprocessor">#if (XSD_INT_VERSION &gt;= 3000000L)</span>
<a name="l00067"></a>00067 <span class="preprocessor"></span><span class="preprocessor">#define XSD_SEQUENCE_TYPE(base) base##_sequence</span>
<a name="l00068"></a>00068 <span class="preprocessor"></span><span class="preprocessor">#define XSD_ITERATOR_TYPE(base) base##_iterator</span>
<a name="l00069"></a>00069 <span class="preprocessor"></span><span class="preprocessor">#define XSD_NESTED_TYPE(t) t##_type</span>
<a name="l00070"></a>00070 <span class="preprocessor"></span><span class="preprocessor">#define XSD_ANON_TYPE(t1, t2) \</span>
<a name="l00071"></a>00071 <span class="preprocessor">    t1::t2##_type</span>
<a name="l00072"></a>00072 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00073"></a>00073 <span class="preprocessor"></span><span class="preprocessor">#define XSD_SEQUENCE_TYPE(base) base::container</span>
<a name="l00074"></a>00074 <span class="preprocessor"></span><span class="preprocessor">#define XSD_ITERATOR_TYPE(base) base::iterator</span>
<a name="l00075"></a>00075 <span class="preprocessor"></span><span class="preprocessor">#define XSD_NESTED_TYPE(t) t::type</span>
<a name="l00076"></a>00076 <span class="preprocessor"></span><span class="preprocessor">#define XSD_ANON_TYPE(t1, t2) \</span>
<a name="l00077"></a>00077 <span class="preprocessor">    t1::t2::_xsd_##t2##_::t2</span>
<a name="l00078"></a>00078 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00079"></a>00079 <span class="preprocessor"></span>
<a name="l00080"></a>00080 <span class="comment">// These are for convenience</span>
<a name="l00081"></a>00081 <span class="preprocessor">#define XSD_ANON_SEQUENCE_TYPE(t1, t2, t3) \</span>
<a name="l00082"></a>00082 <span class="preprocessor">    XSD_SEQUENCE_TYPE(XSD_ANON_TYPE(t1, t2)::t3)</span>
<a name="l00083"></a>00083 <span class="preprocessor"></span><span class="preprocessor">#define XSD_ANON_ITERATOR_TYPE(t1, t2, t3) \</span>
<a name="l00084"></a>00084 <span class="preprocessor">    XSD_ITERATOR_TYPE(XSD_ANON_TYPE(t1, t2)::t3)</span>
<a name="l00085"></a>00085 <span class="preprocessor"></span>
<a name="l00086"></a>00086 <span class="comment">// Newer versions don&#39;t allow you to set fixed attributes</span>
<a name="l00087"></a>00087 <span class="preprocessor">#if (XSD_INT_VERSION &gt;= 3020000L)</span>
<a name="l00088"></a>00088 <span class="preprocessor"></span><span class="preprocessor">#define XSD_CREATE_WITH_FIXED_ATTR(type, name, attr) \</span>
<a name="l00089"></a>00089 <span class="preprocessor">    type name</span>
<a name="l00090"></a>00090 <span class="preprocessor"></span><span class="preprocessor">#define XSD_CREATE_WITH_FIXED_ATTR1(type, name, arg1, attr) \</span>
<a name="l00091"></a>00091 <span class="preprocessor">    type name(arg1)</span>
<a name="l00092"></a>00092 <span class="preprocessor"></span><span class="preprocessor">#define XSD_CREATE_WITH_FIXED_ATTR2(type, name, arg1, arg2, attr) \</span>
<a name="l00093"></a>00093 <span class="preprocessor">    type name(arg1, arg2)</span>
<a name="l00094"></a>00094 <span class="preprocessor"></span><span class="preprocessor">#define XSD_CREATE_WITH_FIXED_ATTR3(type, name, arg1, arg2, arg3, attr) \</span>
<a name="l00095"></a>00095 <span class="preprocessor">    type name(arg1, arg2, arg3)</span>
<a name="l00096"></a>00096 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00097"></a>00097 <span class="preprocessor"></span><span class="preprocessor">#define XSD_CREATE_WITH_FIXED_ATTR(type, name, attr) \</span>
<a name="l00098"></a>00098 <span class="preprocessor">    type name(attr)</span>
<a name="l00099"></a>00099 <span class="preprocessor"></span><span class="preprocessor">#define XSD_CREATE_WITH_FIXED_ATTR1(type, name, arg1, attr) \</span>
<a name="l00100"></a>00100 <span class="preprocessor">    type name(arg1, attr)</span>
<a name="l00101"></a>00101 <span class="preprocessor"></span><span class="preprocessor">#define XSD_CREATE_WITH_FIXED_ATTR2(type, name, arg1, arg2, attr) \</span>
<a name="l00102"></a>00102 <span class="preprocessor">    type name(arg1, arg2, attr)</span>
<a name="l00103"></a>00103 <span class="preprocessor"></span><span class="preprocessor">#define XSD_CREATE_WITH_FIXED_ATTR3(type, name, arg1, arg2, arg3, attr) \</span>
<a name="l00104"></a>00104 <span class="preprocessor">    type name(arg1, arg2, arg3, attr)</span>
<a name="l00105"></a>00105 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00106"></a>00106 <span class="preprocessor"></span>
<a name="l00110"></a>00110 <span class="preprocessor">#define ENSURE_SECTION_PRESENT(location, type) \</span>
<a name="l00111"></a>00111 <span class="preprocessor">    if (!location.present())                   \</span>
<a name="l00112"></a>00112 <span class="preprocessor">    {                                          \</span>
<a name="l00113"></a>00113 <span class="preprocessor">        type empty_item;                       \</span>
<a name="l00114"></a>00114 <span class="preprocessor">        location.set(empty_item);              \</span>
<a name="l00115"></a>00115 <span class="preprocessor">    }</span>
<a name="l00116"></a>00116 <span class="preprocessor"></span>
<a name="l00117"></a>00117 <span class="preprocessor">#include &lt;boost/current_function.hpp&gt;</span>
<a name="l00125"></a>00125 <span class="preprocessor">#define CHECK_EXISTS(test, path)                                                         \</span>
<a name="l00126"></a>00126 <span class="preprocessor">    do {                                                                                 \</span>
<a name="l00127"></a>00127 <span class="preprocessor">        if (!test) {                                                                     \</span>
<a name="l00128"></a>00128 <span class="preprocessor">            EXCEPTION(&quot;No XML element &quot; &lt;&lt; path &lt;&lt; &quot; found in parameters when calling &#39;&quot; \</span>
<a name="l00129"></a>00129 <span class="preprocessor">                      &lt;&lt; BOOST_CURRENT_FUNCTION &lt;&lt; &quot;&#39;&quot;);                                 \</span>
<a name="l00130"></a>00130 <span class="preprocessor">    }} while (false)</span>
<a name="l00131"></a>00131 <span class="preprocessor"></span>
<a name="l00132"></a>00132 
<a name="l00137"></a><a class="code" href="classXmlTransforms.html">00137</a> <span class="keyword">class </span><a class="code" href="classXmlTransforms.html">XmlTransforms</a>
<a name="l00138"></a>00138 {
<a name="l00139"></a>00139 <span class="keyword">public</span>:
<a name="l00147"></a>00147     <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classXmlTransforms.html#a1e5bd50d05c32cf8257cacbb2b650bbd">TransformIonicModelDefinitions</a>(xercesc::DOMDocument* pDocument,
<a name="l00148"></a>00148                                                xercesc::DOMElement* pRootElement);
<a name="l00149"></a>00149 
<a name="l00158"></a>00158     <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classXmlTransforms.html#a0213cbf8bed42fa7e3236fdf4376bf64">TransformArchiveDirectory</a>(xercesc::DOMDocument* pDocument,
<a name="l00159"></a>00159                                           xercesc::DOMElement* pRootElement);
<a name="l00160"></a>00160 
<a name="l00168"></a>00168     <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classXmlTransforms.html#ab7c65c8fd2a2e9b07b70b7009df314ef">CheckForIluPreconditioner</a>(xercesc::DOMDocument* pDocument,
<a name="l00169"></a>00169                                           xercesc::DOMElement* pRootElement);
<a name="l00170"></a>00170 
<a name="l00178"></a>00178     <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classXmlTransforms.html#a66e900e4a1f476633d6abf749bad0987">MoveConductivityHeterogeneities</a>(xercesc::DOMDocument* pDocument,
<a name="l00179"></a>00179                                                 xercesc::DOMElement* pRootElement);
<a name="l00180"></a>00180 
<a name="l00188"></a>00188     <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classXmlTransforms.html#a62b290bd956d1c9e9d013358e7a9daa6">SetDefaultVisualizer</a>(xercesc::DOMDocument* pDocument,
<a name="l00189"></a>00189                                      xercesc::DOMElement* pRootElement);
<a name="l00190"></a>00190 };
<a name="l00191"></a>00191 
<a name="l00192"></a>00192 <span class="comment">//</span>
<a name="l00193"></a>00193 <span class="comment">// Default settings</span>
<a name="l00194"></a>00194 <span class="comment">//</span>
<a name="l00195"></a>00195 <span class="preprocessor">#include &quot;<a class="code" href="HeartConfigDefaults_8hpp.html">HeartConfigDefaults.hpp</a>&quot;</span>
<a name="l00196"></a>00196 
<a name="l00197"></a>00197 <span class="comment">//</span>
<a name="l00198"></a>00198 <span class="comment">// Definition of static member variables</span>
<a name="l00199"></a>00199 <span class="comment">//</span>
<a name="l00200"></a>00200 std::auto_ptr&lt;HeartConfig&gt; <a class="code" href="classHeartConfig.html#a1d700f703ffa3528790264535857411a">HeartConfig::mpInstance</a>;
<a name="l00201"></a>00201 
<a name="l00202"></a>00202 <span class="comment">//</span>
<a name="l00203"></a>00203 <span class="comment">// Methods</span>
<a name="l00204"></a>00204 <span class="comment">//</span>
<a name="l00205"></a>00205 
<a name="l00206"></a><a class="code" href="classHeartConfig.html#af8ab048189a76d46bbec0ff541449b89">00206</a> <a class="code" href="classHeartConfig.html">HeartConfig</a>* <a class="code" href="classHeartConfig.html#af8ab048189a76d46bbec0ff541449b89">HeartConfig::Instance</a>()
<a name="l00207"></a>00207 {
<a name="l00208"></a>00208     <span class="keywordflow">if</span> (<a class="code" href="classHeartConfig.html#a1d700f703ffa3528790264535857411a">mpInstance</a>.get() == NULL)
<a name="l00209"></a>00209     {
<a name="l00210"></a>00210         <a class="code" href="classHeartConfig.html#a1d700f703ffa3528790264535857411a">mpInstance</a>.reset(<span class="keyword">new</span> <a class="code" href="classHeartConfig.html">HeartConfig</a>);
<a name="l00211"></a>00211     }
<a name="l00212"></a>00212     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a1d700f703ffa3528790264535857411a">mpInstance</a>.get();
<a name="l00213"></a>00213 }
<a name="l00214"></a>00214 
<a name="l00215"></a><a class="code" href="classHeartConfig.html#a2f629df484e2205be3f61af02d5144e3">00215</a> <a class="code" href="classHeartConfig.html#a2f629df484e2205be3f61af02d5144e3">HeartConfig::HeartConfig</a>()
<a name="l00216"></a>00216     : mUseMassLumping(false),
<a name="l00217"></a>00217       mUseMassLumpingForPrecond(false),
<a name="l00218"></a>00218       mUseFixedNumberIterations(false),
<a name="l00219"></a>00219       mEvaluateNumItsEveryNSolves(UINT_MAX)
<a name="l00220"></a>00220 {
<a name="l00221"></a>00221     assert(<a class="code" href="classHeartConfig.html#a1d700f703ffa3528790264535857411a">mpInstance</a>.get() == NULL);
<a name="l00222"></a>00222     <a class="code" href="classHeartConfig.html#a39f79c982e9983fe8c2823d8de697d85">mUseFixedSchemaLocation</a> = <span class="keyword">true</span>;
<a name="l00223"></a>00223     <a class="code" href="classHeartConfig.html#a92d7f06c5cf8caa9c8cf3f65ada9bb6b">SetDefaultSchemaLocations</a>();
<a name="l00224"></a>00224 
<a name="l00225"></a>00225     <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a> = <a class="code" href="HeartConfigDefaults_8hpp.html#a851ccffc58ceb5f2628d473db9eded5a">CreateDefaultParameters</a>();
<a name="l00226"></a>00226     <span class="comment">//CheckTimeSteps(); // necessity of this line of code is not tested -- remove with caution!</span>
<a name="l00227"></a>00227 
<a name="l00228"></a>00228     <span class="comment">//initialise the member variable of the layers</span>
<a name="l00229"></a>00229     <a class="code" href="classHeartConfig.html#aefbe15b3fd5d616d98a35dd172608529">mEpiFraction</a> = -1.0;
<a name="l00230"></a>00230     <a class="code" href="classHeartConfig.html#a9c9f9fefab6c029324426098740b5bc4">mEndoFraction</a> =  -1.0;
<a name="l00231"></a>00231     <a class="code" href="classHeartConfig.html#a5648845197c449e58c2c879f7422df3f">mMidFraction</a> = -1.0;
<a name="l00232"></a>00232     <a class="code" href="classHeartConfig.html#a6ebec0d7deb03099ae581bca114147fb">mUserAskedForCellularTransmuralHeterogeneities</a> = <span class="keyword">false</span>;
<a name="l00233"></a>00233     <span class="comment">// initialise to senseless values (these should be only 0, 1 and 2)</span>
<a name="l00234"></a>00234     <span class="comment">// note: the &#39;minus 3&#39; is for checking purposes as we need to add 0, 1 or 2 to this initial value</span>
<a name="l00235"></a>00235     <span class="comment">// and UINT_MAX+1 seems to be 0</span>
<a name="l00236"></a>00236     <a class="code" href="classHeartConfig.html#abfdca19b9fc56fe21ef23d2593cc022f">mIndexMid</a> = UINT_MAX-3u;
<a name="l00237"></a>00237     <a class="code" href="classHeartConfig.html#ab24f553ab1e97d36b8467f7ca1bcf800">mIndexEpi</a> = UINT_MAX-3u;
<a name="l00238"></a>00238     <a class="code" href="classHeartConfig.html#a4785f6ad1c60766c471bcb525eac02d3">mIndexEndo</a> = UINT_MAX-3u;
<a name="l00239"></a>00239 
<a name="l00240"></a>00240     <a class="code" href="classHeartConfig.html#ae42bb9c3f734dfaa2247de53cf3543a1">mUseReactionDiffusionOperatorSplitting</a> = <span class="keyword">false</span>;
<a name="l00241"></a>00241 
<a name="l00243"></a>00243     <a class="code" href="classHeartConfig.html#ac657f43ca4d92bfd3c5e2270e7470429">mTissueIdentifiers</a>.insert(0);
<a name="l00244"></a>00244     <a class="code" href="classHeartConfig.html#a1471127f954fea7a8eb5811ec448f0cc">mBathIdentifiers</a>.insert(1);
<a name="l00245"></a>00245 }
<a name="l00246"></a>00246 
<a name="l00247"></a><a class="code" href="classHeartConfig.html#aa43c19f27c6313368b04ceabcd502ae4">00247</a> <a class="code" href="classHeartConfig.html#aa43c19f27c6313368b04ceabcd502ae4">HeartConfig::~HeartConfig</a>()
<a name="l00248"></a>00248 {
<a name="l00249"></a>00249 }
<a name="l00250"></a>00250 
<a name="l00251"></a>00251 
<a name="l00252"></a><a class="code" href="classHeartConfig.html#ac432ab6bce14059d6e18e92dbec89b74">00252</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#ac432ab6bce14059d6e18e92dbec89b74">HeartConfig::Write</a>(<span class="keywordtype">bool</span> useArchiveLocationInfo, std::string subfolderName)
<a name="l00253"></a>00253 {
<a name="l00254"></a>00254     <span class="comment">//Output file</span>
<a name="l00255"></a>00255     std::string output_dirname;
<a name="l00256"></a>00256     <span class="keywordflow">if</span> (useArchiveLocationInfo)
<a name="l00257"></a>00257     {
<a name="l00258"></a>00258         output_dirname = <a class="code" href="classArchiveLocationInfo.html#a6700ec1ad13e77e795a8059f95006de5">ArchiveLocationInfo::GetArchiveDirectory</a>();
<a name="l00259"></a>00259     }
<a name="l00260"></a>00260     <span class="keywordflow">else</span>
<a name="l00261"></a>00261     {
<a name="l00262"></a>00262         <a class="code" href="classOutputFileHandler.html">OutputFileHandler</a> handler(<a class="code" href="classHeartConfig.html#ad4f49a0c81a7463613fdde99fb56e224">GetOutputDirectory</a>() + <span class="stringliteral">&quot;/&quot;</span> + subfolderName, <span class="keyword">false</span>);
<a name="l00263"></a>00263         output_dirname = handler.<a class="code" href="classOutputFileHandler.html#ab9c41bd287378a80f884d9860fb14f27">GetOutputDirectoryFullPath</a>();
<a name="l00264"></a>00264     }
<a name="l00265"></a>00265 
<a name="l00266"></a>00266     <span class="comment">// Sometimes this method is called collectively, sometimes not,</span>
<a name="l00267"></a>00267     <span class="comment">// in any case the below file operations only want to be performed by</span>
<a name="l00268"></a>00268     <span class="comment">// the master - so exit. Caller takes responsibility for nice</span>
<a name="l00269"></a>00269     <span class="comment">// exception handling.</span>
<a name="l00270"></a>00270     <span class="keywordflow">if</span> (!<a class="code" href="classPetscTools.html#a30cf1b3576c5dd99556f6b87a05be7cc">PetscTools::AmMaster</a>())
<a name="l00271"></a>00271     {
<a name="l00272"></a>00272         <span class="keywordflow">return</span>;
<a name="l00273"></a>00273     }
<a name="l00274"></a>00274 
<a name="l00275"></a>00275     out_stream p_parameters_file( <span class="keyword">new</span> std::ofstream( (output_dirname+<span class="stringliteral">&quot;ChasteParameters.xml&quot;</span>).c_str() ) );
<a name="l00276"></a>00276 
<a name="l00277"></a>00277     <span class="keywordflow">if</span> (!p_parameters_file-&gt;is_open())
<a name="l00278"></a>00278     {
<a name="l00279"></a>00279         <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a>(<span class="stringliteral">&quot;Could not open XML file in HeartConfig&quot;</span>);
<a name="l00280"></a>00280     }
<a name="l00281"></a>00281 
<a name="l00282"></a>00282     <span class="comment">//Schema map</span>
<a name="l00283"></a>00283     <span class="comment">//Note - this location is relative to where we are storing the xml</span>
<a name="l00284"></a>00284     ::xml_schema::namespace_infomap map;
<a name="l00285"></a>00285     <span class="comment">// Release 1.1 (and earlier) didn&#39;t use a namespace</span>
<a name="l00286"></a>00286     map[<span class="stringliteral">&quot;&quot;</span>].schema = <span class="stringliteral">&quot;ChasteParameters_1_1.xsd&quot;</span>;
<a name="l00287"></a>00287     <span class="comment">// Later releases use namespaces of the form https://chaste.comlab.ox.ac.uk/nss/parameters/N_M</span>
<a name="l00288"></a>00288     map[<span class="stringliteral">&quot;cp20&quot;</span>].name = <span class="stringliteral">&quot;https://chaste.comlab.ox.ac.uk/nss/parameters/2_0&quot;</span>;
<a name="l00289"></a>00289     map[<span class="stringliteral">&quot;cp20&quot;</span>].schema = <span class="stringliteral">&quot;ChasteParameters_2_0.xsd&quot;</span>;
<a name="l00290"></a>00290     map[<span class="stringliteral">&quot;cp21&quot;</span>].name = <span class="stringliteral">&quot;https://chaste.comlab.ox.ac.uk/nss/parameters/2_1&quot;</span>;
<a name="l00291"></a>00291     map[<span class="stringliteral">&quot;cp21&quot;</span>].schema = <span class="stringliteral">&quot;ChasteParameters_2_1.xsd&quot;</span>;
<a name="l00292"></a>00292     map[<span class="stringliteral">&quot;cp22&quot;</span>].name = <span class="stringliteral">&quot;https://chaste.comlab.ox.ac.uk/nss/parameters/2_2&quot;</span>;
<a name="l00293"></a>00293     map[<span class="stringliteral">&quot;cp22&quot;</span>].schema = <span class="stringliteral">&quot;ChasteParameters_2_2.xsd&quot;</span>;
<a name="l00294"></a>00294     map[<span class="stringliteral">&quot;cp23&quot;</span>].name = <span class="stringliteral">&quot;https://chaste.comlab.ox.ac.uk/nss/parameters/2_3&quot;</span>;
<a name="l00295"></a>00295     map[<span class="stringliteral">&quot;cp23&quot;</span>].schema = <span class="stringliteral">&quot;ChasteParameters_2_3.xsd&quot;</span>;
<a name="l00296"></a>00296     map[<span class="stringliteral">&quot;cp30&quot;</span>].name = <span class="stringliteral">&quot;https://chaste.comlab.ox.ac.uk/nss/parameters/3_0&quot;</span>;
<a name="l00297"></a>00297     map[<span class="stringliteral">&quot;cp30&quot;</span>].schema = <span class="stringliteral">&quot;ChasteParameters_3_0.xsd&quot;</span>;
<a name="l00298"></a>00298     map[<span class="stringliteral">&quot;cp31&quot;</span>].name = <span class="stringliteral">&quot;https://chaste.comlab.ox.ac.uk/nss/parameters/3_1&quot;</span>;
<a name="l00299"></a>00299     map[<span class="stringliteral">&quot;cp31&quot;</span>].schema = <span class="stringliteral">&quot;ChasteParameters_3_1.xsd&quot;</span>;
<a name="l00300"></a>00300     <span class="comment">// We use &#39;cp&#39; as prefix for the latest version to avoid having to change saved</span>
<a name="l00301"></a>00301     <span class="comment">// versions for comparison at every release.</span>
<a name="l00302"></a>00302     map[<span class="stringliteral">&quot;cp&quot;</span>].name = <span class="stringliteral">&quot;https://chaste.comlab.ox.ac.uk/nss/parameters/3_3&quot;</span>;
<a name="l00303"></a>00303     map[<span class="stringliteral">&quot;cp&quot;</span>].schema = <span class="stringliteral">&quot;ChasteParameters_3_3.xsd&quot;</span>;
<a name="l00304"></a>00304 
<a name="l00305"></a>00305     cp::ChasteParameters(*p_parameters_file, *<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>, map);
<a name="l00306"></a>00306 
<a name="l00307"></a>00307     <span class="comment">// If we&#39;re archiving, try to save a copy of the latest schema too</span>
<a name="l00308"></a>00308     <span class="keywordflow">if</span> (useArchiveLocationInfo)
<a name="l00309"></a>00309     {
<a name="l00310"></a>00310         <a class="code" href="classHeartConfig.html#a37906194c947a2e92ea9c44775ef1b28">CopySchema</a>(output_dirname);
<a name="l00311"></a>00311     }
<a name="l00312"></a>00312 
<a name="l00313"></a>00313 }
<a name="l00314"></a>00314 
<a name="l00315"></a><a class="code" href="classHeartConfig.html#abf195ba8a906e3561a9a3820ba36c2ba">00315</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#abf195ba8a906e3561a9a3820ba36c2ba">HeartConfig::LoadFromCheckpoint</a>()
<a name="l00316"></a>00316 {
<a name="l00317"></a>00317     <span class="comment">/*</span>
<a name="l00318"></a>00318 <span class="comment">     *  This method implements the logic required by HeartConfig to be able to handle resuming a simulation via the executable.</span>
<a name="l00319"></a>00319 <span class="comment">     *</span>
<a name="l00320"></a>00320 <span class="comment">     *  When the control reaches the method mpParameters points to the file specified as resuming parameters.</span>
<a name="l00321"></a>00321 <span class="comment">     *  However SetParametersFile() will set this variable to point to the archived parameters.</span>
<a name="l00322"></a>00322 <span class="comment">     *</span>
<a name="l00323"></a>00323 <span class="comment">     *  We make a temporary copy of mpParameters so we don&#39;t lose its content.</span>
<a name="l00324"></a>00324 <span class="comment">     *  At the end of the method we update the new mpParameters with the resuming parameters.</span>
<a name="l00325"></a>00325 <span class="comment">     */</span>
<a name="l00326"></a>00326     assert(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>.use_count() &gt; 0);
<a name="l00327"></a>00327     boost::shared_ptr&lt;cp::chaste_parameters_type&gt; p_new_parameters = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>;
<a name="l00328"></a>00328 
<a name="l00329"></a>00329     <span class="comment">/*</span>
<a name="l00330"></a>00330 <span class="comment">     *  When we unarchive a simulation, we load the old parameters file in order to inherit things such</span>
<a name="l00331"></a>00331 <span class="comment">     *  as default cell model, stimuli, heterogeneities, ... This has the side effect of inheriting the</span>
<a name="l00332"></a>00332 <span class="comment">     *  &lt;CheckpointSimulation&gt; element (if defined).</span>
<a name="l00333"></a>00333 <span class="comment">     *</span>
<a name="l00334"></a>00334 <span class="comment">     *  We disable checkpointing definition coming from the unarchived config file. We will enable it again</span>
<a name="l00335"></a>00335 <span class="comment">     *  if defined in the resume config file.</span>
<a name="l00336"></a>00336 <span class="comment">     */</span>
<a name="l00337"></a>00337     std::string parameters_filename_xml = <a class="code" href="classArchiveLocationInfo.html#a6700ec1ad13e77e795a8059f95006de5">ArchiveLocationInfo::GetArchiveDirectory</a>() + <span class="stringliteral">&quot;ChasteParameters.xml&quot;</span>;
<a name="l00338"></a>00338     <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a> = <a class="code" href="classHeartConfig.html#a871a948c9d64ccfdecc2c3a1d47fb304">ReadFile</a>(parameters_filename_xml);
<a name="l00339"></a>00339     <a class="code" href="classHeartConfig.html#a4e525c4ace93166720a3b77d0b5f389d">mParametersFilePath</a>.<a class="code" href="classFileFinder.html#ad10aa6235c4c4fb24370d3f6675d4b8b">SetPath</a>(parameters_filename_xml, <a class="code" href="structRelativeTo.html#a71205f16f6ffbf2c354beb369d8b996ca0efafc4a003e7eb4fa99bce1a81e7f61">RelativeTo::AbsoluteOrCwd</a>);
<a name="l00340"></a>00340 
<a name="l00341"></a>00341     <span class="comment">// Release 3.0 and earlier wrote a separate defaults file in the checkpoint</span>
<a name="l00342"></a>00342     std::string defaults_filename_xml = <a class="code" href="classArchiveLocationInfo.html#a6700ec1ad13e77e795a8059f95006de5">ArchiveLocationInfo::GetArchiveDirectory</a>() + <span class="stringliteral">&quot;ChasteDefaults.xml&quot;</span>;
<a name="l00343"></a>00343     <span class="keywordflow">if</span> (<a class="code" href="classFileFinder.html">FileFinder</a>(defaults_filename_xml).Exists())
<a name="l00344"></a>00344     {
<a name="l00345"></a>00345         boost::shared_ptr&lt;cp::chaste_parameters_type&gt; p_defaults = <a class="code" href="classHeartConfig.html#a871a948c9d64ccfdecc2c3a1d47fb304">ReadFile</a>(defaults_filename_xml);
<a name="l00346"></a>00346         <a class="code" href="HeartConfigDefaults_8hpp.html#a036d1372e32bd605e0ccc9047ddca5f0">MergeDefaults</a>(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>, p_defaults);
<a name="l00347"></a>00347     }
<a name="l00348"></a>00348 
<a name="l00349"></a>00349     <a class="code" href="classHeartConfig.html#af8ab048189a76d46bbec0ff541449b89">HeartConfig::Instance</a>()-&gt;<a class="code" href="classHeartConfig.html#ad7acbc17d4e8fbf7f3c8dcf17340afe4">SetCheckpointSimulation</a>(<span class="keyword">false</span>);
<a name="l00350"></a>00350 
<a name="l00351"></a>00351     <span class="comment">// If we are resuming a simulation, some parameters can be altered at this point.</span>
<a name="l00352"></a>00352     <span class="keywordflow">if</span> (p_new_parameters-&gt;ResumeSimulation().present())
<a name="l00353"></a>00353     {
<a name="l00354"></a>00354         <a class="code" href="classHeartConfig.html#af4a13ca5317352be2869586bef3dbd8f">UpdateParametersFromResumeSimulation</a>(p_new_parameters);
<a name="l00355"></a>00355     }
<a name="l00356"></a>00356 
<a name="l00357"></a>00357     <a class="code" href="classHeartConfig.html#aef79708e5e663a9ea5ff236ecc0bbd85">CheckTimeSteps</a>(); <span class="comment">// For consistency with SetParametersFile</span>
<a name="l00358"></a>00358 }
<a name="l00359"></a>00359 
<a name="l00360"></a><a class="code" href="classHeartConfig.html#a37906194c947a2e92ea9c44775ef1b28">00360</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a37906194c947a2e92ea9c44775ef1b28">HeartConfig::CopySchema</a>(<span class="keyword">const</span> std::string&amp; rToDirectory)
<a name="l00361"></a>00361 {
<a name="l00362"></a>00362     <span class="comment">// N.B. This method should only be called by the master process,</span>
<a name="l00363"></a>00363     <span class="comment">// in a situation where it can handle EXCEPTION()s nicely, e.g.</span>
<a name="l00364"></a>00364     <span class="comment">// TRY_IF_MASTER(CopySchema(...));</span>
<a name="l00365"></a>00365 
<a name="l00366"></a>00366     std::string schema_name(<span class="stringliteral">&quot;ChasteParameters_3_3.xsd&quot;</span>);
<a name="l00367"></a>00367     <a class="code" href="classFileFinder.html">FileFinder</a> schema_location(<span class="stringliteral">&quot;heart/src/io/&quot;</span> + schema_name, <a class="code" href="structRelativeTo.html#a71205f16f6ffbf2c354beb369d8b996ca7d8d067a4ecd2bafa88912dbf8ac785b">RelativeTo::ChasteSourceRoot</a>);
<a name="l00368"></a>00368     <span class="keywordflow">if</span> (!schema_location.<a class="code" href="classFileFinder.html#a7c9aafbfeaef61ba18becd61f58b01eb">Exists</a>())
<a name="l00369"></a>00369     {
<a name="l00370"></a>00370         <span class="comment">// Try a relative path instead</span>
<a name="l00371"></a>00371         schema_location.<a class="code" href="classFileFinder.html#ad10aa6235c4c4fb24370d3f6675d4b8b">SetPath</a>(schema_name, <a class="code" href="structRelativeTo.html#a71205f16f6ffbf2c354beb369d8b996caab109680c356ada0533fcc39ffcddb54">RelativeTo::CWD</a>);
<a name="l00372"></a>00372         <span class="keywordflow">if</span> (!schema_location.<a class="code" href="classFileFinder.html#a7c9aafbfeaef61ba18becd61f58b01eb">Exists</a>())
<a name="l00373"></a>00373         {
<a name="l00374"></a>00374             <span class="comment">// Warn the user</span>
<a name="l00375"></a>00375             std::string message(<span class="stringliteral">&quot;Unable to locate schema file &quot;</span> + schema_name +
<a name="l00376"></a>00376                                 <span class="stringliteral">&quot;. You will need to ensure it is available when resuming from the checkpoint.&quot;</span>);
<a name="l00377"></a>00377             WARN_ONCE_ONLY(message);
<a name="l00378"></a>00378         }
<a name="l00379"></a>00379     }
<a name="l00380"></a>00380     <span class="keywordflow">if</span> (schema_location.<a class="code" href="classFileFinder.html#a7c9aafbfeaef61ba18becd61f58b01eb">Exists</a>())
<a name="l00381"></a>00381     {
<a name="l00382"></a>00382         <a class="code" href="classFileFinder.html">FileFinder</a> output_directory(rToDirectory, <a class="code" href="structRelativeTo.html#a71205f16f6ffbf2c354beb369d8b996ca79432caa8e303fb2903b65d6fa5f04a8">RelativeTo::Absolute</a>);
<a name="l00383"></a>00383         schema_location.<a class="code" href="classFileFinder.html#ab55cbd7b975249b7f72d8d76af779d53">CopyTo</a>(output_directory);
<a name="l00384"></a>00384     }
<a name="l00385"></a>00385 }
<a name="l00386"></a>00386 
<a name="l00387"></a><a class="code" href="classHeartConfig.html#a92d7f06c5cf8caa9c8cf3f65ada9bb6b">00387</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a92d7f06c5cf8caa9c8cf3f65ada9bb6b">HeartConfig::SetDefaultSchemaLocations</a>()
<a name="l00388"></a>00388 {
<a name="l00389"></a>00389     <a class="code" href="classHeartConfig.html#a0378789cef3d6ef3001bbb94e9e48798">mSchemaLocations</a>.clear();
<a name="l00390"></a>00390     <span class="comment">// Location of schemas in the source tree</span>
<a name="l00391"></a>00391     std::string root_dir = std::string(<a class="code" href="classChasteBuildInfo.html#ab1d5cd2c8e4852a5b0ac4f525c1e2565">ChasteBuildInfo::GetRootDir</a>()) + <span class="stringliteral">&quot;/heart/src/io/&quot;</span>;
<a name="l00392"></a>00392     <span class="comment">// Release 1.1 (and earlier) didn&#39;t use a namespace</span>
<a name="l00393"></a>00393     <a class="code" href="classHeartConfig.html#a0378789cef3d6ef3001bbb94e9e48798">mSchemaLocations</a>[<span class="stringliteral">&quot;&quot;</span>] = root_dir + <span class="stringliteral">&quot;ChasteParameters_1_1.xsd&quot;</span>;
<a name="l00394"></a>00394     <span class="comment">// Later releases use namespaces of the form https://chaste.comlab.ox.ac.uk/nss/parameters/N_M</span>
<a name="l00395"></a>00395     <a class="code" href="classHeartConfig.html#a0378789cef3d6ef3001bbb94e9e48798">mSchemaLocations</a>[<span class="stringliteral">&quot;https://chaste.comlab.ox.ac.uk/nss/parameters/2_0&quot;</span>] = root_dir + <span class="stringliteral">&quot;ChasteParameters_2_0.xsd&quot;</span>;
<a name="l00396"></a>00396     <a class="code" href="classHeartConfig.html#a0378789cef3d6ef3001bbb94e9e48798">mSchemaLocations</a>[<span class="stringliteral">&quot;https://chaste.comlab.ox.ac.uk/nss/parameters/2_1&quot;</span>] = root_dir + <span class="stringliteral">&quot;ChasteParameters_2_1.xsd&quot;</span>;
<a name="l00397"></a>00397     <a class="code" href="classHeartConfig.html#a0378789cef3d6ef3001bbb94e9e48798">mSchemaLocations</a>[<span class="stringliteral">&quot;https://chaste.comlab.ox.ac.uk/nss/parameters/2_2&quot;</span>] = root_dir + <span class="stringliteral">&quot;ChasteParameters_2_2.xsd&quot;</span>;
<a name="l00398"></a>00398     <a class="code" href="classHeartConfig.html#a0378789cef3d6ef3001bbb94e9e48798">mSchemaLocations</a>[<span class="stringliteral">&quot;https://chaste.comlab.ox.ac.uk/nss/parameters/2_3&quot;</span>] = root_dir + <span class="stringliteral">&quot;ChasteParameters_2_3.xsd&quot;</span>;
<a name="l00399"></a>00399     <a class="code" href="classHeartConfig.html#a0378789cef3d6ef3001bbb94e9e48798">mSchemaLocations</a>[<span class="stringliteral">&quot;https://chaste.comlab.ox.ac.uk/nss/parameters/3_0&quot;</span>] = root_dir + <span class="stringliteral">&quot;ChasteParameters_3_0.xsd&quot;</span>;
<a name="l00400"></a>00400     <a class="code" href="classHeartConfig.html#a0378789cef3d6ef3001bbb94e9e48798">mSchemaLocations</a>[<span class="stringliteral">&quot;https://chaste.comlab.ox.ac.uk/nss/parameters/3_1&quot;</span>] = root_dir + <span class="stringliteral">&quot;ChasteParameters_3_1.xsd&quot;</span>;
<a name="l00401"></a>00401     <a class="code" href="classHeartConfig.html#a0378789cef3d6ef3001bbb94e9e48798">mSchemaLocations</a>[<span class="stringliteral">&quot;https://chaste.comlab.ox.ac.uk/nss/parameters/3_3&quot;</span>] = root_dir + <span class="stringliteral">&quot;ChasteParameters_3_3.xsd&quot;</span>;
<a name="l00402"></a>00402 }
<a name="l00403"></a>00403 
<a name="l00404"></a><a class="code" href="classHeartConfig.html#ae3070b8f3e5f0c5d86ddb9e52b116de1">00404</a> <span class="keywordtype">unsigned</span> <a class="code" href="classHeartConfig.html#ae3070b8f3e5f0c5d86ddb9e52b116de1">HeartConfig::GetVersionFromNamespace</a>(<span class="keyword">const</span> std::string&amp; rNamespaceUri)
<a name="l00405"></a>00405 {
<a name="l00406"></a>00406     <span class="keywordtype">unsigned</span> version_major = 0;
<a name="l00407"></a>00407     <span class="keywordtype">unsigned</span> version_minor = 0;
<a name="l00408"></a>00408     <span class="keywordflow">if</span> (rNamespaceUri == <span class="stringliteral">&quot;&quot;</span>)
<a name="l00409"></a>00409     {
<a name="l00410"></a>00410         version_major = 1;
<a name="l00411"></a>00411         version_minor = 1;
<a name="l00412"></a>00412     }
<a name="l00413"></a>00413     <span class="keywordflow">else</span>
<a name="l00414"></a>00414     {
<a name="l00415"></a>00415         std::string uri_base(<span class="stringliteral">&quot;https://chaste.comlab.ox.ac.uk/nss/parameters/&quot;</span>);
<a name="l00416"></a>00416         <span class="keywordflow">if</span> (rNamespaceUri.substr(0, uri_base.length()) == uri_base)
<a name="l00417"></a>00417         {
<a name="l00418"></a>00418             std::istringstream version_string(rNamespaceUri.substr(uri_base.length()));
<a name="l00419"></a>00419             version_string &gt;&gt; version_major;
<a name="l00420"></a>00420             version_string.ignore(1);
<a name="l00421"></a>00421             version_string &gt;&gt; version_minor;
<a name="l00422"></a>00422             <span class="keywordflow">if</span> (version_string.fail())
<a name="l00423"></a>00423             {
<a name="l00424"></a>00424                 version_major = 0;
<a name="l00425"></a>00425                 version_minor = 0;
<a name="l00426"></a>00426             }
<a name="l00427"></a>00427         }
<a name="l00428"></a>00428     }
<a name="l00429"></a>00429 
<a name="l00430"></a>00430     <span class="keywordtype">unsigned</span> version = version_major * 1000 + version_minor;
<a name="l00431"></a>00431     <span class="keywordflow">if</span> (version == 0)
<a name="l00432"></a>00432     {
<a name="l00433"></a>00433         <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a>(rNamespaceUri + <span class="stringliteral">&quot; is not a recognised Chaste parameters namespace.&quot;</span>);
<a name="l00434"></a>00434     }
<a name="l00435"></a>00435     <span class="keywordflow">return</span> version;
<a name="l00436"></a>00436 }
<a name="l00437"></a>00437 
<a name="l00438"></a><a class="code" href="classHeartConfig.html#a6e38ef44c15a2d35c349cf323dca4fbb">00438</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a6e38ef44c15a2d35c349cf323dca4fbb">HeartConfig::SetFixedSchemaLocations</a>(<span class="keyword">const</span> SchemaLocationsMap&amp; rSchemaLocations)
<a name="l00439"></a>00439 {
<a name="l00440"></a>00440     <a class="code" href="classHeartConfig.html#a0378789cef3d6ef3001bbb94e9e48798">mSchemaLocations</a> = rSchemaLocations;
<a name="l00441"></a>00441     <a class="code" href="classHeartConfig.html#a54b8f9c822ac30d9a22e6121f428658b">SetUseFixedSchemaLocation</a>(<span class="keyword">true</span>);
<a name="l00442"></a>00442 }
<a name="l00443"></a>00443 
<a name="l00444"></a><a class="code" href="classHeartConfig.html#a54b8f9c822ac30d9a22e6121f428658b">00444</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a54b8f9c822ac30d9a22e6121f428658b">HeartConfig::SetUseFixedSchemaLocation</a>(<span class="keywordtype">bool</span> useFixedSchemaLocation)
<a name="l00445"></a>00445 {
<a name="l00446"></a>00446     <a class="code" href="classHeartConfig.html#a39f79c982e9983fe8c2823d8de697d85">mUseFixedSchemaLocation</a> = useFixedSchemaLocation;
<a name="l00447"></a>00447 }
<a name="l00448"></a>00448 
<a name="l00449"></a><a class="code" href="classHeartConfig.html#a871a948c9d64ccfdecc2c3a1d47fb304">00449</a> boost::shared_ptr&lt;cp::chaste_parameters_type&gt; <a class="code" href="classHeartConfig.html#a871a948c9d64ccfdecc2c3a1d47fb304">HeartConfig::ReadFile</a>(<span class="keyword">const</span> std::string&amp; rFileName)
<a name="l00450"></a>00450 {
<a name="l00451"></a>00451     <span class="comment">// Determine whether to use the schema path given in the input XML, or our own schema</span>
<a name="l00452"></a>00452     ::xml_schema::properties props;
<a name="l00453"></a>00453     <span class="keywordflow">if</span> (<a class="code" href="classHeartConfig.html#a39f79c982e9983fe8c2823d8de697d85">mUseFixedSchemaLocation</a>)
<a name="l00454"></a>00454     {
<a name="l00455"></a>00455         <span class="keywordflow">for</span> (SchemaLocationsMap::iterator it = <a class="code" href="classHeartConfig.html#a0378789cef3d6ef3001bbb94e9e48798">mSchemaLocations</a>.begin();
<a name="l00456"></a>00456              it != <a class="code" href="classHeartConfig.html#a0378789cef3d6ef3001bbb94e9e48798">mSchemaLocations</a>.end();
<a name="l00457"></a>00457              ++it)
<a name="l00458"></a>00458         {
<a name="l00459"></a>00459             <span class="keywordflow">if</span> (it-&gt;first == <span class="stringliteral">&quot;&quot;</span>)
<a name="l00460"></a>00460             {
<a name="l00461"></a>00461                 props.no_namespace_schema_location(<a class="code" href="classXmlTools.html#a2879fbd117ddd8bce46f2cdf7d039069">XmlTools::EscapeSpaces</a>(it-&gt;second));
<a name="l00462"></a>00462             }
<a name="l00463"></a>00463             <span class="keywordflow">else</span>
<a name="l00464"></a>00464             {
<a name="l00465"></a>00465                 props.schema_location(it-&gt;first, <a class="code" href="classXmlTools.html#a2879fbd117ddd8bce46f2cdf7d039069">XmlTools::EscapeSpaces</a>(it-&gt;second));
<a name="l00466"></a>00466             }
<a name="l00467"></a>00467         }
<a name="l00468"></a>00468     }
<a name="l00469"></a>00469 
<a name="l00470"></a>00470     <span class="comment">// Get the parameters using the method &#39;ChasteParameters(rFileName)&#39;,</span>
<a name="l00471"></a>00471     <span class="comment">// which returns a std::auto_ptr. We convert to a shared_ptr for easier semantics.</span>
<a name="l00472"></a>00472     <span class="keywordflow">try</span>
<a name="l00473"></a>00473     {
<a name="l00474"></a>00474         <span class="comment">// Make sure Xerces finalization happens</span>
<a name="l00475"></a>00475         <a class="code" href="classXmlTools_1_1Finalizer.html">XmlTools::Finalizer</a> finalizer(<span class="keyword">false</span>);
<a name="l00476"></a>00476         <span class="comment">// Parse XML to DOM</span>
<a name="l00477"></a>00477         xsd::cxx::xml::dom::auto_ptr&lt;xercesc::DOMDocument&gt; p_doc = <a class="code" href="classXmlTools.html#aecbc2045a76fffc05e4c17da9789c69a">XmlTools::ReadXmlFile</a>(rFileName, props);
<a name="l00478"></a>00478         <span class="comment">// Test the namespace on the root element</span>
<a name="l00479"></a>00479         xercesc::DOMElement* p_root_elt = p_doc-&gt;getDocumentElement();
<a name="l00480"></a>00480         std::string namespace_uri(X2C(p_root_elt-&gt;getNamespaceURI()));
<a name="l00481"></a>00481         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> version = <a class="code" href="classHeartConfig.html#ae3070b8f3e5f0c5d86ddb9e52b116de1">GetVersionFromNamespace</a>(namespace_uri);
<a name="l00482"></a>00482         <span class="keywordflow">if</span> (version &lt; 2000) <span class="comment">// Changes made in release 2.0</span>
<a name="l00483"></a>00483         {
<a name="l00484"></a>00484             <a class="code" href="classXmlTransforms.html#a1e5bd50d05c32cf8257cacbb2b650bbd">XmlTransforms::TransformIonicModelDefinitions</a>(p_doc.get(), p_root_elt);
<a name="l00485"></a>00485         }
<a name="l00486"></a>00486         <span class="keywordflow">if</span> (version &lt; 2001) <span class="comment">// Changes made in release 2.1</span>
<a name="l00487"></a>00487         {
<a name="l00488"></a>00488             <a class="code" href="classXmlTransforms.html#a0213cbf8bed42fa7e3236fdf4376bf64">XmlTransforms::TransformArchiveDirectory</a>(p_doc.get(), p_root_elt);
<a name="l00489"></a>00489             <a class="code" href="classXmlTransforms.html#ab7c65c8fd2a2e9b07b70b7009df314ef">XmlTransforms::CheckForIluPreconditioner</a>(p_doc.get(), p_root_elt);
<a name="l00490"></a>00490         }
<a name="l00491"></a>00491         <span class="keywordflow">if</span> (version &lt; 3001) <span class="comment">// Changes made in release 3.1</span>
<a name="l00492"></a>00492         {
<a name="l00493"></a>00493             <a class="code" href="classXmlTransforms.html#a66e900e4a1f476633d6abf749bad0987">XmlTransforms::MoveConductivityHeterogeneities</a>(p_doc.get(), p_root_elt);
<a name="l00494"></a>00494         }
<a name="l00495"></a>00495         <span class="keywordflow">if</span> (version &lt; 3003) <span class="comment">// Not the latest release</span>
<a name="l00496"></a>00496         {
<a name="l00497"></a>00497             <a class="code" href="classXmlTransforms.html#a62b290bd956d1c9e9d013358e7a9daa6">XmlTransforms::SetDefaultVisualizer</a>(p_doc.get(), p_root_elt);
<a name="l00498"></a>00498             <a class="code" href="classXmlTools.html#a09596c402a3cbd2e2405629efd2bbd63">XmlTools::SetNamespace</a>(p_doc.get(), p_root_elt, <span class="stringliteral">&quot;https://chaste.comlab.ox.ac.uk/nss/parameters/3_3&quot;</span>);
<a name="l00499"></a>00499         }
<a name="l00500"></a>00500         <span class="comment">// Parse DOM to object model</span>
<a name="l00501"></a>00501         std::auto_ptr&lt;cp::chaste_parameters_type&gt; p_params(cp::ChasteParameters(*p_doc, ::xml_schema::flags::dont_initialize, props));
<a name="l00502"></a>00502         <span class="comment">// Get rid of the DOM stuff</span>
<a name="l00503"></a>00503         p_doc.reset();
<a name="l00504"></a>00504 
<a name="l00505"></a>00505         <span class="keywordflow">return</span> boost::shared_ptr&lt;cp::chaste_parameters_type&gt;(p_params);
<a name="l00506"></a>00506     }
<a name="l00507"></a>00507     <span class="keywordflow">catch</span> (<span class="keyword">const</span> xml_schema::exception&amp; e)
<a name="l00508"></a>00508     {
<a name="l00509"></a>00509         std::cerr &lt;&lt; e &lt;&lt; std::endl;
<a name="l00510"></a>00510         <span class="comment">// Make sure we don&#39;t store invalid parameters</span>
<a name="l00511"></a>00511         <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>.reset();
<a name="l00512"></a>00512         <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a>(<span class="stringliteral">&quot;XML parsing error in configuration file: &quot;</span> + rFileName);
<a name="l00513"></a>00513     }
<a name="l00514"></a>00514     <span class="keywordflow">catch</span> (...)
<a name="l00515"></a>00515     {
<a name="l00516"></a>00516         <span class="comment">// Make sure we don&#39;t store invalid parameters</span>
<a name="l00517"></a>00517         <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>.reset();
<a name="l00518"></a>00518         <span class="keywordflow">throw</span>;
<a name="l00519"></a>00519     }
<a name="l00520"></a>00520 }
<a name="l00521"></a>00521 
<a name="l00522"></a><a class="code" href="classHeartConfig.html#af6fed28371be1a69eefe2de666d44a87">00522</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#af6fed28371be1a69eefe2de666d44a87">HeartConfig::SetParametersFile</a>(<span class="keyword">const</span> std::string&amp; rFileName)
<a name="l00523"></a>00523 {
<a name="l00524"></a>00524     <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a> = <a class="code" href="classHeartConfig.html#a871a948c9d64ccfdecc2c3a1d47fb304">ReadFile</a>(rFileName);
<a name="l00525"></a>00525     <a class="code" href="HeartConfigDefaults_8hpp.html#a036d1372e32bd605e0ccc9047ddca5f0">MergeDefaults</a>(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>, <a class="code" href="HeartConfigDefaults_8hpp.html#a851ccffc58ceb5f2628d473db9eded5a">CreateDefaultParameters</a>());
<a name="l00526"></a>00526     <a class="code" href="classHeartConfig.html#a4e525c4ace93166720a3b77d0b5f389d">mParametersFilePath</a>.<a class="code" href="classFileFinder.html#ad10aa6235c4c4fb24370d3f6675d4b8b">SetPath</a>(rFileName, <a class="code" href="structRelativeTo.html#a71205f16f6ffbf2c354beb369d8b996ca0efafc4a003e7eb4fa99bce1a81e7f61">RelativeTo::AbsoluteOrCwd</a>);
<a name="l00527"></a>00527 
<a name="l00528"></a>00528     <span class="keywordflow">if</span> (<a class="code" href="classHeartConfig.html#a894d374015f888c2111ec252134395fc">IsSimulationDefined</a>())
<a name="l00529"></a>00529     {
<a name="l00530"></a>00530         <a class="code" href="classHeartConfig.html#aef79708e5e663a9ea5ff236ecc0bbd85">CheckTimeSteps</a>(); <span class="comment">// Resume files might not have time steps defined</span>
<a name="l00531"></a>00531     }
<a name="l00532"></a>00532 }
<a name="l00533"></a>00533 
<a name="l00534"></a><a class="code" href="classHeartConfig.html#a61152dd6c41da57ee91b59a6a3e70fc6">00534</a> <a class="code" href="classFileFinder.html">FileFinder</a> <a class="code" href="classHeartConfig.html#a61152dd6c41da57ee91b59a6a3e70fc6">HeartConfig::GetParametersFilePath</a>()
<a name="l00535"></a>00535 {
<a name="l00536"></a>00536     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a4e525c4ace93166720a3b77d0b5f389d">mParametersFilePath</a>;
<a name="l00537"></a>00537 }
<a name="l00538"></a>00538 
<a name="l00539"></a><a class="code" href="classHeartConfig.html#af4a13ca5317352be2869586bef3dbd8f">00539</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#af4a13ca5317352be2869586bef3dbd8f">HeartConfig::UpdateParametersFromResumeSimulation</a>(boost::shared_ptr&lt;cp::chaste_parameters_type&gt; pResumeParameters)
<a name="l00540"></a>00540 {
<a name="l00541"></a>00541     <span class="comment">// Check for user foolishness</span>
<a name="l00542"></a>00542     <span class="keywordflow">if</span> ( (pResumeParameters-&gt;ResumeSimulation()-&gt;SpaceDimension() != <a class="code" href="classHeartConfig.html#af8ab048189a76d46bbec0ff541449b89">HeartConfig::Instance</a>()-&gt;<a class="code" href="classHeartConfig.html#a4170d162538ec096d7df103f5781a998">GetSpaceDimension</a>())
<a name="l00543"></a>00543          ||(pResumeParameters-&gt;ResumeSimulation()-&gt;Domain() != <a class="code" href="classHeartConfig.html#af8ab048189a76d46bbec0ff541449b89">HeartConfig::Instance</a>()-&gt;<a class="code" href="classHeartConfig.html#a493a8d7316bd8e257459ec0372fd8706">GetDomain</a>()))
<a name="l00544"></a>00544     {
<a name="l00545"></a>00545         <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a>(<span class="stringliteral">&quot;Problem type and space dimension should match when restarting a simulation.&quot;</span>);
<a name="l00546"></a>00546     }
<a name="l00547"></a>00547 
<a name="l00548"></a>00548     <span class="comment">// New simulation duration</span>
<a name="l00549"></a>00549     <a class="code" href="classHeartConfig.html#af8ab048189a76d46bbec0ff541449b89">HeartConfig::Instance</a>()-&gt;<a class="code" href="classHeartConfig.html#aad5f6297757ec9b088e6ef56b9a71686">SetSimulationDuration</a>(pResumeParameters-&gt;ResumeSimulation()-&gt;SimulationDuration());
<a name="l00550"></a>00550 
<a name="l00551"></a>00551     <span class="comment">// Stimulus definition.  For these we always replace any previous definitions (at least for now...)</span>
<a name="l00552"></a>00552     <span class="keywordflow">if</span> (pResumeParameters-&gt;ResumeSimulation()-&gt;Stimuli().present())
<a name="l00553"></a>00553     {
<a name="l00554"></a>00554         <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Stimuli().set(pResumeParameters-&gt;ResumeSimulation()-&gt;Stimuli().get());
<a name="l00555"></a>00555     }
<a name="l00556"></a>00556 
<a name="l00557"></a>00557     <span class="comment">// Cell heterogeneities.  Note that while we copy the elements here, other code in CardiacSimulation actually updates</span>
<a name="l00558"></a>00558     <span class="comment">// the loaded simulation to take account of the new settings.</span>
<a name="l00559"></a>00559     <span class="keywordflow">if</span> (pResumeParameters-&gt;ResumeSimulation()-&gt;CellHeterogeneities().present())
<a name="l00560"></a>00560     {
<a name="l00561"></a>00561         <span class="keywordflow">if</span> (!<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;CellHeterogeneities().present())
<a name="l00562"></a>00562         {
<a name="l00563"></a>00563             <span class="comment">// Original parameters had no heterogeneities, so just copy the whole element</span>
<a name="l00564"></a>00564             <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;CellHeterogeneities().set(pResumeParameters-&gt;ResumeSimulation()-&gt;CellHeterogeneities().get());
<a name="l00565"></a>00565         }
<a name="l00566"></a>00566         <span class="keywordflow">else</span>
<a name="l00567"></a>00567         {
<a name="l00568"></a>00568             <span class="comment">// Need to append the new heterogeneity defitions to the original sequence</span>
<a name="l00569"></a>00569             XSD_SEQUENCE_TYPE(cp::cell_heterogeneities_type::CellHeterogeneity)&amp;
<a name="l00570"></a>00570                 new_seq = pResumeParameters-&gt;ResumeSimulation()-&gt;CellHeterogeneities()-&gt;CellHeterogeneity();
<a name="l00571"></a>00571             XSD_SEQUENCE_TYPE(cp::cell_heterogeneities_type::CellHeterogeneity)&amp;
<a name="l00572"></a>00572                 orig_seq = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;CellHeterogeneities()-&gt;CellHeterogeneity();
<a name="l00573"></a>00573             <span class="keywordflow">for</span> (XSD_ITERATOR_TYPE(cp::cell_heterogeneities_type::CellHeterogeneity) i = new_seq.begin();
<a name="l00574"></a>00574                  i != new_seq.end();
<a name="l00575"></a>00575                  ++i)
<a name="l00576"></a>00576             {
<a name="l00577"></a>00577                 orig_seq.push_back(*i);
<a name="l00578"></a>00578             }
<a name="l00579"></a>00579         }
<a name="l00580"></a>00580     }
<a name="l00581"></a>00581 
<a name="l00582"></a>00582     <span class="comment">// Whether to checkpoint the resumed simulation</span>
<a name="l00583"></a>00583     <span class="keywordflow">if</span> (pResumeParameters-&gt;ResumeSimulation()-&gt;CheckpointSimulation().present())
<a name="l00584"></a>00584     {
<a name="l00585"></a>00585         <a class="code" href="classHeartConfig.html#af8ab048189a76d46bbec0ff541449b89">HeartConfig::Instance</a>()-&gt;<a class="code" href="classHeartConfig.html#ad7acbc17d4e8fbf7f3c8dcf17340afe4">SetCheckpointSimulation</a>(<span class="keyword">true</span>,
<a name="l00586"></a>00586                                                          pResumeParameters-&gt;ResumeSimulation()-&gt;CheckpointSimulation()-&gt;timestep(),
<a name="l00587"></a>00587                                                          pResumeParameters-&gt;ResumeSimulation()-&gt;CheckpointSimulation()-&gt;max_checkpoints_on_disk());
<a name="l00588"></a>00588     }
<a name="l00589"></a>00589 
<a name="l00590"></a>00590     <span class="comment">//Visualization parameters are no longer compulsory</span>
<a name="l00591"></a>00591     <span class="keywordflow">if</span> (pResumeParameters-&gt;ResumeSimulation()-&gt;OutputVisualizer().present())
<a name="l00592"></a>00592     {
<a name="l00593"></a>00593         <a class="code" href="classHeartConfig.html#af8ab048189a76d46bbec0ff541449b89">HeartConfig::Instance</a>()-&gt;<a class="code" href="classHeartConfig.html#af43426509538104d4a68b88328c470a6">SetVisualizeWithParallelVtk</a>(pResumeParameters-&gt;ResumeSimulation()-&gt;OutputVisualizer()-&gt;parallel_vtk() == cp::yesno_type::yes);
<a name="l00594"></a>00594         <a class="code" href="classHeartConfig.html#af8ab048189a76d46bbec0ff541449b89">HeartConfig::Instance</a>()-&gt;<a class="code" href="classHeartConfig.html#aa64153e80db50c971a58069dd3e1350e">SetVisualizeWithVtk</a>(pResumeParameters-&gt;ResumeSimulation()-&gt;OutputVisualizer()-&gt;vtk() == cp::yesno_type::yes);
<a name="l00595"></a>00595         <a class="code" href="classHeartConfig.html#af8ab048189a76d46bbec0ff541449b89">HeartConfig::Instance</a>()-&gt;<a class="code" href="classHeartConfig.html#af1c744570c4f03ee01b52c62ca4ef40f">SetVisualizeWithCmgui</a>(pResumeParameters-&gt;ResumeSimulation()-&gt;OutputVisualizer()-&gt;cmgui() == cp::yesno_type::yes);
<a name="l00596"></a>00596         <a class="code" href="classHeartConfig.html#af8ab048189a76d46bbec0ff541449b89">HeartConfig::Instance</a>()-&gt;<a class="code" href="classHeartConfig.html#a7ef84b9090f708031aac64b7504742e0">SetVisualizeWithMeshalyzer</a>(pResumeParameters-&gt;ResumeSimulation()-&gt;OutputVisualizer()-&gt;meshalyzer() == cp::yesno_type::yes);
<a name="l00597"></a>00597     }
<a name="l00598"></a>00598 
<a name="l00599"></a>00599     <span class="comment">// Numerical parameters may be overridden</span>
<a name="l00600"></a>00600     {
<a name="l00601"></a>00601         cp::numerical_type&amp; r_resume = pResumeParameters-&gt;Numerical();
<a name="l00602"></a>00602         cp::numerical_type&amp; r_user = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical();
<a name="l00603"></a>00603         <span class="keywordflow">if</span> (r_resume.TimeSteps().present())
<a name="l00604"></a>00604         {
<a name="l00605"></a>00605             r_user.TimeSteps().set(r_resume.TimeSteps().get());
<a name="l00606"></a>00606         }
<a name="l00607"></a>00607         <span class="keywordflow">if</span> (r_resume.KSPTolerances().present())
<a name="l00608"></a>00608         {
<a name="l00609"></a>00609             r_user.KSPTolerances().set(r_resume.KSPTolerances().get());
<a name="l00610"></a>00610         }
<a name="l00611"></a>00611         <span class="keywordflow">if</span> (r_resume.KSPSolver().present())
<a name="l00612"></a>00612         {
<a name="l00613"></a>00613             r_user.KSPSolver().set(r_resume.KSPSolver().get());
<a name="l00614"></a>00614         }
<a name="l00615"></a>00615         <span class="keywordflow">if</span> (r_resume.KSPPreconditioner().present())
<a name="l00616"></a>00616         {
<a name="l00617"></a>00617             r_user.KSPPreconditioner().set(r_resume.KSPPreconditioner().get());
<a name="l00618"></a>00618         }
<a name="l00619"></a>00619         <span class="keywordflow">if</span> (r_resume.AdaptivityParameters().present())
<a name="l00620"></a>00620         {
<a name="l00621"></a>00621             r_user.AdaptivityParameters().set(r_resume.AdaptivityParameters().get());
<a name="l00622"></a>00622         }
<a name="l00623"></a>00623     }
<a name="l00624"></a>00624 
<a name="l00625"></a>00625     <span class="comment">// Post-processing parameters may be overridden</span>
<a name="l00626"></a>00626     <span class="keywordflow">if</span> (pResumeParameters-&gt;PostProcessing().present())
<a name="l00627"></a>00627     {
<a name="l00628"></a>00628         <a class="code" href="classHeartConfig.html#a66b61cef16319298971d3961516229db">EnsurePostProcessingSectionPresent</a>();
<a name="l00629"></a>00629         cp::postprocessing_type&amp; r_resume = pResumeParameters-&gt;PostProcessing().get();
<a name="l00630"></a>00630         cp::postprocessing_type&amp; r_user = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;PostProcessing().get();
<a name="l00631"></a>00631         <span class="keywordflow">if</span> (!r_resume.ActionPotentialDurationMap().empty())
<a name="l00632"></a>00632         {
<a name="l00633"></a>00633             r_user.ActionPotentialDurationMap() = r_resume.ActionPotentialDurationMap();
<a name="l00634"></a>00634         }
<a name="l00635"></a>00635         <span class="keywordflow">if</span> (!r_resume.UpstrokeTimeMap().empty())
<a name="l00636"></a>00636         {
<a name="l00637"></a>00637             r_user.UpstrokeTimeMap() = r_resume.UpstrokeTimeMap();
<a name="l00638"></a>00638         }
<a name="l00639"></a>00639         <span class="keywordflow">if</span> (!r_resume.MaxUpstrokeVelocityMap().empty())
<a name="l00640"></a>00640         {
<a name="l00641"></a>00641             r_user.MaxUpstrokeVelocityMap() = r_resume.MaxUpstrokeVelocityMap();
<a name="l00642"></a>00642         }
<a name="l00643"></a>00643         <span class="keywordflow">if</span> (!r_resume.ConductionVelocityMap().empty())
<a name="l00644"></a>00644         {
<a name="l00645"></a>00645             r_user.ConductionVelocityMap() = r_resume.ConductionVelocityMap();
<a name="l00646"></a>00646         }
<a name="l00647"></a>00647     }
<a name="l00648"></a>00648 }
<a name="l00649"></a>00649 
<a name="l00650"></a>00650 
<a name="l00651"></a><a class="code" href="classHeartConfig.html#ae2378924829d86f77eb14c5fd0326e80">00651</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#ae2378924829d86f77eb14c5fd0326e80">HeartConfig::Reset</a>()
<a name="l00652"></a>00652 {
<a name="l00653"></a>00653     <span class="comment">// Throw it away first, so that mpInstance is NULL when we...</span>
<a name="l00654"></a>00654     <a class="code" href="classHeartConfig.html#a1d700f703ffa3528790264535857411a">mpInstance</a>.reset();
<a name="l00655"></a>00655     <span class="comment">// ...make a new one</span>
<a name="l00656"></a>00656     <a class="code" href="classHeartConfig.html#a1d700f703ffa3528790264535857411a">mpInstance</a>.reset(<span class="keyword">new</span> <a class="code" href="classHeartConfig.html">HeartConfig</a>);
<a name="l00657"></a>00657 }
<a name="l00658"></a>00658 
<a name="l00659"></a><a class="code" href="classHeartConfig.html#a894d374015f888c2111ec252134395fc">00659</a> <span class="keywordtype">bool</span> <a class="code" href="classHeartConfig.html#a894d374015f888c2111ec252134395fc">HeartConfig::IsSimulationDefined</a>()<span class="keyword"> const</span>
<a name="l00660"></a>00660 <span class="keyword"></span>{
<a name="l00661"></a>00661     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation().present();
<a name="l00662"></a>00662 }
<a name="l00663"></a>00663 
<a name="l00664"></a><a class="code" href="classHeartConfig.html#a67ec8f0a426a424b562ab106fb1fc144">00664</a> <span class="keywordtype">bool</span> <a class="code" href="classHeartConfig.html#a67ec8f0a426a424b562ab106fb1fc144">HeartConfig::IsSimulationResumed</a>()<span class="keyword"> const</span>
<a name="l00665"></a>00665 <span class="keyword"></span>{
<a name="l00666"></a>00666     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;ResumeSimulation().present();
<a name="l00667"></a>00667 }
<a name="l00668"></a>00668 
<a name="l00669"></a>00669 
<a name="l00670"></a><a class="code" href="classHeartConfig.html#aab7ea75d3f83c1202127db592d934532">00670</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#aab7ea75d3f83c1202127db592d934532">HeartConfig::CheckSimulationIsDefined</a>(std::string callingMethod)<span class="keyword"> const</span>
<a name="l00671"></a>00671 <span class="keyword"></span>{
<a name="l00672"></a>00672     <span class="keywordflow">if</span> (<a class="code" href="classHeartConfig.html#a67ec8f0a426a424b562ab106fb1fc144">IsSimulationResumed</a>())
<a name="l00673"></a>00673     {
<a name="l00674"></a>00674         <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a>(callingMethod + <span class="stringliteral">&quot; information is not available in a resumed simulation.&quot;</span>);
<a name="l00675"></a>00675     }
<a name="l00676"></a>00676 }
<a name="l00677"></a>00677 
<a name="l00678"></a><a class="code" href="classHeartConfig.html#a2be3fdcc724c4a6609526b53f86d8c01">00678</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a2be3fdcc724c4a6609526b53f86d8c01">HeartConfig::CheckResumeSimulationIsDefined</a>(std::string callingMethod)<span class="keyword"> const</span>
<a name="l00679"></a>00679 <span class="keyword"></span>{
<a name="l00680"></a>00680     <span class="keywordflow">if</span> (<a class="code" href="classHeartConfig.html#a894d374015f888c2111ec252134395fc">IsSimulationDefined</a>())
<a name="l00681"></a>00681     {
<a name="l00682"></a>00682         <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a>(callingMethod + <span class="stringliteral">&quot; information is not available in a standard (non-resumed) simulation.&quot;</span>);
<a name="l00683"></a>00683     }
<a name="l00684"></a>00684 }
<a name="l00685"></a>00685 
<a name="l00686"></a><a class="code" href="classHeartConfig.html#a4170d162538ec096d7df103f5781a998">00686</a> <span class="keywordtype">unsigned</span> <a class="code" href="classHeartConfig.html#a4170d162538ec096d7df103f5781a998">HeartConfig::GetSpaceDimension</a>()<span class="keyword"> const</span>
<a name="l00687"></a>00687 <span class="keyword"></span>{
<a name="l00688"></a>00688     <span class="keywordflow">if</span> (<a class="code" href="classHeartConfig.html#a894d374015f888c2111ec252134395fc">IsSimulationDefined</a>())
<a name="l00689"></a>00689     {
<a name="l00690"></a>00690         CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;SpaceDimension().present(), <span class="stringliteral">&quot;Simulation/SpaceDimension&quot;</span>);
<a name="l00691"></a>00691         <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;SpaceDimension().get();
<a name="l00692"></a>00692     }
<a name="l00693"></a>00693     <span class="keywordflow">else</span>
<a name="l00694"></a>00694     {
<a name="l00695"></a>00695         <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;ResumeSimulation()-&gt;SpaceDimension();
<a name="l00696"></a>00696     }
<a name="l00697"></a>00697 }
<a name="l00698"></a>00698 
<a name="l00699"></a><a class="code" href="classHeartConfig.html#ad3e460b2f9f263ec6ac04fda60197780">00699</a> <span class="keywordtype">double</span> <a class="code" href="classHeartConfig.html#ad3e460b2f9f263ec6ac04fda60197780">HeartConfig::GetSimulationDuration</a>()<span class="keyword"> const</span>
<a name="l00700"></a>00700 <span class="keyword"></span>{
<a name="l00701"></a>00701     <span class="keywordflow">if</span> (<a class="code" href="classHeartConfig.html#a894d374015f888c2111ec252134395fc">IsSimulationDefined</a>())
<a name="l00702"></a>00702     {
<a name="l00703"></a>00703         CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;SimulationDuration().present(), <span class="stringliteral">&quot;Simulation/SimulationDuration&quot;</span>);
<a name="l00704"></a>00704         <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;SimulationDuration().get();
<a name="l00705"></a>00705     }
<a name="l00706"></a>00706     <span class="keywordflow">else</span> <span class="comment">// IsSimulationResumed</span>
<a name="l00707"></a>00707     {
<a name="l00708"></a>00708         <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;ResumeSimulation()-&gt;SimulationDuration();
<a name="l00709"></a>00709     }
<a name="l00710"></a>00710 }
<a name="l00711"></a>00711 
<a name="l00712"></a><a class="code" href="classHeartConfig.html#a493a8d7316bd8e257459ec0372fd8706">00712</a> cp::domain_type <a class="code" href="classHeartConfig.html#a493a8d7316bd8e257459ec0372fd8706">HeartConfig::GetDomain</a>()<span class="keyword"> const</span>
<a name="l00713"></a>00713 <span class="keyword"></span>{
<a name="l00714"></a>00714     <span class="keywordflow">if</span> (<a class="code" href="classHeartConfig.html#a894d374015f888c2111ec252134395fc">IsSimulationDefined</a>())
<a name="l00715"></a>00715     {
<a name="l00716"></a>00716         CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Domain().present(), <span class="stringliteral">&quot;Simulation/Domain&quot;</span>);
<a name="l00717"></a>00717         <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Domain().get();
<a name="l00718"></a>00718     }
<a name="l00719"></a>00719     <span class="keywordflow">else</span>
<a name="l00720"></a>00720     {
<a name="l00721"></a>00721         <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;ResumeSimulation()-&gt;Domain();
<a name="l00722"></a>00722     }
<a name="l00723"></a>00723 }
<a name="l00724"></a>00724 
<a name="l00725"></a><a class="code" href="classHeartConfig.html#a3b1e0fb27bd34fa487627bf80c2b9c57">00725</a> cp::ionic_model_selection_type <a class="code" href="classHeartConfig.html#a3b1e0fb27bd34fa487627bf80c2b9c57">HeartConfig::GetDefaultIonicModel</a>()<span class="keyword"> const</span>
<a name="l00726"></a>00726 <span class="keyword"></span>{
<a name="l00727"></a>00727     <a class="code" href="classHeartConfig.html#aab7ea75d3f83c1202127db592d934532">CheckSimulationIsDefined</a>(<span class="stringliteral">&quot;DefaultIonicModel&quot;</span>);
<a name="l00728"></a>00728 
<a name="l00729"></a>00729     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;IonicModels()-&gt;Default();
<a name="l00730"></a>00730 }
<a name="l00731"></a>00731 
<a name="l00732"></a>00732 <span class="keyword">template</span>&lt;<span class="keywordtype">unsigned</span> DIM&gt;
<a name="l00733"></a><a class="code" href="classHeartConfig.html#a4288665669f3eb349b84de0e1d95acdc">00733</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a4288665669f3eb349b84de0e1d95acdc">HeartConfig::GetIonicModelRegions</a>(std::vector&lt;boost::shared_ptr&lt;<a class="code" href="classAbstractChasteRegion.html">AbstractChasteRegion&lt;DIM&gt;</a> &gt; &gt;&amp; definedRegions,
<a name="l00734"></a>00734                                        std::vector&lt;cp::ionic_model_selection_type&gt;&amp; ionicModels)<span class="keyword"> const</span>
<a name="l00735"></a>00735 <span class="keyword"></span>{
<a name="l00736"></a>00736     <a class="code" href="classHeartConfig.html#aab7ea75d3f83c1202127db592d934532">CheckSimulationIsDefined</a>(<span class="stringliteral">&quot;IonicModelRegions&quot;</span>);
<a name="l00737"></a>00737     definedRegions.clear();
<a name="l00738"></a>00738     ionicModels.clear();
<a name="l00739"></a>00739 
<a name="l00740"></a>00740     XSD_SEQUENCE_TYPE(cp::ionic_models_type::Region)&amp;
<a name="l00741"></a>00741          regions = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;IonicModels()-&gt;Region();
<a name="l00742"></a>00742 
<a name="l00743"></a>00743     <span class="keywordflow">for</span> (XSD_ITERATOR_TYPE(cp::ionic_models_type::Region) i = regions.begin();
<a name="l00744"></a>00744          i != regions.end();
<a name="l00745"></a>00745          ++i)
<a name="l00746"></a>00746     {
<a name="l00747"></a>00747         cp::ionic_model_region_type ionic_model_region(*i);
<a name="l00748"></a>00748 
<a name="l00749"></a>00749         <span class="keywordflow">if</span> (ionic_model_region.Location().Cuboid().present() || ionic_model_region.Location().Ellipsoid().present())
<a name="l00750"></a>00750         {
<a name="l00751"></a>00751             <span class="keywordflow">if</span> (ionic_model_region.Location().Cuboid().present())
<a name="l00752"></a>00752             {
<a name="l00753"></a>00753                 cp::point_type point_a = ionic_model_region.Location().Cuboid()-&gt;LowerCoordinates();
<a name="l00754"></a>00754                 cp::point_type point_b = ionic_model_region.Location().Cuboid()-&gt;UpperCoordinates();
<a name="l00755"></a>00755 
<a name="l00756"></a>00756                 <span class="keywordflow">switch</span> (DIM)
<a name="l00757"></a>00757                 {
<a name="l00758"></a>00758                     <span class="keywordflow">case</span> 1:
<a name="l00759"></a>00759                     {
<a name="l00760"></a>00760                         <a class="code" href="classChastePoint.html">ChastePoint&lt;DIM&gt;</a> chaste_point_a ( point_a.x() );
<a name="l00761"></a>00761                         <a class="code" href="classChastePoint.html">ChastePoint&lt;DIM&gt;</a> chaste_point_b ( point_b.x() );
<a name="l00762"></a>00762                         definedRegions.push_back(boost::shared_ptr&lt;<a class="code" href="classAbstractChasteRegion.html">AbstractChasteRegion&lt;DIM&gt;</a> &gt;(<span class="keyword">new</span> <a class="code" href="classChasteCuboid.html">ChasteCuboid&lt;DIM&gt;</a>( chaste_point_a, chaste_point_b )));
<a name="l00763"></a>00763                         <span class="keywordflow">break</span>;
<a name="l00764"></a>00764                     }
<a name="l00765"></a>00765                     <span class="keywordflow">case</span> 2:
<a name="l00766"></a>00766                     {
<a name="l00767"></a>00767                         <a class="code" href="classChastePoint.html">ChastePoint&lt;DIM&gt;</a> chaste_point_a ( point_a.x(), point_a.y() );
<a name="l00768"></a>00768                         <a class="code" href="classChastePoint.html">ChastePoint&lt;DIM&gt;</a> chaste_point_b ( point_b.x(), point_b.y() );
<a name="l00769"></a>00769                         definedRegions.push_back(boost::shared_ptr&lt;<a class="code" href="classAbstractChasteRegion.html">AbstractChasteRegion&lt;DIM&gt;</a> &gt;(<span class="keyword">new</span> <a class="code" href="classChasteCuboid.html">ChasteCuboid&lt;DIM&gt;</a>( chaste_point_a, chaste_point_b )));
<a name="l00770"></a>00770                         <span class="keywordflow">break</span>;
<a name="l00771"></a>00771                     }
<a name="l00772"></a>00772                     <span class="keywordflow">case</span> 3:
<a name="l00773"></a>00773                     {
<a name="l00774"></a>00774                         <a class="code" href="classChastePoint.html">ChastePoint&lt;DIM&gt;</a> chaste_point_a ( point_a.x(), point_a.y(), point_a.z() );
<a name="l00775"></a>00775                         <a class="code" href="classChastePoint.html">ChastePoint&lt;DIM&gt;</a> chaste_point_b ( point_b.x(), point_b.y(), point_b.z() );
<a name="l00776"></a>00776                         definedRegions.push_back(boost::shared_ptr&lt;<a class="code" href="classAbstractChasteRegion.html">AbstractChasteRegion&lt;DIM&gt;</a> &gt;(<span class="keyword">new</span> <a class="code" href="classChasteCuboid.html">ChasteCuboid&lt;DIM&gt;</a>( chaste_point_a, chaste_point_b )) );
<a name="l00777"></a>00777                         <span class="keywordflow">break</span>;
<a name="l00778"></a>00778                     }
<a name="l00779"></a>00779                     <span class="keywordflow">default</span>:
<a name="l00780"></a>00780                         <a class="code" href="Exception_8hpp.html#ae0019d0a062e0daca4aa9b982d8f6ac4">NEVER_REACHED</a>;
<a name="l00781"></a>00781                         <span class="keywordflow">break</span>;
<a name="l00782"></a>00782                 }
<a name="l00783"></a>00783             }
<a name="l00784"></a>00784             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ionic_model_region.Location().Ellipsoid().present())
<a name="l00785"></a>00785             {
<a name="l00786"></a>00786                 cp::point_type centre = ionic_model_region.Location().Ellipsoid()-&gt;Centre();
<a name="l00787"></a>00787                 cp::point_type radii  = ionic_model_region.Location().Ellipsoid()-&gt;Radii();
<a name="l00788"></a>00788                 <span class="keywordflow">switch</span> (DIM)
<a name="l00789"></a>00789                 {
<a name="l00790"></a>00790                     <span class="keywordflow">case</span> 1:
<a name="l00791"></a>00791                     {
<a name="l00792"></a>00792                         <a class="code" href="classChastePoint.html">ChastePoint&lt;DIM&gt;</a> chaste_point_a ( centre.x() );
<a name="l00793"></a>00793                         <a class="code" href="classChastePoint.html">ChastePoint&lt;DIM&gt;</a> chaste_point_b ( radii.x() );
<a name="l00794"></a>00794                         definedRegions.push_back(boost::shared_ptr&lt;<a class="code" href="classAbstractChasteRegion.html">AbstractChasteRegion&lt;DIM&gt;</a> &gt;(<span class="keyword">new</span> <a class="code" href="classChasteEllipsoid.html">ChasteEllipsoid&lt;DIM&gt;</a> ( chaste_point_a, chaste_point_b )) );
<a name="l00795"></a>00795                         <span class="keywordflow">break</span>;
<a name="l00796"></a>00796                     }
<a name="l00797"></a>00797                     <span class="keywordflow">case</span> 2:
<a name="l00798"></a>00798                     {
<a name="l00799"></a>00799                         <a class="code" href="classChastePoint.html">ChastePoint&lt;DIM&gt;</a> chaste_point_a ( centre.x(), centre.y() );
<a name="l00800"></a>00800                         <a class="code" href="classChastePoint.html">ChastePoint&lt;DIM&gt;</a> chaste_point_b ( radii.x(), radii.y() );
<a name="l00801"></a>00801                         definedRegions.push_back(boost::shared_ptr&lt;<a class="code" href="classAbstractChasteRegion.html">AbstractChasteRegion&lt;DIM&gt;</a> &gt;(<span class="keyword">new</span> <a class="code" href="classChasteEllipsoid.html">ChasteEllipsoid&lt;DIM&gt;</a> ( chaste_point_a, chaste_point_b )) );
<a name="l00802"></a>00802                         <span class="keywordflow">break</span>;
<a name="l00803"></a>00803                     }
<a name="l00804"></a>00804                     <span class="keywordflow">case</span> 3:
<a name="l00805"></a>00805                     {
<a name="l00806"></a>00806                         <a class="code" href="classChastePoint.html">ChastePoint&lt;DIM&gt;</a> chaste_point_a ( centre.x(), centre.y(), centre.z() );
<a name="l00807"></a>00807                         <a class="code" href="classChastePoint.html">ChastePoint&lt;DIM&gt;</a> chaste_point_b ( radii.x(), radii.y(), radii.z() );
<a name="l00808"></a>00808                         definedRegions.push_back(boost::shared_ptr&lt;<a class="code" href="classAbstractChasteRegion.html">AbstractChasteRegion&lt;DIM&gt;</a> &gt;(<span class="keyword">new</span> <a class="code" href="classChasteEllipsoid.html">ChasteEllipsoid&lt;DIM&gt;</a> ( chaste_point_a, chaste_point_b )) );
<a name="l00809"></a>00809                         <span class="keywordflow">break</span>;
<a name="l00810"></a>00810                     }
<a name="l00811"></a>00811                     <span class="keywordflow">default</span>:
<a name="l00812"></a>00812                     {
<a name="l00813"></a>00813                         <a class="code" href="Exception_8hpp.html#ae0019d0a062e0daca4aa9b982d8f6ac4">NEVER_REACHED</a>;
<a name="l00814"></a>00814                         <span class="keywordflow">break</span>;
<a name="l00815"></a>00815                     }
<a name="l00816"></a>00816                 }
<a name="l00817"></a>00817             }
<a name="l00818"></a>00818             <span class="keywordflow">else</span>
<a name="l00819"></a>00819             {
<a name="l00820"></a>00820                 <a class="code" href="Exception_8hpp.html#ae0019d0a062e0daca4aa9b982d8f6ac4">NEVER_REACHED</a>;
<a name="l00821"></a>00821             }
<a name="l00822"></a>00822 
<a name="l00823"></a>00823             ionicModels.push_back(ionic_model_region.IonicModel());
<a name="l00824"></a>00824         }
<a name="l00825"></a>00825         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ionic_model_region.Location().EpiLayer().present() || ionic_model_region.Location().MidLayer().present() || ionic_model_region.Location().EndoLayer().present() )
<a name="l00826"></a>00826         {
<a name="l00828"></a>00828             <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a>(<span class="stringliteral">&quot;Definition of transmural layers is not yet supported for defining different ionic models, please use cuboids instead&quot;</span>);
<a name="l00829"></a>00829         }
<a name="l00830"></a>00830         <span class="keywordflow">else</span>
<a name="l00831"></a>00831         {
<a name="l00832"></a>00832             <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a>(<span class="stringliteral">&quot;Invalid region type for ionic model definition&quot;</span>);
<a name="l00833"></a>00833         }
<a name="l00834"></a>00834     }
<a name="l00835"></a>00835 }
<a name="l00836"></a>00836 
<a name="l00837"></a>00837 
<a name="l00838"></a><a class="code" href="classHeartConfig.html#a1f847d3789d27d2c4ac4adc8010fe311">00838</a> <span class="keywordtype">bool</span> <a class="code" href="classHeartConfig.html#a1f847d3789d27d2c4ac4adc8010fe311">HeartConfig::IsMeshProvided</a>()<span class="keyword"> const</span>
<a name="l00839"></a>00839 <span class="keyword"></span>{
<a name="l00840"></a>00840     <a class="code" href="classHeartConfig.html#aab7ea75d3f83c1202127db592d934532">CheckSimulationIsDefined</a>(<span class="stringliteral">&quot;Mesh&quot;</span>);
<a name="l00841"></a>00841     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Mesh().present();
<a name="l00842"></a>00842 }
<a name="l00843"></a>00843 
<a name="l00844"></a><a class="code" href="classHeartConfig.html#afba7fca19523a0e6a3c2037b165dba92">00844</a> <span class="keywordtype">bool</span> <a class="code" href="classHeartConfig.html#afba7fca19523a0e6a3c2037b165dba92">HeartConfig::GetCreateMesh</a>()<span class="keyword"> const</span>
<a name="l00845"></a>00845 <span class="keyword"></span>{
<a name="l00846"></a>00846     <a class="code" href="classHeartConfig.html#aab7ea75d3f83c1202127db592d934532">CheckSimulationIsDefined</a>(<span class="stringliteral">&quot;Mesh&quot;</span>);
<a name="l00847"></a>00847     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a1f847d3789d27d2c4ac4adc8010fe311">IsMeshProvided</a>(), <span class="stringliteral">&quot;Simulation/Mesh&quot;</span>);
<a name="l00848"></a>00848     cp::mesh_type <a class="code" href="structmesh.html">mesh</a> = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Mesh().get();
<a name="l00849"></a>00849     <span class="keywordflow">return</span> (mesh.Slab().present() || mesh.Sheet().present() || mesh.Fibre().present());
<a name="l00850"></a>00850 }
<a name="l00851"></a>00851 
<a name="l00852"></a><a class="code" href="classHeartConfig.html#ac5ed721756c4f02416abe35847591af3">00852</a> <span class="keywordtype">bool</span> <a class="code" href="classHeartConfig.html#ac5ed721756c4f02416abe35847591af3">HeartConfig::GetCreateSlab</a>()<span class="keyword"> const</span>
<a name="l00853"></a>00853 <span class="keyword"></span>{
<a name="l00854"></a>00854     <a class="code" href="classHeartConfig.html#aab7ea75d3f83c1202127db592d934532">CheckSimulationIsDefined</a>(<span class="stringliteral">&quot;Mesh&quot;</span>);
<a name="l00855"></a>00855     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a1f847d3789d27d2c4ac4adc8010fe311">IsMeshProvided</a>(), <span class="stringliteral">&quot;Simulation/Mesh&quot;</span>);
<a name="l00856"></a>00856     cp::mesh_type <a class="code" href="structmesh.html">mesh</a> = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Mesh().get();
<a name="l00857"></a>00857     <span class="keywordflow">return</span> (mesh.Slab().present());
<a name="l00858"></a>00858 }
<a name="l00859"></a>00859 
<a name="l00860"></a><a class="code" href="classHeartConfig.html#a60ed4f42ad75ecb04db166120540f387">00860</a> <span class="keywordtype">bool</span> <a class="code" href="classHeartConfig.html#a60ed4f42ad75ecb04db166120540f387">HeartConfig::GetCreateSheet</a>()<span class="keyword"> const</span>
<a name="l00861"></a>00861 <span class="keyword"></span>{
<a name="l00862"></a>00862     <a class="code" href="classHeartConfig.html#aab7ea75d3f83c1202127db592d934532">CheckSimulationIsDefined</a>(<span class="stringliteral">&quot;Mesh&quot;</span>);
<a name="l00863"></a>00863     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a1f847d3789d27d2c4ac4adc8010fe311">IsMeshProvided</a>(), <span class="stringliteral">&quot;Simulation/Mesh&quot;</span>);
<a name="l00864"></a>00864     cp::mesh_type <a class="code" href="structmesh.html">mesh</a> = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Mesh().get();
<a name="l00865"></a>00865     <span class="keywordflow">return</span> (mesh.Sheet().present());
<a name="l00866"></a>00866 }
<a name="l00867"></a>00867 
<a name="l00868"></a><a class="code" href="classHeartConfig.html#abb6c5c1d7b12371e13c65db55e4d054c">00868</a> <span class="keywordtype">bool</span> <a class="code" href="classHeartConfig.html#abb6c5c1d7b12371e13c65db55e4d054c">HeartConfig::GetCreateFibre</a>()<span class="keyword"> const</span>
<a name="l00869"></a>00869 <span class="keyword"></span>{
<a name="l00870"></a>00870     <a class="code" href="classHeartConfig.html#aab7ea75d3f83c1202127db592d934532">CheckSimulationIsDefined</a>(<span class="stringliteral">&quot;Mesh&quot;</span>);
<a name="l00871"></a>00871     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a1f847d3789d27d2c4ac4adc8010fe311">IsMeshProvided</a>(), <span class="stringliteral">&quot;Simulation/Mesh&quot;</span>);
<a name="l00872"></a>00872     cp::mesh_type <a class="code" href="structmesh.html">mesh</a> = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Mesh().get();
<a name="l00873"></a>00873     <span class="keywordflow">return</span> (mesh.Fibre().present());
<a name="l00874"></a>00874 }
<a name="l00875"></a>00875 
<a name="l00876"></a>00876 
<a name="l00877"></a><a class="code" href="classHeartConfig.html#a9624dfc37c6c70cb92826ea3677bd905">00877</a> <span class="keywordtype">bool</span> <a class="code" href="classHeartConfig.html#a9624dfc37c6c70cb92826ea3677bd905">HeartConfig::GetLoadMesh</a>()<span class="keyword"> const</span>
<a name="l00878"></a>00878 <span class="keyword"></span>{
<a name="l00879"></a>00879     <a class="code" href="classHeartConfig.html#aab7ea75d3f83c1202127db592d934532">CheckSimulationIsDefined</a>(<span class="stringliteral">&quot;Mesh&quot;</span>);
<a name="l00880"></a>00880     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a1f847d3789d27d2c4ac4adc8010fe311">IsMeshProvided</a>(), <span class="stringliteral">&quot;Simulation/Mesh&quot;</span>);
<a name="l00881"></a>00881     <span class="keywordflow">return</span> (<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Mesh()-&gt;LoadMesh().present());
<a name="l00882"></a>00882 }
<a name="l00883"></a>00883 
<a name="l00884"></a><a class="code" href="classHeartConfig.html#aca214e0a3a7aefaa8694e602a6346dc7">00884</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#aca214e0a3a7aefaa8694e602a6346dc7">HeartConfig::GetSlabDimensions</a>(c_vector&lt;double, 3&gt;&amp; slabDimensions)<span class="keyword"> const</span>
<a name="l00885"></a>00885 <span class="keyword"></span>{
<a name="l00886"></a>00886     <a class="code" href="classHeartConfig.html#aab7ea75d3f83c1202127db592d934532">CheckSimulationIsDefined</a>(<span class="stringliteral">&quot;Slab&quot;</span>);
<a name="l00887"></a>00887 
<a name="l00888"></a>00888     <span class="keywordflow">if</span> (<a class="code" href="classHeartConfig.html#a4170d162538ec096d7df103f5781a998">GetSpaceDimension</a>()!=3 || !<a class="code" href="classHeartConfig.html#ac5ed721756c4f02416abe35847591af3">GetCreateSlab</a>())
<a name="l00889"></a>00889     {
<a name="l00890"></a>00890         <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a>(<span class="stringliteral">&quot;Tissue slabs can only be defined in 3D&quot;</span>);
<a name="l00891"></a>00891     }
<a name="l00892"></a>00892 
<a name="l00893"></a>00893     optional&lt;cp::slab_type, false&gt; slab_dimensions = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Mesh()-&gt;Slab();
<a name="l00894"></a>00894 
<a name="l00895"></a>00895     slabDimensions[0] = slab_dimensions-&gt;x();
<a name="l00896"></a>00896     slabDimensions[1] = slab_dimensions-&gt;y();
<a name="l00897"></a>00897     slabDimensions[2] = slab_dimensions-&gt;z();
<a name="l00898"></a>00898 }
<a name="l00899"></a>00899 
<a name="l00900"></a><a class="code" href="classHeartConfig.html#a63918706b7ce417121fc7dc198f6ef94">00900</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a63918706b7ce417121fc7dc198f6ef94">HeartConfig::GetSheetDimensions</a>(c_vector&lt;double, 2&gt;&amp; sheetDimensions)<span class="keyword"> const</span>
<a name="l00901"></a>00901 <span class="keyword"></span>{
<a name="l00902"></a>00902     <a class="code" href="classHeartConfig.html#aab7ea75d3f83c1202127db592d934532">CheckSimulationIsDefined</a>(<span class="stringliteral">&quot;Sheet&quot;</span>);
<a name="l00903"></a>00903 
<a name="l00904"></a>00904     <span class="keywordflow">if</span> (<a class="code" href="classHeartConfig.html#a4170d162538ec096d7df103f5781a998">GetSpaceDimension</a>()!=2 || !<a class="code" href="classHeartConfig.html#a60ed4f42ad75ecb04db166120540f387">GetCreateSheet</a>())
<a name="l00905"></a>00905     {
<a name="l00906"></a>00906         <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a>(<span class="stringliteral">&quot;Tissue sheets can only be defined in 2D&quot;</span>);
<a name="l00907"></a>00907     }
<a name="l00908"></a>00908 
<a name="l00909"></a>00909     optional&lt;cp::sheet_type, false&gt; sheet_dimensions = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Mesh()-&gt;Sheet();
<a name="l00910"></a>00910 
<a name="l00911"></a>00911     sheetDimensions[0] = sheet_dimensions-&gt;x();
<a name="l00912"></a>00912     sheetDimensions[1] = sheet_dimensions-&gt;y();
<a name="l00913"></a>00913 }
<a name="l00914"></a>00914 
<a name="l00915"></a><a class="code" href="classHeartConfig.html#a0ee95147168ddacf8a17a92c17101ced">00915</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a0ee95147168ddacf8a17a92c17101ced">HeartConfig::GetFibreLength</a>(c_vector&lt;double, 1&gt;&amp; fibreLength)<span class="keyword"> const</span>
<a name="l00916"></a>00916 <span class="keyword"></span>{
<a name="l00917"></a>00917     <a class="code" href="classHeartConfig.html#aab7ea75d3f83c1202127db592d934532">CheckSimulationIsDefined</a>(<span class="stringliteral">&quot;Fibre&quot;</span>);
<a name="l00918"></a>00918 
<a name="l00919"></a>00919     <span class="keywordflow">if</span> (<a class="code" href="classHeartConfig.html#a4170d162538ec096d7df103f5781a998">GetSpaceDimension</a>()!=1 || !<a class="code" href="classHeartConfig.html#abb6c5c1d7b12371e13c65db55e4d054c">GetCreateFibre</a>())
<a name="l00920"></a>00920     {
<a name="l00921"></a>00921         <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a>(<span class="stringliteral">&quot;Tissue fibres can only be defined in 1D&quot;</span>);
<a name="l00922"></a>00922     }
<a name="l00923"></a>00923 
<a name="l00924"></a>00924     optional&lt;cp::fibre_type, false&gt; fibre_length = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Mesh()-&gt;Fibre();
<a name="l00925"></a>00925 
<a name="l00926"></a>00926     fibreLength[0] = fibre_length-&gt;x();
<a name="l00927"></a>00927 }
<a name="l00928"></a>00928 
<a name="l00929"></a><a class="code" href="classHeartConfig.html#a3d0e9ad0966d4cee984223e904c68092">00929</a> <span class="keywordtype">double</span> <a class="code" href="classHeartConfig.html#a3d0e9ad0966d4cee984223e904c68092">HeartConfig::GetInterNodeSpace</a>()<span class="keyword"> const</span>
<a name="l00930"></a>00930 <span class="keyword"></span>{
<a name="l00931"></a>00931     <a class="code" href="classHeartConfig.html#aab7ea75d3f83c1202127db592d934532">CheckSimulationIsDefined</a>(<span class="stringliteral">&quot;InterNodeSpace&quot;</span>);
<a name="l00932"></a>00932 
<a name="l00933"></a>00933     <span class="keywordflow">switch</span> (<a class="code" href="classHeartConfig.html#a4170d162538ec096d7df103f5781a998">GetSpaceDimension</a>())
<a name="l00934"></a>00934     {
<a name="l00935"></a>00935         <span class="keywordflow">case</span> 3:
<a name="l00936"></a>00936             CHECK_EXISTS(<a class="code" href="classHeartConfig.html#ac5ed721756c4f02416abe35847591af3">GetCreateSlab</a>(), <span class="stringliteral">&quot;Simulation/Mesh/Slab&quot;</span>);
<a name="l00937"></a>00937             <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Mesh()-&gt;Slab()-&gt;inter_node_space();
<a name="l00938"></a>00938             <span class="keywordflow">break</span>;
<a name="l00939"></a>00939         <span class="keywordflow">case</span> 2:
<a name="l00940"></a>00940             CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a60ed4f42ad75ecb04db166120540f387">GetCreateSheet</a>(), <span class="stringliteral">&quot;Simulation/Mesh/Sheet&quot;</span>);
<a name="l00941"></a>00941             <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Mesh()-&gt;Sheet()-&gt;inter_node_space();
<a name="l00942"></a>00942             <span class="keywordflow">break</span>;
<a name="l00943"></a>00943         <span class="keywordflow">case</span> 1:
<a name="l00944"></a>00944             CHECK_EXISTS(<a class="code" href="classHeartConfig.html#abb6c5c1d7b12371e13c65db55e4d054c">GetCreateFibre</a>(), <span class="stringliteral">&quot;Simulation/Mesh/Fibre&quot;</span>);
<a name="l00945"></a>00945             <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Mesh()-&gt;Fibre()-&gt;inter_node_space();
<a name="l00946"></a>00946             <span class="keywordflow">break</span>;
<a name="l00947"></a>00947         <span class="keywordflow">default</span>:
<a name="l00948"></a>00948             <a class="code" href="Exception_8hpp.html#ae0019d0a062e0daca4aa9b982d8f6ac4">NEVER_REACHED</a>;
<a name="l00949"></a>00949 <span class="preprocessor">#define COVERAGE_IGNORE</span>
<a name="l00950"></a>00950 <span class="preprocessor"></span>            <span class="keywordflow">return</span> 0.0; <span class="comment">//To fool the compiler</span>
<a name="l00951"></a>00951 <span class="preprocessor">#undef COVERAGE_IGNORE</span>
<a name="l00952"></a>00952 <span class="preprocessor"></span>    }
<a name="l00953"></a>00953 }
<a name="l00954"></a>00954 
<a name="l00955"></a><a class="code" href="classHeartConfig.html#a474d5fef81b34e7ecf4182008289b381">00955</a> std::string <a class="code" href="classHeartConfig.html#a474d5fef81b34e7ecf4182008289b381">HeartConfig::GetMeshName</a>()<span class="keyword"> const</span>
<a name="l00956"></a>00956 <span class="keyword"></span>{
<a name="l00957"></a>00957     <a class="code" href="classHeartConfig.html#aab7ea75d3f83c1202127db592d934532">CheckSimulationIsDefined</a>(<span class="stringliteral">&quot;LoadMesh&quot;</span>);
<a name="l00958"></a>00958     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a9624dfc37c6c70cb92826ea3677bd905">GetLoadMesh</a>(), <span class="stringliteral">&quot;Mesh/LoadMesh&quot;</span>);
<a name="l00959"></a>00959 
<a name="l00960"></a>00960     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Mesh()-&gt;LoadMesh()-&gt;name();
<a name="l00961"></a>00961 }
<a name="l00962"></a>00962 
<a name="l00963"></a><a class="code" href="classHeartConfig.html#a40117fc56c45d408cdd57a1e3538b989">00963</a> cp::media_type <a class="code" href="classHeartConfig.html#a40117fc56c45d408cdd57a1e3538b989">HeartConfig::GetConductivityMedia</a>()<span class="keyword"> const</span>
<a name="l00964"></a>00964 <span class="keyword"></span>{
<a name="l00965"></a>00965     <a class="code" href="classHeartConfig.html#aab7ea75d3f83c1202127db592d934532">CheckSimulationIsDefined</a>(<span class="stringliteral">&quot;LoadMesh&quot;</span>);
<a name="l00966"></a>00966     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a9624dfc37c6c70cb92826ea3677bd905">GetLoadMesh</a>(), <span class="stringliteral">&quot;Mesh/LoadMesh&quot;</span>);
<a name="l00967"></a>00967 
<a name="l00968"></a>00968     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Mesh()-&gt;LoadMesh()-&gt;conductivity_media();
<a name="l00969"></a>00969 }
<a name="l00970"></a>00970 
<a name="l00971"></a>00971 <span class="keyword">template</span> &lt;<span class="keywordtype">unsigned</span> DIM&gt;
<a name="l00972"></a><a class="code" href="classHeartConfig.html#a5584b49e988a0d0ee6190ee072fed88f">00972</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a5584b49e988a0d0ee6190ee072fed88f">HeartConfig::GetStimuli</a>(std::vector&lt;boost::shared_ptr&lt;AbstractStimulusFunction&gt; &gt;&amp; rStimuliApplied,
<a name="l00973"></a>00973                              std::vector&lt;boost::shared_ptr&lt;<a class="code" href="classAbstractChasteRegion.html">AbstractChasteRegion&lt;DIM&gt;</a> &gt; &gt;&amp; rStimulatedAreas)<span class="keyword"> const</span>
<a name="l00974"></a>00974 <span class="keyword"></span>{
<a name="l00975"></a>00975     <a class="code" href="classHeartConfig.html#aab7ea75d3f83c1202127db592d934532">CheckSimulationIsDefined</a>(<span class="stringliteral">&quot;Stimuli&quot;</span>);
<a name="l00976"></a>00976 
<a name="l00977"></a>00977     <span class="keywordflow">if</span> (!<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Stimuli().present())
<a name="l00978"></a>00978     {
<a name="l00979"></a>00979         <span class="comment">// Finding no stimuli defined is allowed (although HeartConfigRelatedFactory does</span>
<a name="l00980"></a>00980         <span class="comment">// throw an exception is no stimuli and no electrodes)</span>
<a name="l00981"></a>00981         <span class="keywordflow">return</span>;
<a name="l00982"></a>00982     }
<a name="l00983"></a>00983 
<a name="l00984"></a>00984     XSD_SEQUENCE_TYPE(cp::stimuli_type::Stimulus) stimuli = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Stimuli()-&gt;Stimulus();
<a name="l00985"></a>00985 
<a name="l00986"></a>00986     <span class="keywordflow">for</span> (XSD_ITERATOR_TYPE(cp::stimuli_type::Stimulus) i = stimuli.begin();
<a name="l00987"></a>00987          i != stimuli.end();
<a name="l00988"></a>00988          ++i)
<a name="l00989"></a>00989     {
<a name="l00990"></a>00990         cp::stimulus_type stimulus(*i);
<a name="l00991"></a>00991         <span class="keywordflow">if</span> (stimulus.Location().Cuboid().present() || stimulus.Location().Ellipsoid().present())
<a name="l00992"></a>00992         {
<a name="l00993"></a>00993             boost::shared_ptr&lt;AbstractChasteRegion&lt;DIM&gt; &gt; area_ptr;
<a name="l00994"></a>00994             <span class="keywordflow">if</span> (stimulus.Location().Cuboid().present() )
<a name="l00995"></a>00995             {
<a name="l00996"></a>00996                 cp::point_type point_a = stimulus.Location().Cuboid()-&gt;LowerCoordinates();
<a name="l00997"></a>00997                 cp::point_type point_b = stimulus.Location().Cuboid()-&gt;UpperCoordinates();
<a name="l00998"></a>00998                 <span class="keywordflow">switch</span> (DIM)
<a name="l00999"></a>00999                 {
<a name="l01000"></a>01000                     <span class="keywordflow">case</span> 1:
<a name="l01001"></a>01001                     {
<a name="l01002"></a>01002                         <a class="code" href="classChastePoint.html">ChastePoint&lt;DIM&gt;</a> chaste_point_a ( point_a.x() );
<a name="l01003"></a>01003                         <a class="code" href="classChastePoint.html">ChastePoint&lt;DIM&gt;</a> chaste_point_b ( point_b.x() );
<a name="l01004"></a>01004                         area_ptr.reset(<span class="keyword">new</span> <a class="code" href="classChasteCuboid.html">ChasteCuboid&lt;DIM&gt;</a>( chaste_point_a, chaste_point_b ) );
<a name="l01005"></a>01005                         <span class="keywordflow">break</span>;
<a name="l01006"></a>01006                     }
<a name="l01007"></a>01007                     <span class="keywordflow">case</span> 2:
<a name="l01008"></a>01008                     {
<a name="l01009"></a>01009                         <a class="code" href="classChastePoint.html">ChastePoint&lt;DIM&gt;</a> chaste_point_a ( point_a.x(), point_a.y() );
<a name="l01010"></a>01010                         <a class="code" href="classChastePoint.html">ChastePoint&lt;DIM&gt;</a> chaste_point_b ( point_b.x(), point_b.y() );
<a name="l01011"></a>01011                         area_ptr.reset(<span class="keyword">new</span> <a class="code" href="classChasteCuboid.html">ChasteCuboid&lt;DIM&gt;</a>( chaste_point_a, chaste_point_b ) );
<a name="l01012"></a>01012                         <span class="keywordflow">break</span>;
<a name="l01013"></a>01013                     }
<a name="l01014"></a>01014                     <span class="keywordflow">case</span> 3:
<a name="l01015"></a>01015                     {
<a name="l01016"></a>01016                         <a class="code" href="classChastePoint.html">ChastePoint&lt;DIM&gt;</a> chaste_point_a ( point_a.x(), point_a.y(), point_a.z() );
<a name="l01017"></a>01017                         <a class="code" href="classChastePoint.html">ChastePoint&lt;DIM&gt;</a> chaste_point_b ( point_b.x(), point_b.y(), point_b.z() );
<a name="l01018"></a>01018                         area_ptr.reset(<span class="keyword">new</span> <a class="code" href="classChasteCuboid.html">ChasteCuboid&lt;DIM&gt;</a>( chaste_point_a, chaste_point_b ) );
<a name="l01019"></a>01019                         <span class="keywordflow">break</span>;
<a name="l01020"></a>01020                     }
<a name="l01021"></a>01021                     <span class="keywordflow">default</span>:
<a name="l01022"></a>01022                         <a class="code" href="Exception_8hpp.html#ae0019d0a062e0daca4aa9b982d8f6ac4">NEVER_REACHED</a>;
<a name="l01023"></a>01023                         <span class="keywordflow">break</span>;
<a name="l01024"></a>01024                 }
<a name="l01025"></a>01025             }
<a name="l01026"></a>01026             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stimulus.Location().Ellipsoid().present())
<a name="l01027"></a>01027             {
<a name="l01028"></a>01028                 cp::point_type centre = stimulus.Location().Ellipsoid()-&gt;Centre();
<a name="l01029"></a>01029                 cp::point_type radii  = stimulus.Location().Ellipsoid()-&gt;Radii();
<a name="l01030"></a>01030                 <span class="keywordflow">switch</span> (DIM)
<a name="l01031"></a>01031                 {
<a name="l01032"></a>01032                     <span class="keywordflow">case</span> 1:
<a name="l01033"></a>01033                     {
<a name="l01034"></a>01034                         <a class="code" href="classChastePoint.html">ChastePoint&lt;DIM&gt;</a> chaste_point_a ( centre.x() );
<a name="l01035"></a>01035                         <a class="code" href="classChastePoint.html">ChastePoint&lt;DIM&gt;</a> chaste_point_b ( radii.x() );
<a name="l01036"></a>01036                         area_ptr.reset( <span class="keyword">new</span> <a class="code" href="classChasteEllipsoid.html">ChasteEllipsoid&lt;DIM&gt;</a> ( chaste_point_a, chaste_point_b ) );
<a name="l01037"></a>01037                         <span class="keywordflow">break</span>;
<a name="l01038"></a>01038                     }
<a name="l01039"></a>01039                     <span class="keywordflow">case</span> 2:
<a name="l01040"></a>01040                     {
<a name="l01041"></a>01041                         <a class="code" href="classChastePoint.html">ChastePoint&lt;DIM&gt;</a> chaste_point_a ( centre.x(), centre.y() );
<a name="l01042"></a>01042                         <a class="code" href="classChastePoint.html">ChastePoint&lt;DIM&gt;</a> chaste_point_b ( radii.x(), radii.y() );
<a name="l01043"></a>01043                         area_ptr.reset( <span class="keyword">new</span> <a class="code" href="classChasteEllipsoid.html">ChasteEllipsoid&lt;DIM&gt;</a> ( chaste_point_a, chaste_point_b ) );
<a name="l01044"></a>01044                         <span class="keywordflow">break</span>;
<a name="l01045"></a>01045                     }
<a name="l01046"></a>01046                     <span class="keywordflow">case</span> 3:
<a name="l01047"></a>01047                     {
<a name="l01048"></a>01048                         <a class="code" href="classChastePoint.html">ChastePoint&lt;DIM&gt;</a> chaste_point_a ( centre.x(), centre.y(), centre.z() );
<a name="l01049"></a>01049                         <a class="code" href="classChastePoint.html">ChastePoint&lt;DIM&gt;</a> chaste_point_b ( radii.x(), radii.y(), radii.z() );
<a name="l01050"></a>01050                         area_ptr.reset( <span class="keyword">new</span> <a class="code" href="classChasteEllipsoid.html">ChasteEllipsoid&lt;DIM&gt;</a> ( chaste_point_a, chaste_point_b ) );
<a name="l01051"></a>01051                         <span class="keywordflow">break</span>;
<a name="l01052"></a>01052                     }
<a name="l01053"></a>01053                     <span class="keywordflow">default</span>:
<a name="l01054"></a>01054                     {
<a name="l01055"></a>01055                         <a class="code" href="Exception_8hpp.html#ae0019d0a062e0daca4aa9b982d8f6ac4">NEVER_REACHED</a>;
<a name="l01056"></a>01056                         <span class="keywordflow">break</span>;
<a name="l01057"></a>01057                     }
<a name="l01058"></a>01058                 }
<a name="l01059"></a>01059             }
<a name="l01060"></a>01060             rStimulatedAreas.push_back(area_ptr);
<a name="l01061"></a>01061 
<a name="l01062"></a>01062             boost::shared_ptr&lt;AbstractStimulusFunction&gt; stim;
<a name="l01063"></a>01063 
<a name="l01064"></a>01064             <span class="keywordflow">if</span> (stimulus.Period().present())
<a name="l01065"></a>01065             {
<a name="l01066"></a>01066                 <span class="keywordflow">if</span> (stimulus.StopTime().present())
<a name="l01067"></a>01067                 {
<a name="l01068"></a>01068                     stim.reset(<span class="keyword">new</span> <a class="code" href="classRegularStimulus.html">RegularStimulus</a>(stimulus.Strength(),
<a name="l01069"></a>01069                                                    stimulus.Duration(),
<a name="l01070"></a>01070                                                    stimulus.Period().get(),
<a name="l01071"></a>01071                                                    stimulus.Delay(),
<a name="l01072"></a>01072                                                    stimulus.StopTime().get()));
<a name="l01073"></a>01073                 }
<a name="l01074"></a>01074                 <span class="keywordflow">else</span>
<a name="l01075"></a>01075                 {
<a name="l01076"></a>01076                     stim.reset(<span class="keyword">new</span> <a class="code" href="classRegularStimulus.html">RegularStimulus</a>(stimulus.Strength(),
<a name="l01077"></a>01077                                                    stimulus.Duration(),
<a name="l01078"></a>01078                                                    stimulus.Period().get(),
<a name="l01079"></a>01079                                                    stimulus.Delay()));
<a name="l01080"></a>01080                 }
<a name="l01081"></a>01081 
<a name="l01082"></a>01082             }
<a name="l01083"></a>01083             <span class="keywordflow">else</span>
<a name="l01084"></a>01084             {
<a name="l01085"></a>01085                 <span class="keywordflow">if</span> (stimulus.StopTime().present())
<a name="l01086"></a>01086                 {
<a name="l01087"></a>01087                     <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a>(<span class="stringliteral">&quot;Stop time can not be defined for SimpleStimulus. Use Duration instead.&quot;</span>);
<a name="l01088"></a>01088                 }
<a name="l01089"></a>01089 
<a name="l01090"></a>01090                 stim.reset(<span class="keyword">new</span> <a class="code" href="classSimpleStimulus.html">SimpleStimulus</a>(stimulus.Strength(),
<a name="l01091"></a>01091                                               stimulus.Duration(),
<a name="l01092"></a>01092                                               stimulus.Delay()));
<a name="l01093"></a>01093             }
<a name="l01094"></a>01094             rStimuliApplied.push_back( stim );
<a name="l01095"></a>01095         }
<a name="l01096"></a>01096         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(stimulus.Location().EpiLayer().present() || stimulus.Location().MidLayer().present() || stimulus.Location().EndoLayer().present() )
<a name="l01097"></a>01097         {
<a name="l01098"></a>01098             <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a>(<span class="stringliteral">&quot;Definition of transmural layers is not yet supported for specifying stimulated areas, please use cuboids instead&quot;</span>);
<a name="l01099"></a>01099         }
<a name="l01100"></a>01100         <span class="keywordflow">else</span>
<a name="l01101"></a>01101         {
<a name="l01102"></a>01102             <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a>(<span class="stringliteral">&quot;Invalid region type for stimulus definition&quot;</span>);
<a name="l01103"></a>01103         }
<a name="l01104"></a>01104     }
<a name="l01105"></a>01105 }
<a name="l01106"></a>01106 
<a name="l01107"></a>01107 
<a name="l01108"></a>01108 <span class="keyword">template</span>&lt;<span class="keywordtype">unsigned</span> DIM&gt;
<a name="l01109"></a><a class="code" href="classHeartConfig.html#a1d00319ba61b3e67401f7694b5dbbe61">01109</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a1d00319ba61b3e67401f7694b5dbbe61">HeartConfig::GetCellHeterogeneities</a>(std::vector&lt;boost::shared_ptr&lt;<a class="code" href="classAbstractChasteRegion.html">AbstractChasteRegion&lt;DIM&gt;</a> &gt; &gt;&amp; rCellHeterogeneityRegions,
<a name="l01110"></a>01110                                          std::vector&lt;double&gt;&amp; rScaleFactorGks,
<a name="l01111"></a>01111                                          std::vector&lt;double&gt;&amp; rScaleFactorIto,
<a name="l01112"></a>01112                                          std::vector&lt;double&gt;&amp; rScaleFactorGkr,
<a name="l01113"></a>01113                                          std::vector&lt;std::map&lt;std::string, double&gt; &gt;* pParameterSettings)
<a name="l01114"></a>01114 {
<a name="l01115"></a>01115     <a class="code" href="classHeartConfig.html#aab7ea75d3f83c1202127db592d934532">CheckSimulationIsDefined</a>(<span class="stringliteral">&quot;CellHeterogeneities&quot;</span>);
<a name="l01116"></a>01116 
<a name="l01117"></a>01117     <span class="keywordflow">if</span> (!<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;CellHeterogeneities().present())
<a name="l01118"></a>01118     {
<a name="l01119"></a>01119         <span class="comment">// finding no heterogeneities defined is allowed</span>
<a name="l01120"></a>01120         <span class="keywordflow">return</span>;
<a name="l01121"></a>01121     }
<a name="l01122"></a>01122     XSD_SEQUENCE_TYPE(cp::cell_heterogeneities_type::CellHeterogeneity) cell_heterogeneity
<a name="l01123"></a>01123             = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;CellHeterogeneities()-&gt;CellHeterogeneity();
<a name="l01124"></a>01124 
<a name="l01125"></a>01125     <span class="keywordtype">bool</span> user_supplied_negative_value = <span class="keyword">false</span>;
<a name="l01126"></a>01126     <span class="keywordtype">bool</span> user_asking_for_transmural_layers = <span class="keyword">false</span>;
<a name="l01127"></a>01127     <span class="keywordtype">bool</span> user_asked_for_cuboids_or_ellipsoids = <span class="keyword">false</span>;
<a name="l01128"></a>01128     <span class="keywordtype">unsigned</span> counter_of_heterogeneities = 0;
<a name="l01129"></a>01129 
<a name="l01130"></a>01130     <span class="keywordflow">for</span> (XSD_ITERATOR_TYPE(cp::cell_heterogeneities_type::CellHeterogeneity) i = cell_heterogeneity.begin();
<a name="l01131"></a>01131          i != cell_heterogeneity.end();
<a name="l01132"></a>01132          ++i)
<a name="l01133"></a>01133     {
<a name="l01134"></a>01134         cp::cell_heterogeneity_type ht(*i);
<a name="l01135"></a>01135 
<a name="l01136"></a>01136         <span class="keywordflow">if</span> (ht.Location().Cuboid().present())
<a name="l01137"></a>01137         {
<a name="l01138"></a>01138             user_asked_for_cuboids_or_ellipsoids = <span class="keyword">true</span>;
<a name="l01139"></a>01139             cp::point_type point_a = ht.Location().Cuboid()-&gt;LowerCoordinates();
<a name="l01140"></a>01140             cp::point_type point_b = ht.Location().Cuboid()-&gt;UpperCoordinates();
<a name="l01141"></a>01141 
<a name="l01142"></a>01142             <a class="code" href="classChastePoint.html">ChastePoint&lt;DIM&gt;</a> chaste_point_a ( point_a.x(), point_a.y(), point_a.z() );
<a name="l01143"></a>01143             <a class="code" href="classChastePoint.html">ChastePoint&lt;DIM&gt;</a> chaste_point_b ( point_b.x(), point_b.y(), point_b.z() );
<a name="l01144"></a>01144 
<a name="l01145"></a>01145             rCellHeterogeneityRegions.push_back(boost::shared_ptr&lt;<a class="code" href="classAbstractChasteRegion.html">AbstractChasteRegion&lt;DIM&gt;</a> &gt;(<span class="keyword">new</span> <a class="code" href="classChasteCuboid.html">ChasteCuboid&lt;DIM&gt;</a> ( chaste_point_a, chaste_point_b )) );
<a name="l01146"></a>01146         }
<a name="l01147"></a>01147         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ht.Location().Ellipsoid().present())
<a name="l01148"></a>01148         {
<a name="l01149"></a>01149             user_asked_for_cuboids_or_ellipsoids = <span class="keyword">true</span>;
<a name="l01150"></a>01150             cp::point_type centre = ht.Location().Ellipsoid()-&gt;Centre();
<a name="l01151"></a>01151             cp::point_type radii  = ht.Location().Ellipsoid()-&gt;Radii();
<a name="l01152"></a>01152 
<a name="l01153"></a>01153             <a class="code" href="classChastePoint.html">ChastePoint&lt;DIM&gt;</a> chaste_point_a ( centre.x(), centre.y(), centre.z() );
<a name="l01154"></a>01154             <a class="code" href="classChastePoint.html">ChastePoint&lt;DIM&gt;</a> chaste_point_b ( radii.x(), radii.y(), radii.z() );
<a name="l01155"></a>01155             rCellHeterogeneityRegions.push_back(boost::shared_ptr&lt;<a class="code" href="classAbstractChasteRegion.html">AbstractChasteRegion&lt;DIM&gt;</a> &gt;(<span class="keyword">new</span> <a class="code" href="classChasteEllipsoid.html">ChasteEllipsoid&lt;DIM&gt;</a> ( chaste_point_a, chaste_point_b )) );
<a name="l01156"></a>01156         }
<a name="l01157"></a>01157         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ht.Location().EpiLayer().present())
<a name="l01158"></a>01158         {
<a name="l01159"></a>01159             <a class="code" href="classHeartConfig.html#aefbe15b3fd5d616d98a35dd172608529">mEpiFraction</a>  =  ht.Location().EpiLayer().get();
<a name="l01160"></a>01160 
<a name="l01161"></a>01161             user_asking_for_transmural_layers = <span class="keyword">true</span>;
<a name="l01162"></a>01162             <span class="keywordflow">if</span> (<a class="code" href="classHeartConfig.html#aefbe15b3fd5d616d98a35dd172608529">mEpiFraction</a> &lt;0)
<a name="l01163"></a>01163             {
<a name="l01164"></a>01164                 user_supplied_negative_value=<span class="keyword">true</span>;
<a name="l01165"></a>01165             }
<a name="l01166"></a>01166             <a class="code" href="classHeartConfig.html#ab24f553ab1e97d36b8467f7ca1bcf800">mIndexEpi</a> = counter_of_heterogeneities;
<a name="l01167"></a>01167         }
<a name="l01168"></a>01168         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ht.Location().EndoLayer().present())
<a name="l01169"></a>01169         {
<a name="l01170"></a>01170             <a class="code" href="classHeartConfig.html#a9c9f9fefab6c029324426098740b5bc4">mEndoFraction</a>  =  ht.Location().EndoLayer().get();
<a name="l01171"></a>01171 
<a name="l01172"></a>01172             user_asking_for_transmural_layers = <span class="keyword">true</span>;
<a name="l01173"></a>01173             <span class="keywordflow">if</span> (<a class="code" href="classHeartConfig.html#a9c9f9fefab6c029324426098740b5bc4">mEndoFraction</a> &lt;0)
<a name="l01174"></a>01174             {
<a name="l01175"></a>01175                 user_supplied_negative_value=<span class="keyword">true</span>;
<a name="l01176"></a>01176             }
<a name="l01177"></a>01177             <a class="code" href="classHeartConfig.html#a4785f6ad1c60766c471bcb525eac02d3">mIndexEndo</a> = counter_of_heterogeneities;
<a name="l01178"></a>01178         }
<a name="l01179"></a>01179         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ht.Location().MidLayer().present())
<a name="l01180"></a>01180         {
<a name="l01181"></a>01181             <a class="code" href="classHeartConfig.html#a5648845197c449e58c2c879f7422df3f">mMidFraction</a>  =  ht.Location().MidLayer().get();
<a name="l01182"></a>01182 
<a name="l01183"></a>01183             user_asking_for_transmural_layers = <span class="keyword">true</span>;
<a name="l01184"></a>01184             <span class="keywordflow">if</span> (<a class="code" href="classHeartConfig.html#a5648845197c449e58c2c879f7422df3f">mMidFraction</a> &lt;0)
<a name="l01185"></a>01185             {
<a name="l01186"></a>01186                 user_supplied_negative_value=<span class="keyword">true</span>;
<a name="l01187"></a>01187             }
<a name="l01188"></a>01188             <a class="code" href="classHeartConfig.html#abfdca19b9fc56fe21ef23d2593cc022f">mIndexMid</a> =  counter_of_heterogeneities;
<a name="l01189"></a>01189         }
<a name="l01190"></a>01190         <span class="keywordflow">else</span>
<a name="l01191"></a>01191         {
<a name="l01192"></a>01192             <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a>(<span class="stringliteral">&quot;Invalid region type for cell heterogeneity definition&quot;</span>);
<a name="l01193"></a>01193         }
<a name="l01194"></a>01194 
<a name="l01195"></a>01195         <span class="comment">// Old scale factors</span>
<a name="l01196"></a>01196         rScaleFactorGks.push_back(ht.ScaleFactorGks().present() ? (<a class="code" href="classdouble.html">double</a>)ht.ScaleFactorGks().get() : 1.0);
<a name="l01197"></a>01197         rScaleFactorIto.push_back(ht.ScaleFactorIto().present() ? (<a class="code" href="classdouble.html">double</a>)ht.ScaleFactorIto().get() : 1.0);
<a name="l01198"></a>01198         rScaleFactorGkr.push_back(ht.ScaleFactorGkr().present() ? (<a class="code" href="classdouble.html">double</a>)ht.ScaleFactorGkr().get() : 1.0);
<a name="l01199"></a>01199 
<a name="l01200"></a>01200         <span class="comment">// Named parameters</span>
<a name="l01201"></a>01201         <span class="keywordflow">if</span> (pParameterSettings)
<a name="l01202"></a>01202         {
<a name="l01203"></a>01203             std::map&lt;std::string, double&gt; param_settings;
<a name="l01204"></a>01204             XSD_SEQUENCE_TYPE(cp::cell_heterogeneity_type::SetParameter)&amp; params = ht.SetParameter();
<a name="l01205"></a>01205             <span class="keywordflow">for</span> (XSD_ITERATOR_TYPE(cp::cell_heterogeneity_type::SetParameter) param_it = params.begin();
<a name="l01206"></a>01206                  param_it != params.end();
<a name="l01207"></a>01207                  ++param_it)
<a name="l01208"></a>01208             {
<a name="l01209"></a>01209                 cp::set_parameter_type param(*param_it);
<a name="l01210"></a>01210                 param_settings[param.name()] = param.value();
<a name="l01211"></a>01211             }
<a name="l01212"></a>01212             pParameterSettings-&gt;push_back(param_settings);
<a name="l01213"></a>01213         }
<a name="l01214"></a>01214 
<a name="l01215"></a>01215         counter_of_heterogeneities++;
<a name="l01216"></a>01216     }
<a name="l01217"></a>01217 
<a name="l01218"></a>01218     <span class="comment">//set the flag for request of transmural layers</span>
<a name="l01219"></a>01219     <a class="code" href="classHeartConfig.html#a6ebec0d7deb03099ae581bca114147fb">mUserAskedForCellularTransmuralHeterogeneities</a> = user_asking_for_transmural_layers;
<a name="l01220"></a>01220 
<a name="l01221"></a>01221     <span class="keywordflow">if</span> ( <a class="code" href="classHeartConfig.html#a6ebec0d7deb03099ae581bca114147fb">mUserAskedForCellularTransmuralHeterogeneities</a> )
<a name="l01222"></a>01222     {
<a name="l01223"></a>01223         <span class="comment">// cuboids/ellipsoids and layers at the same time are not yet supported</span>
<a name="l01224"></a>01224         <span class="keywordflow">if</span> (user_asked_for_cuboids_or_ellipsoids )
<a name="l01225"></a>01225         {
<a name="l01226"></a>01226             <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a> (<span class="stringliteral">&quot;Specification of cellular heterogeneities by cuboids/ellipsoids and layers at the same time is not yet supported&quot;</span>);
<a name="l01227"></a>01227         }
<a name="l01228"></a>01228 
<a name="l01229"></a>01229         <span class="comment">//check that the user supplied all three layers, the indexes should be 0, 1 and 2.</span>
<a name="l01230"></a>01230         <span class="comment">// As they are initialised to a higher value, if their summation is higher than 3,</span>
<a name="l01231"></a>01231         <span class="comment">// one (or more) is missing</span>
<a name="l01232"></a>01232         <span class="keywordflow">if</span> ((<a class="code" href="classHeartConfig.html#abfdca19b9fc56fe21ef23d2593cc022f">mIndexMid</a>+<a class="code" href="classHeartConfig.html#a4785f6ad1c60766c471bcb525eac02d3">mIndexEndo</a>+<a class="code" href="classHeartConfig.html#ab24f553ab1e97d36b8467f7ca1bcf800">mIndexEpi</a>) &gt; 3)
<a name="l01233"></a>01233         {
<a name="l01234"></a>01234             <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a> (<span class="stringliteral">&quot;Three specifications of layers must be supplied&quot;</span>);
<a name="l01235"></a>01235         }
<a name="l01236"></a>01236         <span class="keywordflow">if</span> (fabs((<a class="code" href="classHeartConfig.html#a9c9f9fefab6c029324426098740b5bc4">mEndoFraction</a>+<a class="code" href="classHeartConfig.html#a5648845197c449e58c2c879f7422df3f">mMidFraction</a>+<a class="code" href="classHeartConfig.html#aefbe15b3fd5d616d98a35dd172608529">mEpiFraction</a>)-1)&gt;1e-2)
<a name="l01237"></a>01237         {
<a name="l01238"></a>01238             <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a> (<span class="stringliteral">&quot;Summation of epicardial, midmyocardial and endocardial fractions should be 1&quot;</span>);
<a name="l01239"></a>01239         }
<a name="l01240"></a>01240         <span class="keywordflow">if</span> (user_supplied_negative_value)
<a name="l01241"></a>01241         {
<a name="l01242"></a>01242            <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a> (<span class="stringliteral">&quot;Fractions must be positive&quot;</span>);
<a name="l01243"></a>01243         }
<a name="l01244"></a>01244     }
<a name="l01245"></a>01245 }
<a name="l01246"></a>01246 
<a name="l01247"></a><a class="code" href="classHeartConfig.html#a05a43dba4479aecdba22e537105934ce">01247</a> <span class="keywordtype">bool</span> <a class="code" href="classHeartConfig.html#a05a43dba4479aecdba22e537105934ce">HeartConfig::AreCellularTransmuralHeterogeneitiesRequested</a>()
<a name="l01248"></a>01248 {
<a name="l01249"></a>01249     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a6ebec0d7deb03099ae581bca114147fb">mUserAskedForCellularTransmuralHeterogeneities</a>;
<a name="l01250"></a>01250 }
<a name="l01251"></a>01251 
<a name="l01252"></a><a class="code" href="classHeartConfig.html#ac6a311736789413d8f0780f62ff53b41">01252</a> <span class="keywordtype">double</span> <a class="code" href="classHeartConfig.html#ac6a311736789413d8f0780f62ff53b41">HeartConfig::GetEpiLayerFraction</a>()
<a name="l01253"></a>01253 {
<a name="l01254"></a>01254     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#aefbe15b3fd5d616d98a35dd172608529">mEpiFraction</a>;
<a name="l01255"></a>01255 }
<a name="l01256"></a>01256 
<a name="l01257"></a><a class="code" href="classHeartConfig.html#ab27a388cfb3df276617aaae504e7c602">01257</a> <span class="keywordtype">double</span> <a class="code" href="classHeartConfig.html#ab27a388cfb3df276617aaae504e7c602">HeartConfig::GetEndoLayerFraction</a>()
<a name="l01258"></a>01258 {
<a name="l01259"></a>01259     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a9c9f9fefab6c029324426098740b5bc4">mEndoFraction</a>;
<a name="l01260"></a>01260 }
<a name="l01261"></a>01261 
<a name="l01262"></a><a class="code" href="classHeartConfig.html#a40a8c0d11e49c75744f1f46ab350b938">01262</a> <span class="keywordtype">double</span> <a class="code" href="classHeartConfig.html#a40a8c0d11e49c75744f1f46ab350b938">HeartConfig::GetMidLayerFraction</a>()
<a name="l01263"></a>01263 {
<a name="l01264"></a>01264     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a5648845197c449e58c2c879f7422df3f">mMidFraction</a>;
<a name="l01265"></a>01265 }
<a name="l01266"></a>01266 
<a name="l01267"></a><a class="code" href="classHeartConfig.html#a983aa22ea5954f80e4554dedb39361a1">01267</a> <span class="keywordtype">unsigned</span> <a class="code" href="classHeartConfig.html#a983aa22ea5954f80e4554dedb39361a1">HeartConfig::GetEpiLayerIndex</a>()
<a name="l01268"></a>01268 {
<a name="l01269"></a>01269     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#ab24f553ab1e97d36b8467f7ca1bcf800">mIndexEpi</a>;
<a name="l01270"></a>01270 }
<a name="l01271"></a>01271 
<a name="l01272"></a><a class="code" href="classHeartConfig.html#ac929ad5b6b509ffbb76853e5374df9f9">01272</a> <span class="keywordtype">unsigned</span> <a class="code" href="classHeartConfig.html#ac929ad5b6b509ffbb76853e5374df9f9">HeartConfig::GetEndoLayerIndex</a>()
<a name="l01273"></a>01273 {
<a name="l01274"></a>01274     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a4785f6ad1c60766c471bcb525eac02d3">mIndexEndo</a>;
<a name="l01275"></a>01275 }
<a name="l01276"></a>01276 
<a name="l01277"></a><a class="code" href="classHeartConfig.html#a79cca34d2513013d0367b703827302cb">01277</a> <span class="keywordtype">unsigned</span> <a class="code" href="classHeartConfig.html#a79cca34d2513013d0367b703827302cb">HeartConfig::GetMidLayerIndex</a>()
<a name="l01278"></a>01278 {
<a name="l01279"></a>01279     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#abfdca19b9fc56fe21ef23d2593cc022f">mIndexMid</a>;
<a name="l01280"></a>01280 }
<a name="l01281"></a>01281 
<a name="l01282"></a><a class="code" href="classHeartConfig.html#abcf7598b37ec20f65a3033dafafff7dd">01282</a> <span class="keywordtype">bool</span> <a class="code" href="classHeartConfig.html#abcf7598b37ec20f65a3033dafafff7dd">HeartConfig::GetConductivityHeterogeneitiesProvided</a>()<span class="keyword"> const</span>
<a name="l01283"></a>01283 <span class="keyword"></span>{
<a name="l01284"></a>01284     <a class="code" href="classHeartConfig.html#aab7ea75d3f83c1202127db592d934532">CheckSimulationIsDefined</a>(<span class="stringliteral">&quot;ConductivityHeterogeneities&quot;</span>);
<a name="l01285"></a>01285     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().ConductivityHeterogeneities().present();
<a name="l01286"></a>01286 }
<a name="l01287"></a>01287 
<a name="l01288"></a>01288 <span class="keyword">template</span>&lt;<span class="keywordtype">unsigned</span> DIM&gt;
<a name="l01289"></a><a class="code" href="classHeartConfig.html#a2e0c392c5a918fbf00b00c02d66f2ac0">01289</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a2e0c392c5a918fbf00b00c02d66f2ac0">HeartConfig::GetConductivityHeterogeneities</a>(
<a name="l01290"></a>01290         std::vector&lt;boost::shared_ptr&lt;<a class="code" href="classAbstractChasteRegion.html">AbstractChasteRegion&lt;DIM&gt;</a> &gt; &gt;&amp; conductivitiesHeterogeneityAreas,
<a name="l01291"></a>01291         std::vector&lt; c_vector&lt;double,3&gt; &gt;&amp; intraConductivities,
<a name="l01292"></a>01292         std::vector&lt; c_vector&lt;double,3&gt; &gt;&amp; extraConductivities)<span class="keyword"> const</span>
<a name="l01293"></a>01293 <span class="keyword"></span>{
<a name="l01294"></a>01294     <a class="code" href="classHeartConfig.html#aab7ea75d3f83c1202127db592d934532">CheckSimulationIsDefined</a>(<span class="stringliteral">&quot;ConductivityHeterogeneities&quot;</span>);
<a name="l01295"></a>01295     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#abcf7598b37ec20f65a3033dafafff7dd">GetConductivityHeterogeneitiesProvided</a>(), <span class="stringliteral">&quot;Physiological/ConductivityHeterogeneities&quot;</span>);
<a name="l01296"></a>01296     XSD_ANON_SEQUENCE_TYPE(cp::physiological_type, ConductivityHeterogeneities, ConductivityHeterogeneity)&amp;
<a name="l01297"></a>01297          conductivity_heterogeneity = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().ConductivityHeterogeneities()-&gt;ConductivityHeterogeneity();
<a name="l01298"></a>01298 
<a name="l01299"></a>01299     <span class="keywordflow">for</span> (XSD_ANON_ITERATOR_TYPE(cp::physiological_type, ConductivityHeterogeneities, ConductivityHeterogeneity) i = conductivity_heterogeneity.begin();
<a name="l01300"></a>01300          i != conductivity_heterogeneity.end();
<a name="l01301"></a>01301          ++i)
<a name="l01302"></a>01302     {
<a name="l01303"></a>01303         cp::conductivity_heterogeneity_type ht(*i);
<a name="l01304"></a>01304 
<a name="l01305"></a>01305         <span class="keywordflow">if</span> (ht.Location().Cuboid().present())
<a name="l01306"></a>01306         {
<a name="l01307"></a>01307             cp::point_type point_a = ht.Location().Cuboid()-&gt;LowerCoordinates();
<a name="l01308"></a>01308             cp::point_type point_b = ht.Location().Cuboid()-&gt;UpperCoordinates();
<a name="l01309"></a>01309             <a class="code" href="classChastePoint.html">ChastePoint&lt;DIM&gt;</a> chaste_point_a ( point_a.x(), point_a.y(), point_a.z() );
<a name="l01310"></a>01310             <a class="code" href="classChastePoint.html">ChastePoint&lt;DIM&gt;</a> chaste_point_b ( point_b.x(), point_b.y(), point_b.z() );
<a name="l01311"></a>01311             conductivitiesHeterogeneityAreas.push_back(boost::shared_ptr&lt;<a class="code" href="classAbstractChasteRegion.html">AbstractChasteRegion&lt;DIM&gt;</a> &gt;   (  <span class="keyword">new</span> <a class="code" href="classChasteCuboid.html">ChasteCuboid&lt;DIM&gt;</a> ( chaste_point_a, chaste_point_b )) );
<a name="l01312"></a>01312         }
<a name="l01313"></a>01313         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ht.Location().Ellipsoid().present())
<a name="l01314"></a>01314         {
<a name="l01315"></a>01315             cp::point_type centre = ht.Location().Ellipsoid()-&gt;Centre();
<a name="l01316"></a>01316             cp::point_type radii  = ht.Location().Ellipsoid()-&gt;Radii();
<a name="l01317"></a>01317             <a class="code" href="classChastePoint.html">ChastePoint&lt;DIM&gt;</a> chaste_point_a ( centre.x(), centre.y(), centre.z() );
<a name="l01318"></a>01318             <a class="code" href="classChastePoint.html">ChastePoint&lt;DIM&gt;</a> chaste_point_b ( radii.x(), radii.y(), radii.z() );
<a name="l01319"></a>01319             conductivitiesHeterogeneityAreas.push_back(boost::shared_ptr&lt;<a class="code" href="classAbstractChasteRegion.html">AbstractChasteRegion&lt;DIM&gt;</a> &gt;   (  <span class="keyword">new</span> <a class="code" href="classChasteEllipsoid.html">ChasteEllipsoid&lt;DIM&gt;</a> ( chaste_point_a, chaste_point_b )) );
<a name="l01320"></a>01320         }
<a name="l01321"></a>01321         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ht.Location().EpiLayer().present() || ht.Location().MidLayer().present() || ht.Location().EndoLayer().present() )
<a name="l01322"></a>01322         {
<a name="l01324"></a>01324             <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a>(<span class="stringliteral">&quot;Definition of transmural layers is not allowed for conductivities heterogeneities, you may use fibre orientation support instead&quot;</span>);
<a name="l01325"></a>01325         }
<a name="l01326"></a>01326         <span class="keywordflow">else</span>
<a name="l01327"></a>01327         {
<a name="l01328"></a>01328             <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a>(<span class="stringliteral">&quot;Invalid region type for conductivity definition&quot;</span>);
<a name="l01329"></a>01329         }
<a name="l01330"></a>01330 
<a name="l01331"></a>01331         <span class="keywordflow">if</span> (ht.IntracellularConductivities().present())
<a name="l01332"></a>01332         {
<a name="l01333"></a>01333             <span class="keywordtype">double</span> intra_x = ht.IntracellularConductivities()-&gt;longi();
<a name="l01334"></a>01334             <span class="keywordtype">double</span> intra_y = ht.IntracellularConductivities()-&gt;trans();
<a name="l01335"></a>01335             <span class="keywordtype">double</span> intra_z = ht.IntracellularConductivities()-&gt;normal();
<a name="l01336"></a>01336 
<a name="l01337"></a>01337             intraConductivities.push_back( Create_c_vector(intra_x, intra_y, intra_z) );
<a name="l01338"></a>01338         }
<a name="l01339"></a>01339         <span class="keywordflow">else</span>
<a name="l01340"></a>01340         {
<a name="l01341"></a>01341             c_vector&lt;double, 3&gt; intra_conductivities;
<a name="l01342"></a>01342             <a class="code" href="classHeartConfig.html#aca1345d62f0aa522f210815d812f4401">GetIntracellularConductivities</a>(intra_conductivities);
<a name="l01343"></a>01343             intraConductivities.push_back(intra_conductivities);
<a name="l01344"></a>01344         }
<a name="l01345"></a>01345 
<a name="l01346"></a>01346         <span class="keywordflow">if</span> (ht.ExtracellularConductivities().present())
<a name="l01347"></a>01347         {
<a name="l01348"></a>01348             <span class="keywordtype">double</span> extra_x = ht.ExtracellularConductivities()-&gt;longi();
<a name="l01349"></a>01349             <span class="keywordtype">double</span> extra_y = ht.ExtracellularConductivities()-&gt;trans();
<a name="l01350"></a>01350             <span class="keywordtype">double</span> extra_z = ht.ExtracellularConductivities()-&gt;normal();
<a name="l01351"></a>01351 
<a name="l01352"></a>01352             extraConductivities.push_back( Create_c_vector(extra_x, extra_y, extra_z) );
<a name="l01353"></a>01353         }
<a name="l01354"></a>01354         <span class="keywordflow">else</span>
<a name="l01355"></a>01355         {
<a name="l01356"></a>01356             c_vector&lt;double, 3&gt; extra_conductivities;
<a name="l01357"></a>01357             <a class="code" href="classHeartConfig.html#a88855dbd26f93d53e1b754a1db38f792">GetExtracellularConductivities</a>(extra_conductivities);
<a name="l01358"></a>01358             extraConductivities.push_back(extra_conductivities);
<a name="l01359"></a>01359         }
<a name="l01360"></a>01360 
<a name="l01361"></a>01361     }
<a name="l01362"></a>01362 }
<a name="l01363"></a>01363 
<a name="l01364"></a><a class="code" href="classHeartConfig.html#ad4f49a0c81a7463613fdde99fb56e224">01364</a> std::string <a class="code" href="classHeartConfig.html#ad4f49a0c81a7463613fdde99fb56e224">HeartConfig::GetOutputDirectory</a>()<span class="keyword"> const</span>
<a name="l01365"></a>01365 <span class="keyword"></span>{
<a name="l01366"></a>01366     <a class="code" href="classHeartConfig.html#aab7ea75d3f83c1202127db592d934532">CheckSimulationIsDefined</a>(<span class="stringliteral">&quot;Simulation/OutputDirectory&quot;</span>);
<a name="l01367"></a>01367     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;OutputDirectory().present(), <span class="stringliteral">&quot;Simulation/OutputDirectory&quot;</span>);
<a name="l01368"></a>01368     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;OutputDirectory().get();
<a name="l01369"></a>01369 }
<a name="l01370"></a>01370 
<a name="l01371"></a><a class="code" href="classHeartConfig.html#adc4a009d6fcd830191964ac40ec71889">01371</a> std::string <a class="code" href="classHeartConfig.html#adc4a009d6fcd830191964ac40ec71889">HeartConfig::GetOutputFilenamePrefix</a>()<span class="keyword"> const</span>
<a name="l01372"></a>01372 <span class="keyword"></span>{
<a name="l01373"></a>01373     <a class="code" href="classHeartConfig.html#aab7ea75d3f83c1202127db592d934532">CheckSimulationIsDefined</a>(<span class="stringliteral">&quot;Simulation/OutputFilenamePrefix&quot;</span>);
<a name="l01374"></a>01374     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;OutputFilenamePrefix().present(), <span class="stringliteral">&quot;Simulation/OutputFilenamePrefix&quot;</span>);
<a name="l01375"></a>01375     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;OutputFilenamePrefix().get();
<a name="l01376"></a>01376 }
<a name="l01377"></a>01377 
<a name="l01378"></a><a class="code" href="classHeartConfig.html#a076bbaf9d7412d31220dba3c574a2d86">01378</a> <span class="keywordtype">bool</span> <a class="code" href="classHeartConfig.html#a076bbaf9d7412d31220dba3c574a2d86">HeartConfig::GetOutputVariablesProvided</a>()<span class="keyword"> const</span>
<a name="l01379"></a>01379 <span class="keyword"></span>{
<a name="l01380"></a>01380     <a class="code" href="classHeartConfig.html#aab7ea75d3f83c1202127db592d934532">CheckSimulationIsDefined</a>(<span class="stringliteral">&quot;OutputVariables&quot;</span>);
<a name="l01381"></a>01381     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;OutputVariables().present();
<a name="l01382"></a>01382 }
<a name="l01383"></a>01383 
<a name="l01384"></a><a class="code" href="classHeartConfig.html#acd23827b77524f32ee2e974fc38b5756">01384</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#acd23827b77524f32ee2e974fc38b5756">HeartConfig::GetOutputVariables</a>(std::vector&lt;std::string&gt;&amp; rOutputVariables)<span class="keyword"> const</span>
<a name="l01385"></a>01385 <span class="keyword"></span>{
<a name="l01386"></a>01386     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a076bbaf9d7412d31220dba3c574a2d86">GetOutputVariablesProvided</a>(), <span class="stringliteral">&quot;Simulation/OutputVariables&quot;</span>);
<a name="l01387"></a>01387     XSD_SEQUENCE_TYPE(cp::output_variables_type::Var)&amp;
<a name="l01388"></a>01388          output_variables = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;OutputVariables()-&gt;Var();
<a name="l01389"></a>01389     rOutputVariables.clear();
<a name="l01390"></a>01390 
<a name="l01391"></a>01391     <span class="keywordflow">for</span> (XSD_ITERATOR_TYPE(cp::output_variables_type::Var) i = output_variables.begin();
<a name="l01392"></a>01392          i != output_variables.end();
<a name="l01393"></a>01393          ++i)
<a name="l01394"></a>01394     {
<a name="l01395"></a>01395         cp::var_type&amp; r_var(*i);
<a name="l01396"></a>01396 
<a name="l01397"></a>01397         <span class="comment">// Add to outputVariables the string returned by var.name()</span>
<a name="l01398"></a>01398         rOutputVariables.push_back(r_var.name());
<a name="l01399"></a>01399     }
<a name="l01400"></a>01400 }
<a name="l01401"></a>01401 
<a name="l01402"></a><a class="code" href="classHeartConfig.html#a7593b5c221b39addad3c77cd74b0e132">01402</a> <span class="keywordtype">bool</span> <a class="code" href="classHeartConfig.html#a7593b5c221b39addad3c77cd74b0e132">HeartConfig::GetOutputUsingOriginalNodeOrdering</a>()
<a name="l01403"></a>01403 {
<a name="l01404"></a>01404     <a class="code" href="classHeartConfig.html#aab7ea75d3f83c1202127db592d934532">CheckSimulationIsDefined</a>(<span class="stringliteral">&quot;OutputUsingOriginalNodeOrdering&quot;</span>);
<a name="l01405"></a>01405     <span class="keywordtype">bool</span> result = <span class="keyword">false</span>;
<a name="l01406"></a>01406     <span class="keywordflow">if</span> (<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;OutputUsingOriginalNodeOrdering().present())
<a name="l01407"></a>01407     {
<a name="l01408"></a>01408         result = (<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;OutputUsingOriginalNodeOrdering().get() == cp::yesno_type::yes);
<a name="l01409"></a>01409     }
<a name="l01410"></a>01410     <span class="keywordflow">return</span> result;
<a name="l01411"></a>01411 }
<a name="l01412"></a>01412 
<a name="l01413"></a><a class="code" href="classHeartConfig.html#a34e25b3a25618f0f8721c678e6b12f95">01413</a> <span class="keywordtype">bool</span> <a class="code" href="classHeartConfig.html#a34e25b3a25618f0f8721c678e6b12f95">HeartConfig::GetCheckpointSimulation</a>()<span class="keyword"> const</span>
<a name="l01414"></a>01414 <span class="keyword"></span>{
<a name="l01415"></a>01415     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a894d374015f888c2111ec252134395fc">IsSimulationDefined</a>() &amp;&amp; <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;CheckpointSimulation().present();
<a name="l01416"></a>01416 }
<a name="l01417"></a>01417 
<a name="l01418"></a><a class="code" href="classHeartConfig.html#a80bb45c8945a0a3b98b5a1151d79143a">01418</a> <span class="keywordtype">double</span> <a class="code" href="classHeartConfig.html#a80bb45c8945a0a3b98b5a1151d79143a">HeartConfig::GetCheckpointTimestep</a>()<span class="keyword"> const</span>
<a name="l01419"></a>01419 <span class="keyword"></span>{
<a name="l01420"></a>01420     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a34e25b3a25618f0f8721c678e6b12f95">GetCheckpointSimulation</a>(), <span class="stringliteral">&quot;Simulation/CheckpointSimulation&quot;</span>);
<a name="l01421"></a>01421     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;CheckpointSimulation()-&gt;timestep();
<a name="l01422"></a>01422 }
<a name="l01423"></a>01423 
<a name="l01424"></a><a class="code" href="classHeartConfig.html#ad6f5c8169999d795e99f66befb962f0c">01424</a> <span class="keywordtype">unsigned</span> <a class="code" href="classHeartConfig.html#ad6f5c8169999d795e99f66befb962f0c">HeartConfig::GetMaxCheckpointsOnDisk</a>()<span class="keyword"> const</span>
<a name="l01425"></a>01425 <span class="keyword"></span>{
<a name="l01426"></a>01426     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a34e25b3a25618f0f8721c678e6b12f95">GetCheckpointSimulation</a>(), <span class="stringliteral">&quot;Simulation/CheckpointSimulation&quot;</span>);
<a name="l01427"></a>01427     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;CheckpointSimulation()-&gt;max_checkpoints_on_disk();
<a name="l01428"></a>01428 }
<a name="l01429"></a>01429 
<a name="l01430"></a>01430 
<a name="l01431"></a><a class="code" href="classHeartConfig.html#aa42aa4f087310c26972171ef1accb0ae">01431</a> <a class="code" href="classHeartFileFinder.html">HeartFileFinder</a> <a class="code" href="classHeartConfig.html#aa42aa4f087310c26972171ef1accb0ae">HeartConfig::GetArchivedSimulationDir</a>()<span class="keyword"> const</span>
<a name="l01432"></a>01432 <span class="keyword"></span>{
<a name="l01433"></a>01433     <a class="code" href="classHeartConfig.html#a2be3fdcc724c4a6609526b53f86d8c01">CheckResumeSimulationIsDefined</a>(<span class="stringliteral">&quot;GetArchivedSimulationDir&quot;</span>);
<a name="l01434"></a>01434 
<a name="l01435"></a>01435     <span class="keywordflow">return</span> <a class="code" href="classHeartFileFinder.html">HeartFileFinder</a>(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;ResumeSimulation()-&gt;ArchiveDirectory());
<a name="l01436"></a>01436 }
<a name="l01437"></a>01437 
<a name="l01438"></a>01438 
<a name="l01439"></a><a class="code" href="classHeartConfig.html#aca1345d62f0aa522f210815d812f4401">01439</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#aca1345d62f0aa522f210815d812f4401">HeartConfig::GetIntracellularConductivities</a>(c_vector&lt;double, 3&gt;&amp; intraConductivities)<span class="keyword"> const</span>
<a name="l01440"></a>01440 <span class="keyword"></span>{
<a name="l01441"></a>01441     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().IntracellularConductivities().present(), <span class="stringliteral">&quot;Physiological/IntracellularConductivities&quot;</span>);
<a name="l01442"></a>01442     cp::conductivities_type intra_conductivities
<a name="l01443"></a>01443         = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().IntracellularConductivities().get();
<a name="l01444"></a>01444     <span class="keywordtype">double</span> intra_x_cond = intra_conductivities.longi();
<a name="l01445"></a>01445     <span class="keywordtype">double</span> intra_y_cond = intra_conductivities.trans();
<a name="l01446"></a>01446     <span class="keywordtype">double</span> intra_z_cond = intra_conductivities.normal();;
<a name="l01447"></a>01447 
<a name="l01448"></a>01448     assert(intra_y_cond != DBL_MAX);
<a name="l01449"></a>01449     assert(intra_z_cond != DBL_MAX);
<a name="l01450"></a>01450 
<a name="l01451"></a>01451     intraConductivities[0] = intra_x_cond;
<a name="l01452"></a>01452     intraConductivities[1] = intra_y_cond;
<a name="l01453"></a>01453     intraConductivities[2] = intra_z_cond;
<a name="l01454"></a>01454 }
<a name="l01455"></a>01455 
<a name="l01456"></a><a class="code" href="classHeartConfig.html#a2136658644fe12e309c2d7999e920095">01456</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#aca1345d62f0aa522f210815d812f4401">HeartConfig::GetIntracellularConductivities</a>(c_vector&lt;double, 2&gt;&amp; intraConductivities)<span class="keyword"> const</span>
<a name="l01457"></a>01457 <span class="keyword"></span>{
<a name="l01458"></a>01458     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().IntracellularConductivities().present(), <span class="stringliteral">&quot;Physiological/IntracellularConductivities&quot;</span>);
<a name="l01459"></a>01459     cp::conductivities_type intra_conductivities
<a name="l01460"></a>01460         = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().IntracellularConductivities().get();
<a name="l01461"></a>01461     <span class="keywordtype">double</span> intra_x_cond = intra_conductivities.longi();
<a name="l01462"></a>01462     <span class="keywordtype">double</span> intra_y_cond = intra_conductivities.trans();
<a name="l01463"></a>01463 
<a name="l01464"></a>01464     assert(intra_y_cond != DBL_MAX);
<a name="l01465"></a>01465 
<a name="l01466"></a>01466     intraConductivities[0] = intra_x_cond;
<a name="l01467"></a>01467     intraConductivities[1] = intra_y_cond;
<a name="l01468"></a>01468 }
<a name="l01469"></a>01469 
<a name="l01470"></a><a class="code" href="classHeartConfig.html#a8f5ed5c4dd484ba715da9073495b0748">01470</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#aca1345d62f0aa522f210815d812f4401">HeartConfig::GetIntracellularConductivities</a>(c_vector&lt;double, 1&gt;&amp; intraConductivities)<span class="keyword"> const</span>
<a name="l01471"></a>01471 <span class="keyword"></span>{
<a name="l01472"></a>01472     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().IntracellularConductivities().present(), <span class="stringliteral">&quot;Physiological/IntracellularConductivities&quot;</span>);
<a name="l01473"></a>01473     cp::conductivities_type intra_conductivities
<a name="l01474"></a>01474         = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().IntracellularConductivities().get();
<a name="l01475"></a>01475     <span class="keywordtype">double</span> intra_x_cond = intra_conductivities.longi();
<a name="l01476"></a>01476 
<a name="l01477"></a>01477     intraConductivities[0] = intra_x_cond;
<a name="l01478"></a>01478 }
<a name="l01479"></a>01479 
<a name="l01480"></a><a class="code" href="classHeartConfig.html#a88855dbd26f93d53e1b754a1db38f792">01480</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a88855dbd26f93d53e1b754a1db38f792">HeartConfig::GetExtracellularConductivities</a>(c_vector&lt;double, 3&gt;&amp; extraConductivities)<span class="keyword"> const</span>
<a name="l01481"></a>01481 <span class="keyword"></span>{
<a name="l01482"></a>01482     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().ExtracellularConductivities().present(), <span class="stringliteral">&quot;Physiological/ExtracellularConductivities&quot;</span>);
<a name="l01483"></a>01483     cp::conductivities_type extra_conductivities
<a name="l01484"></a>01484         = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().ExtracellularConductivities().get();
<a name="l01485"></a>01485     <span class="keywordtype">double</span> extra_x_cond = extra_conductivities.longi();
<a name="l01486"></a>01486     <span class="keywordtype">double</span> extra_y_cond = extra_conductivities.trans();
<a name="l01487"></a>01487     <span class="keywordtype">double</span> extra_z_cond = extra_conductivities.normal();;
<a name="l01488"></a>01488 
<a name="l01489"></a>01489     assert(extra_y_cond != DBL_MAX);
<a name="l01490"></a>01490     assert(extra_z_cond != DBL_MAX);
<a name="l01491"></a>01491 
<a name="l01492"></a>01492     extraConductivities[0] = extra_x_cond;
<a name="l01493"></a>01493     extraConductivities[1] = extra_y_cond;
<a name="l01494"></a>01494     extraConductivities[2] = extra_z_cond;
<a name="l01495"></a>01495 }
<a name="l01496"></a>01496 
<a name="l01497"></a><a class="code" href="classHeartConfig.html#a2a2351eed4d2a4e0f17c854976901be2">01497</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a88855dbd26f93d53e1b754a1db38f792">HeartConfig::GetExtracellularConductivities</a>(c_vector&lt;double, 2&gt;&amp; extraConductivities)<span class="keyword"> const</span>
<a name="l01498"></a>01498 <span class="keyword"></span>{
<a name="l01499"></a>01499     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().ExtracellularConductivities().present(), <span class="stringliteral">&quot;Physiological/ExtracellularConductivities&quot;</span>);
<a name="l01500"></a>01500     cp::conductivities_type extra_conductivities
<a name="l01501"></a>01501         = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().ExtracellularConductivities().get();
<a name="l01502"></a>01502     <span class="keywordtype">double</span> extra_x_cond = extra_conductivities.longi();
<a name="l01503"></a>01503     <span class="keywordtype">double</span> extra_y_cond = extra_conductivities.trans();
<a name="l01504"></a>01504 
<a name="l01505"></a>01505     assert(extra_y_cond != DBL_MAX);
<a name="l01506"></a>01506 
<a name="l01507"></a>01507     extraConductivities[0] = extra_x_cond;
<a name="l01508"></a>01508     extraConductivities[1] = extra_y_cond;
<a name="l01509"></a>01509 }
<a name="l01510"></a>01510 
<a name="l01511"></a><a class="code" href="classHeartConfig.html#a9b672856c90b4a742b0c285791f693a4">01511</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a88855dbd26f93d53e1b754a1db38f792">HeartConfig::GetExtracellularConductivities</a>(c_vector&lt;double, 1&gt;&amp; extraConductivities)<span class="keyword"> const</span>
<a name="l01512"></a>01512 <span class="keyword"></span>{
<a name="l01513"></a>01513     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().ExtracellularConductivities().present(), <span class="stringliteral">&quot;Physiological/ExtracellularConductivities&quot;</span>);
<a name="l01514"></a>01514     cp::conductivities_type extra_conductivities
<a name="l01515"></a>01515         = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().ExtracellularConductivities().get();
<a name="l01516"></a>01516     <span class="keywordtype">double</span> extra_x_cond = extra_conductivities.longi();
<a name="l01517"></a>01517 
<a name="l01518"></a>01518     extraConductivities[0] = extra_x_cond;
<a name="l01519"></a>01519 }
<a name="l01520"></a>01520 
<a name="l01521"></a><a class="code" href="classHeartConfig.html#aa4da2f2d8f8a1893230e598e56c6ef04">01521</a> <span class="keywordtype">double</span> <a class="code" href="classHeartConfig.html#aa4da2f2d8f8a1893230e598e56c6ef04">HeartConfig::GetBathConductivity</a>(<span class="keywordtype">unsigned</span> bathRegion)<span class="keyword"> const</span>
<a name="l01522"></a>01522 <span class="keyword"></span>{
<a name="l01523"></a>01523     <span class="comment">/*</span>
<a name="l01524"></a>01524 <span class="comment">     *  We have to consider three cases: The user asks for ...</span>
<a name="l01525"></a>01525 <span class="comment">     *    a) ... the default conductivity (bathRegion=UINT_MAX)</span>
<a name="l01526"></a>01526 <span class="comment">     *    b) ... the conductivity of region defined to be heterogeneous</span>
<a name="l01527"></a>01527 <span class="comment">     *    c) ... the conductivity of region NOT defined to be heterogeneous</span>
<a name="l01528"></a>01528 <span class="comment">     *</span>
<a name="l01529"></a>01529 <span class="comment">     *  a) and c) should return the same</span>
<a name="l01530"></a>01530 <span class="comment">     */</span>
<a name="l01531"></a>01531 
<a name="l01532"></a>01532     <span class="keywordflow">if</span> (bathRegion == UINT_MAX)
<a name="l01533"></a>01533     {
<a name="l01534"></a>01534         <span class="comment">/*bath conductivity mS/cm*/</span>
<a name="l01535"></a>01535         CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().BathConductivity().present(), <span class="stringliteral">&quot;Physiological/BathConductivity&quot;</span>);
<a name="l01536"></a>01536         <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().BathConductivity().get();
<a name="l01537"></a>01537     }
<a name="l01538"></a>01538     <span class="keywordflow">else</span>
<a name="l01539"></a>01539     {
<a name="l01540"></a>01540         assert(<a class="code" href="classHeartRegionCode.html#aad3b24c50cea20f387e7bfeee6163560">HeartRegionCode::IsRegionBath</a>(bathRegion));
<a name="l01541"></a>01541 
<a name="l01542"></a>01542         std::map&lt;unsigned, double&gt;::const_iterator map_entry = <a class="code" href="classHeartConfig.html#a5f7071e5af04a3024ef80365f8eb2780">mBathConductivities</a>.find(bathRegion);
<a name="l01543"></a>01543 
<a name="l01544"></a>01544         <span class="keywordflow">if</span> (map_entry != <a class="code" href="classHeartConfig.html#a5f7071e5af04a3024ef80365f8eb2780">mBathConductivities</a>.end())
<a name="l01545"></a>01545         {
<a name="l01546"></a>01546             <span class="keywordflow">return</span> map_entry-&gt;second;
<a name="l01547"></a>01547         }
<a name="l01548"></a>01548         <span class="keywordflow">else</span>
<a name="l01549"></a>01549         {
<a name="l01550"></a>01550             <span class="comment">/*bath conductivity mS/cm*/</span>
<a name="l01551"></a>01551             CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().BathConductivity().present(), <span class="stringliteral">&quot;Physiological/BathConductivity&quot;</span>);
<a name="l01552"></a>01552             <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().BathConductivity().get();
<a name="l01553"></a>01553         }
<a name="l01554"></a>01554     }
<a name="l01555"></a>01555 }
<a name="l01556"></a><a class="code" href="classHeartConfig.html#ade67096f1d2d5559b29b340f259e7d64">01556</a> <span class="keyword">const</span> std::set&lt;unsigned&gt;&amp;  <a class="code" href="classHeartConfig.html#ade67096f1d2d5559b29b340f259e7d64">HeartConfig::rGetTissueIdentifiers</a>()
<a name="l01557"></a>01557 {
<a name="l01558"></a>01558     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#ac657f43ca4d92bfd3c5e2270e7470429">mTissueIdentifiers</a>;
<a name="l01559"></a>01559 }
<a name="l01560"></a>01560 
<a name="l01561"></a><a class="code" href="classHeartConfig.html#a7b7439ea4c9beafbdc55c09e51d76819">01561</a> <span class="keyword">const</span> std::set&lt;unsigned&gt;&amp;  <a class="code" href="classHeartConfig.html#a7b7439ea4c9beafbdc55c09e51d76819">HeartConfig::rGetBathIdentifiers</a>()
<a name="l01562"></a>01562 {
<a name="l01563"></a>01563     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a1471127f954fea7a8eb5811ec448f0cc">mBathIdentifiers</a>;
<a name="l01564"></a>01564 }
<a name="l01565"></a>01565 
<a name="l01566"></a><a class="code" href="classHeartConfig.html#a28720983a8bcd68fd8dfc6ce247fd325">01566</a> <span class="keywordtype">double</span> <a class="code" href="classHeartConfig.html#a28720983a8bcd68fd8dfc6ce247fd325">HeartConfig::GetSurfaceAreaToVolumeRatio</a>()<span class="keyword"> const</span>
<a name="l01567"></a>01567 <span class="keyword"></span>{
<a name="l01568"></a>01568     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().SurfaceAreaToVolumeRatio().present(), <span class="stringliteral">&quot;Physiological/SurfaceAreaToVolumeRatio&quot;</span>);
<a name="l01569"></a>01569     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().SurfaceAreaToVolumeRatio().get();
<a name="l01570"></a>01570 }
<a name="l01571"></a>01571 
<a name="l01572"></a><a class="code" href="classHeartConfig.html#a7dd59bcef90ddadee3e7a10cbf64be1d">01572</a> <span class="keywordtype">double</span> <a class="code" href="classHeartConfig.html#a7dd59bcef90ddadee3e7a10cbf64be1d">HeartConfig::GetCapacitance</a>()<span class="keyword"> const</span>
<a name="l01573"></a>01573 <span class="keyword"></span>{
<a name="l01574"></a>01574     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().Capacitance().present(), <span class="stringliteral">&quot;Physiological/Capacitance&quot;</span>);
<a name="l01575"></a>01575     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().Capacitance().get();
<a name="l01576"></a>01576 }
<a name="l01577"></a>01577 
<a name="l01578"></a><a class="code" href="classHeartConfig.html#a383ab1c116a88ecd3f973ef371a2c8d9">01578</a> <span class="keywordtype">double</span> <a class="code" href="classHeartConfig.html#a383ab1c116a88ecd3f973ef371a2c8d9">HeartConfig::GetOdeTimeStep</a>()<span class="keyword"> const</span>
<a name="l01579"></a>01579 <span class="keyword"></span>{
<a name="l01580"></a>01580     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().TimeSteps().present(), <span class="stringliteral">&quot;Numerical/TimeSteps&quot;</span>);
<a name="l01581"></a>01581     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().TimeSteps()-&gt;ode();
<a name="l01582"></a>01582 }
<a name="l01583"></a>01583 
<a name="l01584"></a><a class="code" href="classHeartConfig.html#ac20bbc4140281b206a260a82cb59ab0f">01584</a> <span class="keywordtype">double</span> <a class="code" href="classHeartConfig.html#ac20bbc4140281b206a260a82cb59ab0f">HeartConfig::GetPdeTimeStep</a>()<span class="keyword"> const</span>
<a name="l01585"></a>01585 <span class="keyword"></span>{
<a name="l01586"></a>01586     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().TimeSteps().present(), <span class="stringliteral">&quot;Numerical/TimeSteps&quot;</span>);
<a name="l01587"></a>01587     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().TimeSteps()-&gt;pde();
<a name="l01588"></a>01588 }
<a name="l01589"></a>01589 
<a name="l01590"></a><a class="code" href="classHeartConfig.html#a33ae21f4b16476aa5cb975a455c5ba19">01590</a> <span class="keywordtype">double</span> <a class="code" href="classHeartConfig.html#a33ae21f4b16476aa5cb975a455c5ba19">HeartConfig::GetPrintingTimeStep</a>()<span class="keyword"> const</span>
<a name="l01591"></a>01591 <span class="keyword"></span>{
<a name="l01592"></a>01592     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().TimeSteps().present(), <span class="stringliteral">&quot;Numerical/TimeSteps&quot;</span>);
<a name="l01593"></a>01593     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().TimeSteps()-&gt;printing();
<a name="l01594"></a>01594 }
<a name="l01595"></a>01595 
<a name="l01596"></a><a class="code" href="classHeartConfig.html#aefd1b52bc3570c91aeb5c30793f8fb09">01596</a> <span class="keywordtype">bool</span> <a class="code" href="classHeartConfig.html#aefd1b52bc3570c91aeb5c30793f8fb09">HeartConfig::GetUseAbsoluteTolerance</a>()<span class="keyword"> const</span>
<a name="l01597"></a>01597 <span class="keyword"></span>{
<a name="l01598"></a>01598     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().KSPTolerances().present(), <span class="stringliteral">&quot;Numerical/KSPTolerances&quot;</span>);
<a name="l01599"></a>01599     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().KSPTolerances()-&gt;KSPAbsolute().present();
<a name="l01600"></a>01600 }
<a name="l01601"></a>01601 
<a name="l01602"></a><a class="code" href="classHeartConfig.html#a45eb855112098fbd11eeafa696af3865">01602</a> <span class="keywordtype">double</span> <a class="code" href="classHeartConfig.html#a45eb855112098fbd11eeafa696af3865">HeartConfig::GetAbsoluteTolerance</a>()<span class="keyword"> const</span>
<a name="l01603"></a>01603 <span class="keyword"></span>{
<a name="l01604"></a>01604     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().KSPTolerances().present(), <span class="stringliteral">&quot;Numerical/KSPTolerances&quot;</span>);
<a name="l01605"></a>01605     <span class="keywordflow">if</span> (!<a class="code" href="classHeartConfig.html#aefd1b52bc3570c91aeb5c30793f8fb09">GetUseAbsoluteTolerance</a>())
<a name="l01606"></a>01606     {
<a name="l01607"></a>01607         <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a>(<span class="stringliteral">&quot;Absolute tolerance is not set in Chaste parameters&quot;</span>);
<a name="l01608"></a>01608     }
<a name="l01609"></a>01609     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().KSPTolerances()-&gt;KSPAbsolute().get();
<a name="l01610"></a>01610 }
<a name="l01611"></a>01611 
<a name="l01612"></a><a class="code" href="classHeartConfig.html#a38875e6f770ba53ed2fe1bcb91d12a61">01612</a> <span class="keywordtype">bool</span> <a class="code" href="classHeartConfig.html#a38875e6f770ba53ed2fe1bcb91d12a61">HeartConfig::GetUseRelativeTolerance</a>()<span class="keyword"> const</span>
<a name="l01613"></a>01613 <span class="keyword"></span>{
<a name="l01614"></a>01614     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().KSPTolerances().present(), <span class="stringliteral">&quot;Numerical/KSPTolerances&quot;</span>);
<a name="l01615"></a>01615     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().KSPTolerances()-&gt;KSPRelative().present();
<a name="l01616"></a>01616 }
<a name="l01617"></a>01617 
<a name="l01618"></a><a class="code" href="classHeartConfig.html#a1ea656c2fb65c0bfd25fbc162202fa1a">01618</a> <span class="keywordtype">double</span> <a class="code" href="classHeartConfig.html#a1ea656c2fb65c0bfd25fbc162202fa1a">HeartConfig::GetRelativeTolerance</a>()<span class="keyword"> const</span>
<a name="l01619"></a>01619 <span class="keyword"></span>{
<a name="l01620"></a>01620     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().KSPTolerances().present(), <span class="stringliteral">&quot;Numerical/KSPTolerances&quot;</span>);
<a name="l01621"></a>01621     <span class="keywordflow">if</span> (!<a class="code" href="classHeartConfig.html#a38875e6f770ba53ed2fe1bcb91d12a61">GetUseRelativeTolerance</a>())
<a name="l01622"></a>01622     {
<a name="l01623"></a>01623         <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a>(<span class="stringliteral">&quot;Relative tolerance is not set in Chaste parameters&quot;</span>);
<a name="l01624"></a>01624     }
<a name="l01625"></a>01625     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().KSPTolerances()-&gt;KSPRelative().get();
<a name="l01626"></a>01626 }
<a name="l01627"></a>01627 
<a name="l01628"></a><a class="code" href="classHeartConfig.html#ac50d7e66e3a6127cf337d2f65638ad6b">01628</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="classHeartConfig.html#ac50d7e66e3a6127cf337d2f65638ad6b">HeartConfig::GetKSPSolver</a>()<span class="keyword"> const</span>
<a name="l01629"></a>01629 <span class="keyword"></span>{
<a name="l01630"></a>01630     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().KSPSolver().present(), <span class="stringliteral">&quot;Numerical/KSPSolver&quot;</span>);
<a name="l01631"></a>01631     <span class="keywordflow">switch</span> (<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().KSPSolver().get())
<a name="l01632"></a>01632     {
<a name="l01633"></a>01633         <span class="keywordflow">case</span> cp::ksp_solver_type::gmres :
<a name="l01634"></a>01634             <span class="keywordflow">return</span> <span class="stringliteral">&quot;gmres&quot;</span>;
<a name="l01635"></a>01635         <span class="keywordflow">case</span> cp::ksp_solver_type::cg :
<a name="l01636"></a>01636             <span class="keywordflow">return</span> <span class="stringliteral">&quot;cg&quot;</span>;
<a name="l01637"></a>01637         <span class="keywordflow">case</span> cp::ksp_solver_type::symmlq :
<a name="l01638"></a>01638             <span class="keywordflow">return</span> <span class="stringliteral">&quot;symmlq&quot;</span>;
<a name="l01639"></a>01639         <span class="keywordflow">case</span> cp::ksp_solver_type::chebychev :
<a name="l01640"></a>01640             <span class="keywordflow">return</span> <span class="stringliteral">&quot;chebychev&quot;</span>;
<a name="l01641"></a>01641     }
<a name="l01642"></a>01642 <span class="preprocessor">#define COVERAGE_IGNORE</span>
<a name="l01643"></a>01643 <span class="preprocessor"></span>    <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a>(<span class="stringliteral">&quot;Unknown ksp solver&quot;</span>);
<a name="l01644"></a>01644 <span class="preprocessor">#undef COVERAGE_IGNORE</span>
<a name="l01645"></a>01645 <span class="preprocessor"></span>}
<a name="l01646"></a>01646 
<a name="l01647"></a><a class="code" href="classHeartConfig.html#ac6d76aa8808fba0fa0da55d6b5749c22">01647</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="classHeartConfig.html#ac6d76aa8808fba0fa0da55d6b5749c22">HeartConfig::GetKSPPreconditioner</a>()<span class="keyword"> const</span>
<a name="l01648"></a>01648 <span class="keyword"></span>{
<a name="l01649"></a>01649     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().KSPPreconditioner().present(), <span class="stringliteral">&quot;Numerical/KSPPreconditioner&quot;</span>);
<a name="l01650"></a>01650     <span class="keywordflow">switch</span> ( <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().KSPPreconditioner().get() )
<a name="l01651"></a>01651     {
<a name="l01652"></a>01652         <span class="keywordflow">case</span> cp::ksp_preconditioner_type::jacobi :
<a name="l01653"></a>01653             <span class="keywordflow">return</span> <span class="stringliteral">&quot;jacobi&quot;</span>;
<a name="l01654"></a>01654         <span class="keywordflow">case</span> cp::ksp_preconditioner_type::bjacobi :
<a name="l01655"></a>01655             <span class="keywordflow">return</span> <span class="stringliteral">&quot;bjacobi&quot;</span>;
<a name="l01656"></a>01656         <span class="keywordflow">case</span> cp::ksp_preconditioner_type::hypre :
<a name="l01657"></a>01657             <span class="keywordflow">return</span> <span class="stringliteral">&quot;hypre&quot;</span>;
<a name="l01658"></a>01658         <span class="keywordflow">case</span> cp::ksp_preconditioner_type::ml :
<a name="l01659"></a>01659             <span class="keywordflow">return</span> <span class="stringliteral">&quot;ml&quot;</span>;
<a name="l01660"></a>01660         <span class="keywordflow">case</span> cp::ksp_preconditioner_type::spai :
<a name="l01661"></a>01661             <span class="keywordflow">return</span> <span class="stringliteral">&quot;spai&quot;</span>;
<a name="l01662"></a>01662         <span class="keywordflow">case</span> cp::ksp_preconditioner_type::blockdiagonal :
<a name="l01663"></a>01663             <span class="keywordflow">return</span> <span class="stringliteral">&quot;blockdiagonal&quot;</span>;
<a name="l01664"></a>01664         <span class="keywordflow">case</span> cp::ksp_preconditioner_type::ldufactorisation :
<a name="l01665"></a>01665             <span class="keywordflow">return</span> <span class="stringliteral">&quot;ldufactorisation&quot;</span>;
<a name="l01666"></a>01666         <span class="keywordflow">case</span> cp::ksp_preconditioner_type::twolevelsblockdiagonal :
<a name="l01667"></a>01667             <span class="keywordflow">return</span> <span class="stringliteral">&quot;twolevelsblockdiagonal&quot;</span>;
<a name="l01668"></a>01668         <span class="keywordflow">case</span> cp::ksp_preconditioner_type::none :
<a name="l01669"></a>01669             <span class="keywordflow">return</span> <span class="stringliteral">&quot;none&quot;</span>;
<a name="l01670"></a>01670 
<a name="l01671"></a>01671     }
<a name="l01672"></a>01672 <span class="preprocessor">#define COVERAGE_IGNORE</span>
<a name="l01673"></a>01673 <span class="preprocessor"></span>    <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a>(<span class="stringliteral">&quot;Unknown ksp preconditioner&quot;</span>);
<a name="l01674"></a>01674 <span class="preprocessor">#undef COVERAGE_IGNORE</span>
<a name="l01675"></a>01675 <span class="preprocessor"></span>}
<a name="l01676"></a>01676 
<a name="l01677"></a><a class="code" href="classHeartConfig.html#adf19fd38950e460486b977973b2ca3a9">01677</a> <a class="code" href="structDistributedTetrahedralMeshPartitionType.html#a0db0b35cb269eb0e00b9f124fbc28e45">DistributedTetrahedralMeshPartitionType::type</a> <a class="code" href="classHeartConfig.html#adf19fd38950e460486b977973b2ca3a9">HeartConfig::GetMeshPartitioning</a>()<span class="keyword"> const</span>
<a name="l01678"></a>01678 <span class="keyword"></span>{
<a name="l01679"></a>01679     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().MeshPartitioning().present(), <span class="stringliteral">&quot;Numerical/MeshPartitioning&quot;</span>);
<a name="l01680"></a>01680     <span class="keywordflow">switch</span> ( <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().MeshPartitioning().get() )
<a name="l01681"></a>01681     {
<a name="l01682"></a>01682         <span class="keywordflow">case</span> cp::mesh_partitioning_type::dumb :
<a name="l01683"></a>01683             <span class="keywordflow">return</span> DistributedTetrahedralMeshPartitionType::DUMB;
<a name="l01684"></a>01684         <span class="keywordflow">case</span> cp::mesh_partitioning_type::metis :
<a name="l01685"></a>01685             <span class="keywordflow">return</span> DistributedTetrahedralMeshPartitionType::METIS_LIBRARY;
<a name="l01686"></a>01686         <span class="keywordflow">case</span> cp::mesh_partitioning_type::parmetis :
<a name="l01687"></a>01687             <span class="keywordflow">return</span> DistributedTetrahedralMeshPartitionType::PARMETIS_LIBRARY;
<a name="l01688"></a>01688         <span class="keywordflow">case</span> cp::mesh_partitioning_type::petsc :
<a name="l01689"></a>01689             <span class="keywordflow">return</span> DistributedTetrahedralMeshPartitionType::PETSC_MAT_PARTITION;
<a name="l01690"></a>01690     }
<a name="l01691"></a>01691 <span class="preprocessor">#define COVERAGE_IGNORE</span>
<a name="l01692"></a>01692 <span class="preprocessor"></span>    <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a>(<span class="stringliteral">&quot;Unknown mesh partitioning type&quot;</span>);
<a name="l01693"></a>01693 <span class="preprocessor">#undef COVERAGE_IGNORE</span>
<a name="l01694"></a>01694 <span class="preprocessor"></span>}
<a name="l01695"></a>01695 
<a name="l01696"></a><a class="code" href="classHeartConfig.html#afacc6a848f43660c4cccfd9b66cc0df2">01696</a> <span class="keywordtype">bool</span> <a class="code" href="classHeartConfig.html#afacc6a848f43660c4cccfd9b66cc0df2">HeartConfig::IsAdaptivityParametersPresent</a>()<span class="keyword"> const</span>
<a name="l01697"></a>01697 <span class="keyword"></span>{
<a name="l01698"></a>01698     <span class="keywordtype">bool</span> <a class="code" href="classHeartConfig.html#afacc6a848f43660c4cccfd9b66cc0df2">IsAdaptivityParametersPresent</a> = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().AdaptivityParameters().present();
<a name="l01699"></a>01699     <span class="keywordflow">if</span> (IsAdaptivityParametersPresent)
<a name="l01700"></a>01700     {
<a name="l01701"></a>01701         WARNING(<span class="stringliteral">&quot;Use of the Adaptivity library is deprecated&quot;</span>);
<a name="l01702"></a>01702     }
<a name="l01703"></a>01703     <span class="keywordflow">return</span> IsAdaptivityParametersPresent;
<a name="l01704"></a>01704 }
<a name="l01705"></a>01705 
<a name="l01706"></a>01706 <span class="comment">/*</span>
<a name="l01707"></a>01707 <span class="comment"> * PostProcessing</span>
<a name="l01708"></a>01708 <span class="comment"> */</span>
<a name="l01709"></a>01709 
<a name="l01710"></a><a class="code" href="classHeartConfig.html#a1a13023d984e6bcab3faa854847654ce">01710</a> <span class="keywordtype">bool</span> <a class="code" href="classHeartConfig.html#a1a13023d984e6bcab3faa854847654ce">HeartConfig::IsPostProcessingSectionPresent</a>()<span class="keyword"> const</span>
<a name="l01711"></a>01711 <span class="keyword"></span>{
<a name="l01712"></a>01712     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;PostProcessing().present();
<a name="l01713"></a>01713 }
<a name="l01714"></a>01714 
<a name="l01715"></a><a class="code" href="classHeartConfig.html#a66b61cef16319298971d3961516229db">01715</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a66b61cef16319298971d3961516229db">HeartConfig::EnsurePostProcessingSectionPresent</a>()
<a name="l01716"></a>01716 {
<a name="l01717"></a>01717     ENSURE_SECTION_PRESENT(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;PostProcessing(), cp::postprocessing_type);
<a name="l01718"></a>01718 }
<a name="l01719"></a>01719 
<a name="l01720"></a><a class="code" href="classHeartConfig.html#aa82a9d7071771f54527f2d749f428247">01720</a> <span class="keywordtype">bool</span> <a class="code" href="classHeartConfig.html#aa82a9d7071771f54527f2d749f428247">HeartConfig::IsPostProcessingRequested</a>()<span class="keyword"> const</span>
<a name="l01721"></a>01721 <span class="keyword"></span>{
<a name="l01722"></a>01722     <span class="keywordflow">if</span> (<a class="code" href="classHeartConfig.html#a1a13023d984e6bcab3faa854847654ce">IsPostProcessingSectionPresent</a>() == <span class="keyword">false</span>)
<a name="l01723"></a>01723     {
<a name="l01724"></a>01724         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01725"></a>01725     }
<a name="l01726"></a>01726     <span class="keywordflow">else</span>
<a name="l01727"></a>01727     {
<a name="l01728"></a>01728         <span class="keywordflow">return</span>(<a class="code" href="classHeartConfig.html#ad6f240f8dc2d4158afa69fd3a7da9a15">IsApdMapsRequested</a>() ||
<a name="l01729"></a>01729                <a class="code" href="classHeartConfig.html#a38b9c3b57116747edcf71fd6d78029d5">IsUpstrokeTimeMapsRequested</a>() ||
<a name="l01730"></a>01730                <a class="code" href="classHeartConfig.html#ab8fa3c6d5dfada90205d5a6458d56d30">IsMaxUpstrokeVelocityMapRequested</a>() ||
<a name="l01731"></a>01731                <a class="code" href="classHeartConfig.html#ae842eee4b5d015df2d193d11857efb91">IsConductionVelocityMapsRequested</a>() ||
<a name="l01732"></a>01732                <a class="code" href="classHeartConfig.html#ad88df76b31578cd3c311465294c5dafa">IsAnyNodalTimeTraceRequested</a>()||
<a name="l01733"></a>01733                <a class="code" href="classHeartConfig.html#a7700d433bf452eeb7074894bf298f944">IsPseudoEcgCalculationRequested</a>());
<a name="l01734"></a>01734     }
<a name="l01735"></a>01735 }
<a name="l01736"></a><a class="code" href="classHeartConfig.html#ad6f240f8dc2d4158afa69fd3a7da9a15">01736</a> <span class="keywordtype">bool</span> <a class="code" href="classHeartConfig.html#ad6f240f8dc2d4158afa69fd3a7da9a15">HeartConfig::IsApdMapsRequested</a>()<span class="keyword"> const</span>
<a name="l01737"></a>01737 <span class="keyword"></span>{
<a name="l01738"></a>01738     <span class="keywordtype">bool</span> result = <span class="keyword">false</span>;
<a name="l01739"></a>01739     <span class="keywordflow">if</span> (<a class="code" href="classHeartConfig.html#a1a13023d984e6bcab3faa854847654ce">IsPostProcessingSectionPresent</a>())
<a name="l01740"></a>01740     {
<a name="l01741"></a>01741         XSD_SEQUENCE_TYPE(cp::postprocessing_type::ActionPotentialDurationMap)&amp;
<a name="l01742"></a>01742                 apd_maps = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;PostProcessing()-&gt;ActionPotentialDurationMap();
<a name="l01743"></a>01743         result = (apd_maps.begin() != apd_maps.end());
<a name="l01744"></a>01744     }
<a name="l01745"></a>01745     <span class="keywordflow">return</span> result;
<a name="l01746"></a>01746 }
<a name="l01747"></a>01747 
<a name="l01748"></a><a class="code" href="classHeartConfig.html#abe0cb02e588ffafe5a957f8dd7b062e5">01748</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#abe0cb02e588ffafe5a957f8dd7b062e5">HeartConfig::GetApdMaps</a>(std::vector&lt;std::pair&lt;double,double&gt; &gt;&amp; apd_maps)<span class="keyword"> const</span>
<a name="l01749"></a>01749 <span class="keyword"></span>{
<a name="l01750"></a>01750     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#ad6f240f8dc2d4158afa69fd3a7da9a15">IsApdMapsRequested</a>(), <span class="stringliteral">&quot;PostProcessing/ActionPotentialDurationMap&quot;</span>);
<a name="l01751"></a>01751     apd_maps.clear();
<a name="l01752"></a>01752 
<a name="l01753"></a>01753     XSD_SEQUENCE_TYPE(cp::postprocessing_type::ActionPotentialDurationMap)&amp;
<a name="l01754"></a>01754         apd_maps_sequence = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;PostProcessing()-&gt;ActionPotentialDurationMap();
<a name="l01755"></a>01755 
<a name="l01756"></a>01756     <span class="keywordflow">for</span> (XSD_ITERATOR_TYPE(cp::postprocessing_type::ActionPotentialDurationMap) i = apd_maps_sequence.begin();
<a name="l01757"></a>01757          i != apd_maps_sequence.end();
<a name="l01758"></a>01758          ++i)
<a name="l01759"></a>01759     {
<a name="l01760"></a>01760         std::pair&lt;double,double&gt; map(i-&gt;repolarisation_percentage(),i-&gt;threshold());
<a name="l01761"></a>01761 
<a name="l01762"></a>01762         apd_maps.push_back(map);
<a name="l01763"></a>01763     }
<a name="l01764"></a>01764 }
<a name="l01765"></a>01765 
<a name="l01766"></a><a class="code" href="classHeartConfig.html#a38b9c3b57116747edcf71fd6d78029d5">01766</a> <span class="keywordtype">bool</span> <a class="code" href="classHeartConfig.html#a38b9c3b57116747edcf71fd6d78029d5">HeartConfig::IsUpstrokeTimeMapsRequested</a>()<span class="keyword"> const</span>
<a name="l01767"></a>01767 <span class="keyword"></span>{
<a name="l01768"></a>01768     <span class="keywordtype">bool</span> result = <span class="keyword">false</span>;
<a name="l01769"></a>01769     <span class="keywordflow">if</span> (<a class="code" href="classHeartConfig.html#a1a13023d984e6bcab3faa854847654ce">IsPostProcessingSectionPresent</a>())
<a name="l01770"></a>01770     {
<a name="l01771"></a>01771         XSD_SEQUENCE_TYPE(cp::postprocessing_type::UpstrokeTimeMap)&amp;
<a name="l01772"></a>01772             upstroke_map = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;PostProcessing()-&gt;UpstrokeTimeMap();
<a name="l01773"></a>01773         result = (upstroke_map.begin() != upstroke_map.end());
<a name="l01774"></a>01774     }
<a name="l01775"></a>01775     <span class="keywordflow">return</span> result;
<a name="l01776"></a>01776 }
<a name="l01777"></a><a class="code" href="classHeartConfig.html#a62bf3cc55cf750ade86634a067a2879d">01777</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a62bf3cc55cf750ade86634a067a2879d">HeartConfig::GetUpstrokeTimeMaps</a> (std::vector&lt;double&gt;&amp; upstroke_time_maps)<span class="keyword"> const</span>
<a name="l01778"></a>01778 <span class="keyword"></span>{
<a name="l01779"></a>01779     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a38b9c3b57116747edcf71fd6d78029d5">IsUpstrokeTimeMapsRequested</a>(), <span class="stringliteral">&quot;PostProcessing/UpstrokeTimeMap&quot;</span>);
<a name="l01780"></a>01780     assert(upstroke_time_maps.size() == 0);
<a name="l01781"></a>01781 
<a name="l01782"></a>01782     XSD_SEQUENCE_TYPE(cp::postprocessing_type::UpstrokeTimeMap)&amp;
<a name="l01783"></a>01783         upstroke_maps_sequence = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;PostProcessing()-&gt;UpstrokeTimeMap();
<a name="l01784"></a>01784 
<a name="l01785"></a>01785     <span class="keywordflow">for</span> (XSD_ITERATOR_TYPE(cp::postprocessing_type::UpstrokeTimeMap) i = upstroke_maps_sequence.begin();
<a name="l01786"></a>01786          i != upstroke_maps_sequence.end();
<a name="l01787"></a>01787          ++i)
<a name="l01788"></a>01788     {
<a name="l01789"></a>01789         upstroke_time_maps.push_back(i-&gt;threshold());
<a name="l01790"></a>01790     }
<a name="l01791"></a>01791 }
<a name="l01792"></a>01792 
<a name="l01793"></a><a class="code" href="classHeartConfig.html#ab8fa3c6d5dfada90205d5a6458d56d30">01793</a> <span class="keywordtype">bool</span> <a class="code" href="classHeartConfig.html#ab8fa3c6d5dfada90205d5a6458d56d30">HeartConfig::IsMaxUpstrokeVelocityMapRequested</a>()<span class="keyword"> const</span>
<a name="l01794"></a>01794 <span class="keyword"></span>{
<a name="l01795"></a>01795     <span class="keywordtype">bool</span> result = <span class="keyword">false</span>;
<a name="l01796"></a>01796     <span class="keywordflow">if</span> (<a class="code" href="classHeartConfig.html#a1a13023d984e6bcab3faa854847654ce">IsPostProcessingSectionPresent</a>())
<a name="l01797"></a>01797     {
<a name="l01798"></a>01798         XSD_SEQUENCE_TYPE(cp::postprocessing_type::MaxUpstrokeVelocityMap)&amp;
<a name="l01799"></a>01799             max_upstroke_velocity_map = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;PostProcessing()-&gt;MaxUpstrokeVelocityMap();
<a name="l01800"></a>01800         result = (max_upstroke_velocity_map.begin() != max_upstroke_velocity_map.end());
<a name="l01801"></a>01801     }
<a name="l01802"></a>01802     <span class="keywordflow">return</span> result;
<a name="l01803"></a>01803 }
<a name="l01804"></a>01804 
<a name="l01805"></a><a class="code" href="classHeartConfig.html#ac7932ae837fc69987edcf13c9b0b8b63">01805</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#ac7932ae837fc69987edcf13c9b0b8b63">HeartConfig::GetMaxUpstrokeVelocityMaps</a>(std::vector&lt;double&gt;&amp; upstroke_velocity_maps)<span class="keyword"> const</span>
<a name="l01806"></a>01806 <span class="keyword"></span>{
<a name="l01807"></a>01807     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#ab8fa3c6d5dfada90205d5a6458d56d30">IsMaxUpstrokeVelocityMapRequested</a>(), <span class="stringliteral">&quot;PostProcessing/MaxUpstrokeVelocityMap&quot;</span>);
<a name="l01808"></a>01808     assert(upstroke_velocity_maps.size() == 0);
<a name="l01809"></a>01809 
<a name="l01810"></a>01810     XSD_SEQUENCE_TYPE(cp::postprocessing_type::MaxUpstrokeVelocityMap)&amp;
<a name="l01811"></a>01811         max_upstroke_velocity_maps_sequence = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;PostProcessing()-&gt;MaxUpstrokeVelocityMap();
<a name="l01812"></a>01812 
<a name="l01813"></a>01813     <span class="keywordflow">for</span> (XSD_ITERATOR_TYPE(cp::postprocessing_type::MaxUpstrokeVelocityMap) i = max_upstroke_velocity_maps_sequence.begin();
<a name="l01814"></a>01814          i != max_upstroke_velocity_maps_sequence.end();
<a name="l01815"></a>01815          ++i)
<a name="l01816"></a>01816     {
<a name="l01817"></a>01817         upstroke_velocity_maps.push_back(i-&gt;threshold());
<a name="l01818"></a>01818     }
<a name="l01819"></a>01819 }
<a name="l01820"></a>01820 
<a name="l01821"></a><a class="code" href="classHeartConfig.html#ae842eee4b5d015df2d193d11857efb91">01821</a> <span class="keywordtype">bool</span> <a class="code" href="classHeartConfig.html#ae842eee4b5d015df2d193d11857efb91">HeartConfig::IsConductionVelocityMapsRequested</a>()<span class="keyword"> const</span>
<a name="l01822"></a>01822 <span class="keyword"></span>{
<a name="l01823"></a>01823     <span class="keywordtype">bool</span> result = <span class="keyword">false</span>;
<a name="l01824"></a>01824     <span class="keywordflow">if</span> (<a class="code" href="classHeartConfig.html#a1a13023d984e6bcab3faa854847654ce">IsPostProcessingSectionPresent</a>())
<a name="l01825"></a>01825     {
<a name="l01826"></a>01826         XSD_SEQUENCE_TYPE(cp::postprocessing_type::ConductionVelocityMap)&amp;
<a name="l01827"></a>01827             cond_vel_maps = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;PostProcessing()-&gt;ConductionVelocityMap();
<a name="l01828"></a>01828         result = (cond_vel_maps.begin() != cond_vel_maps.end());
<a name="l01829"></a>01829     }
<a name="l01830"></a>01830     <span class="keywordflow">return</span> result;
<a name="l01831"></a>01831 }
<a name="l01832"></a>01832 
<a name="l01833"></a><a class="code" href="classHeartConfig.html#a24b7f74f55bac1bf28db2f9292df9048">01833</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a24b7f74f55bac1bf28db2f9292df9048">HeartConfig::GetConductionVelocityMaps</a>(std::vector&lt;unsigned&gt;&amp; conduction_velocity_maps)<span class="keyword"> const</span>
<a name="l01834"></a>01834 <span class="keyword"></span>{
<a name="l01835"></a>01835     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#ae842eee4b5d015df2d193d11857efb91">IsConductionVelocityMapsRequested</a>(), <span class="stringliteral">&quot;PostProcessing/ConductionVelocityMap&quot;</span>);
<a name="l01836"></a>01836     assert(conduction_velocity_maps.size() == 0);
<a name="l01837"></a>01837 
<a name="l01838"></a>01838     XSD_SEQUENCE_TYPE(cp::postprocessing_type::ConductionVelocityMap)&amp;
<a name="l01839"></a>01839         cond_vel_maps_sequence = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;PostProcessing()-&gt;ConductionVelocityMap();
<a name="l01840"></a>01840 
<a name="l01841"></a>01841     <span class="keywordflow">for</span> (XSD_ITERATOR_TYPE(cp::postprocessing_type::ConductionVelocityMap) i = cond_vel_maps_sequence.begin();
<a name="l01842"></a>01842          i != cond_vel_maps_sequence.end();
<a name="l01843"></a>01843          ++i)
<a name="l01844"></a>01844     {
<a name="l01845"></a>01845         conduction_velocity_maps.push_back(i-&gt;origin_node());
<a name="l01846"></a>01846     }
<a name="l01847"></a>01847 }
<a name="l01848"></a>01848 
<a name="l01849"></a><a class="code" href="classHeartConfig.html#ad88df76b31578cd3c311465294c5dafa">01849</a> <span class="keywordtype">bool</span> <a class="code" href="classHeartConfig.html#ad88df76b31578cd3c311465294c5dafa">HeartConfig::IsAnyNodalTimeTraceRequested</a>()<span class="keyword"> const</span>
<a name="l01850"></a>01850 <span class="keyword"></span>{
<a name="l01851"></a>01851     <span class="keywordtype">bool</span> result = <span class="keyword">false</span>;
<a name="l01852"></a>01852     <span class="keywordflow">if</span> (<a class="code" href="classHeartConfig.html#a1a13023d984e6bcab3faa854847654ce">IsPostProcessingSectionPresent</a>())
<a name="l01853"></a>01853     {
<a name="l01854"></a>01854         XSD_SEQUENCE_TYPE(cp::postprocessing_type::TimeTraceAtNode)&amp;
<a name="l01855"></a>01855             requested_nodes = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;PostProcessing()-&gt;TimeTraceAtNode();
<a name="l01856"></a>01856         result = (requested_nodes.begin() != requested_nodes.end());
<a name="l01857"></a>01857     }
<a name="l01858"></a>01858     <span class="keywordflow">return</span> result;
<a name="l01859"></a>01859 }
<a name="l01860"></a>01860 
<a name="l01861"></a><a class="code" href="classHeartConfig.html#a8b7c2468f9eea50704aac2c5193b7226">01861</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a8b7c2468f9eea50704aac2c5193b7226">HeartConfig::GetNodalTimeTraceRequested</a>(std::vector&lt;unsigned&gt;&amp; rRequestedNodes)<span class="keyword"> const</span>
<a name="l01862"></a>01862 <span class="keyword"></span>{
<a name="l01863"></a>01863     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#ad88df76b31578cd3c311465294c5dafa">IsAnyNodalTimeTraceRequested</a>(), <span class="stringliteral">&quot;PostProcessing/TimeTraceAtNode&quot;</span>);
<a name="l01864"></a>01864     assert(rRequestedNodes.size() == 0);
<a name="l01865"></a>01865 
<a name="l01866"></a>01866     XSD_SEQUENCE_TYPE(cp::postprocessing_type::TimeTraceAtNode)&amp;
<a name="l01867"></a>01867         req_nodes = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;PostProcessing()-&gt;TimeTraceAtNode();
<a name="l01868"></a>01868 
<a name="l01869"></a>01869     <span class="keywordflow">for</span> (XSD_ITERATOR_TYPE(cp::postprocessing_type::TimeTraceAtNode) i = req_nodes.begin();
<a name="l01870"></a>01870          i != req_nodes.end();
<a name="l01871"></a>01871          ++i)
<a name="l01872"></a>01872     {
<a name="l01873"></a>01873         rRequestedNodes.push_back(i-&gt;node_number());
<a name="l01874"></a>01874     }
<a name="l01875"></a>01875 }
<a name="l01876"></a>01876 
<a name="l01877"></a>01877 
<a name="l01878"></a><a class="code" href="classHeartConfig.html#a7700d433bf452eeb7074894bf298f944">01878</a> <span class="keywordtype">bool</span> <a class="code" href="classHeartConfig.html#a7700d433bf452eeb7074894bf298f944">HeartConfig::IsPseudoEcgCalculationRequested</a>()<span class="keyword"> const</span>
<a name="l01879"></a>01879 <span class="keyword"></span>{
<a name="l01880"></a>01880     <span class="keywordtype">bool</span> result = <span class="keyword">false</span>;
<a name="l01881"></a>01881     <span class="keywordflow">if</span> (<a class="code" href="classHeartConfig.html#a1a13023d984e6bcab3faa854847654ce">IsPostProcessingSectionPresent</a>())
<a name="l01882"></a>01882     {
<a name="l01883"></a>01883         XSD_SEQUENCE_TYPE(cp::postprocessing_type::PseudoEcgElectrodePosition)&amp;
<a name="l01884"></a>01884             electrodes = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;PostProcessing()-&gt;PseudoEcgElectrodePosition();
<a name="l01885"></a>01885         result = (electrodes.begin() != electrodes.end());
<a name="l01886"></a>01886     }
<a name="l01887"></a>01887     <span class="keywordflow">return</span> result;
<a name="l01888"></a>01888 }
<a name="l01889"></a>01889 
<a name="l01890"></a>01890 <span class="keyword">template</span>&lt;<span class="keywordtype">unsigned</span> SPACE_DIM&gt;
<a name="l01891"></a><a class="code" href="classHeartConfig.html#a28e2c87ca9ef53288b40a12e724b01a5">01891</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a28e2c87ca9ef53288b40a12e724b01a5">HeartConfig::GetPseudoEcgElectrodePositions</a>(std::vector&lt;<a class="code" href="classChastePoint.html">ChastePoint&lt;SPACE_DIM&gt;</a> &gt;&amp; rPseudoEcgElectrodePositions)<span class="keyword"> const</span>
<a name="l01892"></a>01892 <span class="keyword"></span>{
<a name="l01893"></a>01893     rPseudoEcgElectrodePositions.clear();
<a name="l01894"></a>01894     XSD_SEQUENCE_TYPE(cp::postprocessing_type::PseudoEcgElectrodePosition)&amp;
<a name="l01895"></a>01895         electrodes = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;PostProcessing()-&gt;PseudoEcgElectrodePosition();
<a name="l01896"></a>01896     <span class="keywordflow">for</span> (XSD_ITERATOR_TYPE(cp::postprocessing_type::PseudoEcgElectrodePosition) i = electrodes.begin();
<a name="l01897"></a>01897          i != electrodes.end();
<a name="l01898"></a>01898          ++i)
<a name="l01899"></a>01899     {
<a name="l01900"></a>01900         rPseudoEcgElectrodePositions.push_back(<a class="code" href="classChastePoint.html">ChastePoint&lt;SPACE_DIM&gt;</a>(i-&gt;x(), i-&gt;y(), i-&gt;z()));
<a name="l01901"></a>01901     }
<a name="l01902"></a>01902 }
<a name="l01903"></a>01903 
<a name="l01904"></a>01904 
<a name="l01905"></a>01905 <span class="comment">/*</span>
<a name="l01906"></a>01906 <span class="comment"> * Output visualization</span>
<a name="l01907"></a>01907 <span class="comment"> */</span>
<a name="l01908"></a>01908 
<a name="l01909"></a><a class="code" href="classHeartConfig.html#a3010845819f8f64a7d98f5fa022ea094">01909</a> <span class="keywordtype">bool</span> <a class="code" href="classHeartConfig.html#a3010845819f8f64a7d98f5fa022ea094">HeartConfig::IsOutputVisualizerPresent</a>()<span class="keyword"> const</span>
<a name="l01910"></a>01910 <span class="keyword"></span>{
<a name="l01911"></a>01911     <a class="code" href="classHeartConfig.html#aab7ea75d3f83c1202127db592d934532">CheckSimulationIsDefined</a>(<span class="stringliteral">&quot;OutputVisualizer&quot;</span>);
<a name="l01912"></a>01912 
<a name="l01913"></a>01913     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;OutputVisualizer().present();
<a name="l01914"></a>01914 }
<a name="l01915"></a>01915 
<a name="l01916"></a><a class="code" href="classHeartConfig.html#a5a6cd032e69ae941458277195ee966a2">01916</a> <span class="keywordtype">bool</span> <a class="code" href="classHeartConfig.html#a5a6cd032e69ae941458277195ee966a2">HeartConfig::GetVisualizeWithMeshalyzer</a>()<span class="keyword"> const</span>
<a name="l01917"></a>01917 <span class="keyword"></span>{
<a name="l01918"></a>01918     <span class="keywordflow">if</span> (!<a class="code" href="classHeartConfig.html#a3010845819f8f64a7d98f5fa022ea094">IsOutputVisualizerPresent</a>())
<a name="l01919"></a>01919     {
<a name="l01920"></a>01920         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01921"></a>01921     }
<a name="l01922"></a>01922     <span class="keywordflow">else</span>
<a name="l01923"></a>01923     {
<a name="l01924"></a>01924         <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;OutputVisualizer()-&gt;meshalyzer() == cp::yesno_type::yes;
<a name="l01925"></a>01925     }
<a name="l01926"></a>01926 }
<a name="l01927"></a>01927 
<a name="l01928"></a><a class="code" href="classHeartConfig.html#a6d9e677168ec7c1de59d35254bb71faa">01928</a> <span class="keywordtype">bool</span> <a class="code" href="classHeartConfig.html#a6d9e677168ec7c1de59d35254bb71faa">HeartConfig::GetVisualizeWithCmgui</a>()<span class="keyword"> const</span>
<a name="l01929"></a>01929 <span class="keyword"></span>{
<a name="l01930"></a>01930     <span class="keywordflow">if</span> (!<a class="code" href="classHeartConfig.html#a3010845819f8f64a7d98f5fa022ea094">IsOutputVisualizerPresent</a>())
<a name="l01931"></a>01931     {
<a name="l01932"></a>01932         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01933"></a>01933     }
<a name="l01934"></a>01934     <span class="keywordflow">else</span>
<a name="l01935"></a>01935     {
<a name="l01936"></a>01936         <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;OutputVisualizer()-&gt;cmgui() == cp::yesno_type::yes;
<a name="l01937"></a>01937     }
<a name="l01938"></a>01938 }
<a name="l01939"></a>01939 
<a name="l01940"></a><a class="code" href="classHeartConfig.html#ace22a245e446f9170c36261ee807c80f">01940</a> <span class="keywordtype">bool</span> <a class="code" href="classHeartConfig.html#ace22a245e446f9170c36261ee807c80f">HeartConfig::GetVisualizeWithParallelVtk</a>()<span class="keyword"> const</span>
<a name="l01941"></a>01941 <span class="keyword"></span>{
<a name="l01942"></a>01942     <span class="keywordflow">if</span> (!<a class="code" href="classHeartConfig.html#a3010845819f8f64a7d98f5fa022ea094">IsOutputVisualizerPresent</a>())
<a name="l01943"></a>01943     {
<a name="l01944"></a>01944         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01945"></a>01945     }
<a name="l01946"></a>01946     <span class="keywordflow">else</span>
<a name="l01947"></a>01947     {
<a name="l01948"></a>01948         <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;OutputVisualizer()-&gt;parallel_vtk() == cp::yesno_type::yes;
<a name="l01949"></a>01949     }
<a name="l01950"></a>01950 }
<a name="l01951"></a>01951 
<a name="l01952"></a><a class="code" href="classHeartConfig.html#aee1957a338ff90ace79271fda5cd3798">01952</a> <span class="keywordtype">bool</span> <a class="code" href="classHeartConfig.html#aee1957a338ff90ace79271fda5cd3798">HeartConfig::GetVisualizeWithVtk</a>()<span class="keyword"> const</span>
<a name="l01953"></a>01953 <span class="keyword"></span>{
<a name="l01954"></a>01954     <span class="keywordflow">if</span> (!<a class="code" href="classHeartConfig.html#a3010845819f8f64a7d98f5fa022ea094">IsOutputVisualizerPresent</a>())
<a name="l01955"></a>01955     {
<a name="l01956"></a>01956         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01957"></a>01957     }
<a name="l01958"></a>01958     <span class="keywordflow">else</span>
<a name="l01959"></a>01959     {
<a name="l01960"></a>01960         <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;OutputVisualizer()-&gt;vtk() == cp::yesno_type::yes;
<a name="l01961"></a>01961     }
<a name="l01962"></a>01962 }
<a name="l01963"></a>01963 
<a name="l01964"></a><a class="code" href="classHeartConfig.html#a419d743f35dd7b27de9d048f8377d048">01964</a> <span class="keywordtype">unsigned</span> <a class="code" href="classHeartConfig.html#a419d743f35dd7b27de9d048f8377d048">HeartConfig::GetVisualizerOutputPrecision</a>()
<a name="l01965"></a>01965 {
<a name="l01966"></a>01966     <span class="keywordflow">if</span> (!<a class="code" href="classHeartConfig.html#a3010845819f8f64a7d98f5fa022ea094">IsOutputVisualizerPresent</a>())
<a name="l01967"></a>01967     {
<a name="l01968"></a>01968         <span class="keywordflow">return</span> 0u;
<a name="l01969"></a>01969     }
<a name="l01970"></a>01970     <span class="keywordflow">else</span>
<a name="l01971"></a>01971     {
<a name="l01972"></a>01972         <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;OutputVisualizer()-&gt;precision();
<a name="l01973"></a>01973     }
<a name="l01974"></a>01974 }
<a name="l01975"></a>01975 
<a name="l01976"></a>01976 
<a name="l01977"></a><a class="code" href="classHeartConfig.html#ae8af113affbf405e11b536a995bb8530">01977</a> <span class="keywordtype">bool</span> <a class="code" href="classHeartConfig.html#ae8af113affbf405e11b536a995bb8530">HeartConfig::IsElectrodesPresent</a>()<span class="keyword"> const</span>
<a name="l01978"></a>01978 <span class="keyword"></span>{
<a name="l01979"></a>01979     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Electrodes().present();
<a name="l01980"></a>01980 }
<a name="l01981"></a>01981 
<a name="l01982"></a>01982 <span class="comment">/*</span>
<a name="l01983"></a>01983 <span class="comment"> *  Set methods</span>
<a name="l01984"></a>01984 <span class="comment"> */</span>
<a name="l01985"></a><a class="code" href="classHeartConfig.html#a81e1ccab8ab0b3fa759f781a9690e42e">01985</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a81e1ccab8ab0b3fa759f781a9690e42e">HeartConfig::SetSpaceDimension</a>(<span class="keywordtype">unsigned</span> spaceDimension)
<a name="l01986"></a>01986 {
<a name="l01987"></a>01987     <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;SpaceDimension().set(spaceDimension);
<a name="l01988"></a>01988 }
<a name="l01989"></a>01989 
<a name="l01990"></a><a class="code" href="classHeartConfig.html#aad5f6297757ec9b088e6ef56b9a71686">01990</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#aad5f6297757ec9b088e6ef56b9a71686">HeartConfig::SetSimulationDuration</a>(<span class="keywordtype">double</span> simulationDuration)
<a name="l01991"></a>01991 {
<a name="l01992"></a>01992     XSD_CREATE_WITH_FIXED_ATTR1(cp::time_type, time, simulationDuration, <span class="stringliteral">&quot;ms&quot;</span>);
<a name="l01993"></a>01993     <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;SimulationDuration().set(time);
<a name="l01994"></a>01994 }
<a name="l01995"></a>01995 
<a name="l01996"></a><a class="code" href="classHeartConfig.html#a6b0caf98b061c8f132b17d272fc6da2d">01996</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a6b0caf98b061c8f132b17d272fc6da2d">HeartConfig::SetDomain</a>(<span class="keyword">const</span> cp::domain_type&amp; rDomain)
<a name="l01997"></a>01997 {
<a name="l01998"></a>01998     <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Domain().set(rDomain);
<a name="l01999"></a>01999 }
<a name="l02000"></a>02000 
<a name="l02001"></a><a class="code" href="classHeartConfig.html#a315563a68be5dd8d00824a2b556239d8">02001</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a315563a68be5dd8d00824a2b556239d8">HeartConfig::SetDefaultIonicModel</a>(<span class="keyword">const</span> cp::ionic_models_available_type&amp; rIonicModel)
<a name="l02002"></a>02002 {
<a name="l02003"></a>02003     cp::ionic_model_selection_type ionic_model;
<a name="l02004"></a>02004     ionic_model.Hardcoded(rIonicModel);
<a name="l02005"></a>02005     cp::ionic_models_type container(ionic_model);
<a name="l02006"></a>02006     <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;IonicModels().set(container);
<a name="l02007"></a>02007 }
<a name="l02008"></a>02008 
<a name="l02009"></a><a class="code" href="classHeartConfig.html#a81d05b3efe45ab56d22b304bbee0be38">02009</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a81d05b3efe45ab56d22b304bbee0be38">HeartConfig::SetSlabDimensions</a>(<span class="keywordtype">double</span> x, <span class="keywordtype">double</span> y, <span class="keywordtype">double</span> z, <span class="keywordtype">double</span> inter_node_space)
<a name="l02010"></a>02010 {
<a name="l02011"></a>02011     <span class="keywordflow">if</span> ( ! <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Mesh().present())
<a name="l02012"></a>02012     {
<a name="l02013"></a>02013         XSD_CREATE_WITH_FIXED_ATTR(cp::mesh_type, mesh_to_load, <span class="stringliteral">&quot;cm&quot;</span>);
<a name="l02014"></a>02014         <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Mesh().set(mesh_to_load);
<a name="l02015"></a>02015     }
<a name="l02016"></a>02016 
<a name="l02017"></a>02017     cp::slab_type slab_definition(x, y, z, inter_node_space);
<a name="l02018"></a>02018     <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Mesh()-&gt;Slab().set(slab_definition);
<a name="l02019"></a>02019 }
<a name="l02020"></a>02020 
<a name="l02021"></a><a class="code" href="classHeartConfig.html#a39e7189e1725e0e48fd38e4bc6e06a8e">02021</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a39e7189e1725e0e48fd38e4bc6e06a8e">HeartConfig::SetSheetDimensions</a>(<span class="keywordtype">double</span> x, <span class="keywordtype">double</span> y, <span class="keywordtype">double</span> inter_node_space)
<a name="l02022"></a>02022 {
<a name="l02023"></a>02023     <span class="keywordflow">if</span> ( ! <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Mesh().present())
<a name="l02024"></a>02024     {
<a name="l02025"></a>02025         XSD_CREATE_WITH_FIXED_ATTR(cp::mesh_type, mesh_to_load, <span class="stringliteral">&quot;cm&quot;</span>);
<a name="l02026"></a>02026         <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Mesh().set(mesh_to_load);
<a name="l02027"></a>02027     }
<a name="l02028"></a>02028 
<a name="l02029"></a>02029     cp::sheet_type sheet_definition(x, y, inter_node_space);
<a name="l02030"></a>02030     <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Mesh()-&gt;Sheet().set(sheet_definition);
<a name="l02031"></a>02031 }
<a name="l02032"></a>02032 
<a name="l02033"></a><a class="code" href="classHeartConfig.html#a41771ff2cdb9689d5dff43036b8261ec">02033</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a41771ff2cdb9689d5dff43036b8261ec">HeartConfig::SetFibreLength</a>(<span class="keywordtype">double</span> x, <span class="keywordtype">double</span> inter_node_space)
<a name="l02034"></a>02034 {
<a name="l02035"></a>02035     <span class="keywordflow">if</span> ( ! <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Mesh().present())
<a name="l02036"></a>02036     {
<a name="l02037"></a>02037         XSD_CREATE_WITH_FIXED_ATTR(cp::mesh_type, mesh_to_load, <span class="stringliteral">&quot;cm&quot;</span>);
<a name="l02038"></a>02038         <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Mesh().set(mesh_to_load);
<a name="l02039"></a>02039     }
<a name="l02040"></a>02040 
<a name="l02041"></a>02041     cp::fibre_type fibre_definition(x, inter_node_space);
<a name="l02042"></a>02042     <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Mesh()-&gt;Fibre().set(fibre_definition);
<a name="l02043"></a>02043 }
<a name="l02044"></a>02044 
<a name="l02045"></a><a class="code" href="classHeartConfig.html#adc7f04b8d3bdf6a734c45fd57ffbd16d">02045</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#adc7f04b8d3bdf6a734c45fd57ffbd16d">HeartConfig::SetMeshFileName</a>(std::string meshPrefix, cp::media_type fibreDefinition)
<a name="l02046"></a>02046 {
<a name="l02047"></a>02047     <span class="keywordflow">if</span> ( ! <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Mesh().present())
<a name="l02048"></a>02048     {
<a name="l02049"></a>02049         XSD_CREATE_WITH_FIXED_ATTR(cp::mesh_type, mesh_to_load, <span class="stringliteral">&quot;cm&quot;</span>);
<a name="l02050"></a>02050         <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Mesh().set(mesh_to_load);
<a name="l02051"></a>02051     }
<a name="l02052"></a>02052 
<a name="l02053"></a>02053     XSD_NESTED_TYPE(cp::mesh_type::LoadMesh) mesh_prefix(meshPrefix, fibreDefinition);
<a name="l02054"></a>02054     <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Mesh()-&gt;LoadMesh().set(mesh_prefix);
<a name="l02055"></a>02055 }
<a name="l02056"></a>02056 
<a name="l02057"></a><a class="code" href="classHeartConfig.html#a165a75e6d71355cfcea146b578a02969">02057</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a165a75e6d71355cfcea146b578a02969">HeartConfig::SetIonicModelRegions</a>(std::vector&lt;<a class="code" href="classChasteCuboid.html">ChasteCuboid&lt;3&gt;</a> &gt;&amp; rDefinedRegions,
<a name="l02058"></a>02058                                        std::vector&lt;cp::ionic_model_selection_type&gt;&amp; rIonicModels)<span class="keyword"> const</span>
<a name="l02059"></a>02059 <span class="keyword"></span>{
<a name="l02060"></a>02060     assert(rDefinedRegions.size() == rIonicModels.size());
<a name="l02061"></a>02061     <span class="comment">// You need to have defined a default model first...</span>
<a name="l02062"></a>02062     assert(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;IonicModels().present());
<a name="l02063"></a>02063     XSD_SEQUENCE_TYPE(cp::ionic_models_type::Region)&amp;
<a name="l02064"></a>02064         regions = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;IonicModels()-&gt;Region();
<a name="l02065"></a>02065     regions.clear();
<a name="l02066"></a>02066     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> region_index=0; region_index&lt;rDefinedRegions.size(); region_index++)
<a name="l02067"></a>02067     {
<a name="l02068"></a>02068         cp::point_type point_a(rDefinedRegions[region_index].rGetLowerCorner()[0],
<a name="l02069"></a>02069                                rDefinedRegions[region_index].rGetLowerCorner()[1],
<a name="l02070"></a>02070                                rDefinedRegions[region_index].rGetLowerCorner()[2]);
<a name="l02071"></a>02071 
<a name="l02072"></a>02072         cp::point_type point_b(rDefinedRegions[region_index].rGetUpperCorner()[0],
<a name="l02073"></a>02073                                rDefinedRegions[region_index].rGetUpperCorner()[1],
<a name="l02074"></a>02074                                rDefinedRegions[region_index].rGetUpperCorner()[2]);
<a name="l02075"></a>02075 
<a name="l02076"></a>02076         XSD_CREATE_WITH_FIXED_ATTR(cp::location_type, locn, <span class="stringliteral">&quot;cm&quot;</span>);
<a name="l02077"></a>02077         locn.Cuboid().set(cp::box_type(point_a, point_b));
<a name="l02078"></a>02078 
<a name="l02079"></a>02079         cp::ionic_model_region_type region(rIonicModels[region_index], locn);
<a name="l02080"></a>02080         regions.push_back(region);
<a name="l02081"></a>02081     }
<a name="l02082"></a>02082 }
<a name="l02083"></a>02083 
<a name="l02084"></a><a class="code" href="classHeartConfig.html#ab3abba4bb2e36fd4889984be4303a495">02084</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#ab3abba4bb2e36fd4889984be4303a495">HeartConfig::SetConductivityHeterogeneities</a>(std::vector&lt;<a class="code" href="classChasteCuboid.html">ChasteCuboid&lt;3&gt;</a> &gt;&amp; conductivityAreas,
<a name="l02085"></a>02085         std::vector&lt; c_vector&lt;double,3&gt; &gt;&amp; intraConductivities,
<a name="l02086"></a>02086         std::vector&lt; c_vector&lt;double,3&gt; &gt;&amp; extraConductivities)
<a name="l02087"></a>02087 {
<a name="l02088"></a>02088     assert ( conductivityAreas.size() == intraConductivities.size() );
<a name="l02089"></a>02089     assert ( intraConductivities.size() == extraConductivities.size());
<a name="l02090"></a>02090 
<a name="l02091"></a>02091     XSD_ANON_SEQUENCE_TYPE(cp::physiological_type, ConductivityHeterogeneities, ConductivityHeterogeneity) heterogeneities_container;
<a name="l02092"></a>02092 
<a name="l02093"></a>02093     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> region_index=0; region_index&lt;conductivityAreas.size(); region_index++)
<a name="l02094"></a>02094     {
<a name="l02095"></a>02095         cp::point_type point_a(conductivityAreas[region_index].rGetLowerCorner()[0],
<a name="l02096"></a>02096                            conductivityAreas[region_index].rGetLowerCorner()[1],
<a name="l02097"></a>02097                            conductivityAreas[region_index].rGetLowerCorner()[2]);
<a name="l02098"></a>02098 
<a name="l02099"></a>02099         cp::point_type point_b(conductivityAreas[region_index].rGetUpperCorner()[0],
<a name="l02100"></a>02100                            conductivityAreas[region_index].rGetUpperCorner()[1],
<a name="l02101"></a>02101                            conductivityAreas[region_index].rGetUpperCorner()[2]);
<a name="l02102"></a>02102 
<a name="l02103"></a>02103         XSD_CREATE_WITH_FIXED_ATTR(cp::location_type, locn, <span class="stringliteral">&quot;cm&quot;</span>);
<a name="l02104"></a>02104         locn.Cuboid().set(cp::box_type(point_a, point_b));
<a name="l02105"></a>02105         cp::conductivity_heterogeneity_type ht(locn);
<a name="l02106"></a>02106 
<a name="l02107"></a>02107         XSD_CREATE_WITH_FIXED_ATTR3(cp::conductivities_type, intra,
<a name="l02108"></a>02108                                     intraConductivities[region_index][0],
<a name="l02109"></a>02109                                     intraConductivities[region_index][1],
<a name="l02110"></a>02110                                     intraConductivities[region_index][2],
<a name="l02111"></a>02111                                     <span class="stringliteral">&quot;mS/cm&quot;</span>);
<a name="l02112"></a>02112 
<a name="l02113"></a>02113         ht.IntracellularConductivities(intra);
<a name="l02114"></a>02114 
<a name="l02115"></a>02115         XSD_CREATE_WITH_FIXED_ATTR3(cp::conductivities_type, extra,
<a name="l02116"></a>02116                                     extraConductivities[region_index][0],
<a name="l02117"></a>02117                                     extraConductivities[region_index][1],
<a name="l02118"></a>02118                                     extraConductivities[region_index][2],
<a name="l02119"></a>02119                                     <span class="stringliteral">&quot;mS/cm&quot;</span>);
<a name="l02120"></a>02120 
<a name="l02121"></a>02121         ht.ExtracellularConductivities(extra);
<a name="l02122"></a>02122 
<a name="l02123"></a>02123         heterogeneities_container.push_back(ht);
<a name="l02124"></a>02124     }
<a name="l02125"></a>02125 
<a name="l02126"></a>02126     XSD_ANON_TYPE(cp::physiological_type, ConductivityHeterogeneities) heterogeneities_object;
<a name="l02127"></a>02127     heterogeneities_object.ConductivityHeterogeneity(heterogeneities_container);
<a name="l02128"></a>02128 
<a name="l02129"></a>02129     <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().ConductivityHeterogeneities().set(heterogeneities_object);
<a name="l02130"></a>02130 }
<a name="l02131"></a>02131 
<a name="l02132"></a><a class="code" href="classHeartConfig.html#aac1eff1a30d848cd88767914c7c3c4da">02132</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#aac1eff1a30d848cd88767914c7c3c4da">HeartConfig::SetConductivityHeterogeneitiesEllipsoid</a>(std::vector&lt;<a class="code" href="classChasteEllipsoid.html">ChasteEllipsoid&lt;3&gt;</a> &gt;&amp; conductivityAreas,
<a name="l02133"></a>02133         std::vector&lt; c_vector&lt;double,3&gt; &gt;&amp; intraConductivities,
<a name="l02134"></a>02134         std::vector&lt; c_vector&lt;double,3&gt; &gt;&amp; extraConductivities)
<a name="l02135"></a>02135 {
<a name="l02136"></a>02136     assert ( conductivityAreas.size() == intraConductivities.size() );
<a name="l02137"></a>02137     assert ( intraConductivities.size() == extraConductivities.size());
<a name="l02138"></a>02138 
<a name="l02139"></a>02139     XSD_ANON_SEQUENCE_TYPE(cp::physiological_type, ConductivityHeterogeneities, ConductivityHeterogeneity) heterogeneities_container;
<a name="l02140"></a>02140 
<a name="l02141"></a>02141     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> region_index=0; region_index&lt;conductivityAreas.size(); region_index++)
<a name="l02142"></a>02142     {
<a name="l02143"></a>02143         cp::point_type centre(conductivityAreas[region_index].rGetCentre()[0],
<a name="l02144"></a>02144                               conductivityAreas[region_index].rGetCentre()[1],
<a name="l02145"></a>02145                               conductivityAreas[region_index].rGetCentre()[2]);
<a name="l02146"></a>02146 
<a name="l02147"></a>02147         cp::point_type radii(conductivityAreas[region_index].rGetRadii()[0],
<a name="l02148"></a>02148                              conductivityAreas[region_index].rGetRadii()[1],
<a name="l02149"></a>02149                              conductivityAreas[region_index].rGetRadii()[2]);
<a name="l02150"></a>02150 
<a name="l02151"></a>02151         XSD_CREATE_WITH_FIXED_ATTR(cp::location_type, locn, <span class="stringliteral">&quot;cm&quot;</span>);
<a name="l02152"></a>02152         locn.Ellipsoid().set(cp::ellipsoid_type(centre, radii));
<a name="l02153"></a>02153         cp::conductivity_heterogeneity_type ht(locn);
<a name="l02154"></a>02154 
<a name="l02155"></a>02155         XSD_CREATE_WITH_FIXED_ATTR3(cp::conductivities_type, intra,
<a name="l02156"></a>02156                                     intraConductivities[region_index][0],
<a name="l02157"></a>02157                                     intraConductivities[region_index][1],
<a name="l02158"></a>02158                                     intraConductivities[region_index][2],
<a name="l02159"></a>02159                                     <span class="stringliteral">&quot;mS/cm&quot;</span>);
<a name="l02160"></a>02160 
<a name="l02161"></a>02161         ht.IntracellularConductivities(intra);
<a name="l02162"></a>02162 
<a name="l02163"></a>02163         XSD_CREATE_WITH_FIXED_ATTR3(cp::conductivities_type, extra,
<a name="l02164"></a>02164                                     extraConductivities[region_index][0],
<a name="l02165"></a>02165                                     extraConductivities[region_index][1],
<a name="l02166"></a>02166                                     extraConductivities[region_index][2],
<a name="l02167"></a>02167                                     <span class="stringliteral">&quot;mS/cm&quot;</span>);
<a name="l02168"></a>02168 
<a name="l02169"></a>02169         ht.ExtracellularConductivities(extra);
<a name="l02170"></a>02170 
<a name="l02171"></a>02171         heterogeneities_container.push_back(ht);
<a name="l02172"></a>02172     }
<a name="l02173"></a>02173 
<a name="l02174"></a>02174     XSD_ANON_TYPE(cp::physiological_type, ConductivityHeterogeneities) heterogeneities_object;
<a name="l02175"></a>02175     heterogeneities_object.ConductivityHeterogeneity(heterogeneities_container);
<a name="l02176"></a>02176 
<a name="l02177"></a>02177     <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().ConductivityHeterogeneities().set(heterogeneities_object);
<a name="l02178"></a>02178 }
<a name="l02179"></a>02179 
<a name="l02180"></a><a class="code" href="classHeartConfig.html#a5f5d3c0f60554e91bf3f670ff3d8720a">02180</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a5f5d3c0f60554e91bf3f670ff3d8720a">HeartConfig::SetOutputDirectory</a>(<span class="keyword">const</span> std::string&amp; rOutputDirectory)
<a name="l02181"></a>02181 {
<a name="l02182"></a>02182     <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;OutputDirectory().set(rOutputDirectory);
<a name="l02183"></a>02183 }
<a name="l02184"></a>02184 
<a name="l02185"></a><a class="code" href="classHeartConfig.html#ad6379d55fd7badb2720eb3d6f4b98f3f">02185</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#ad6379d55fd7badb2720eb3d6f4b98f3f">HeartConfig::SetOutputFilenamePrefix</a>(<span class="keyword">const</span> std::string&amp; rOutputFilenamePrefix)
<a name="l02186"></a>02186 {
<a name="l02187"></a>02187     <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;OutputFilenamePrefix().set(rOutputFilenamePrefix);
<a name="l02188"></a>02188 }
<a name="l02189"></a>02189 
<a name="l02190"></a><a class="code" href="classHeartConfig.html#ab4327ce8948dfdc306daaa5b733d8b7a">02190</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#ab4327ce8948dfdc306daaa5b733d8b7a">HeartConfig::SetOutputVariables</a>(<span class="keyword">const</span> std::vector&lt;std::string&gt;&amp; rOutputVariables)
<a name="l02191"></a>02191 {
<a name="l02192"></a>02192     <span class="keywordflow">if</span> ( ! <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;OutputVariables().present())
<a name="l02193"></a>02193     {
<a name="l02194"></a>02194         cp::output_variables_type variables_requested;
<a name="l02195"></a>02195         <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;OutputVariables().set(variables_requested);
<a name="l02196"></a>02196     }
<a name="l02197"></a>02197 
<a name="l02198"></a>02198     XSD_SEQUENCE_TYPE(cp::output_variables_type::Var)&amp;
<a name="l02199"></a>02199         var_type_sequence = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;OutputVariables()-&gt;Var();
<a name="l02200"></a>02200     <span class="comment">//Erase or create a sequence</span>
<a name="l02201"></a>02201     var_type_sequence.clear();
<a name="l02202"></a>02202 
<a name="l02203"></a>02203     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0; i&lt;rOutputVariables.size(); i++)
<a name="l02204"></a>02204     {
<a name="l02205"></a>02205         cp::var_type temp(rOutputVariables[i]);
<a name="l02206"></a>02206         var_type_sequence.push_back(temp);
<a name="l02207"></a>02207     }
<a name="l02208"></a>02208 }
<a name="l02209"></a>02209 
<a name="l02210"></a><a class="code" href="classHeartConfig.html#a54fc7f20367a1fe629eb68b7fab40bf0">02210</a> <span class="keywordtype">void</span>  <a class="code" href="classHeartConfig.html#a54fc7f20367a1fe629eb68b7fab40bf0">HeartConfig::SetOutputUsingOriginalNodeOrdering</a>(<span class="keywordtype">bool</span> useOriginal)
<a name="l02211"></a>02211 {
<a name="l02212"></a>02212     <span class="comment">//What if it doesn&#39;t exist?</span>
<a name="l02213"></a>02213     <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;OutputUsingOriginalNodeOrdering().set(useOriginal? cp::yesno_type::yes : cp::yesno_type::no);
<a name="l02214"></a>02214 }
<a name="l02215"></a>02215 
<a name="l02216"></a><a class="code" href="classHeartConfig.html#ad7acbc17d4e8fbf7f3c8dcf17340afe4">02216</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#ad7acbc17d4e8fbf7f3c8dcf17340afe4">HeartConfig::SetCheckpointSimulation</a>(<span class="keywordtype">bool</span> saveSimulation, <span class="keywordtype">double</span> checkpointTimestep, <span class="keywordtype">unsigned</span> maxCheckpointsOnDisk)
<a name="l02217"></a>02217 {
<a name="l02218"></a>02218     <span class="keywordflow">if</span> (saveSimulation)
<a name="l02219"></a>02219     {
<a name="l02220"></a>02220         <span class="comment">// Make sure values for the optional parameters have been provided</span>
<a name="l02221"></a>02221         assert(checkpointTimestep!=-1.0 &amp;&amp; maxCheckpointsOnDisk!=UINT_MAX);
<a name="l02222"></a>02222 
<a name="l02223"></a>02223         XSD_CREATE_WITH_FIXED_ATTR2(cp::simulation_type::XSD_NESTED_TYPE(CheckpointSimulation),
<a name="l02224"></a>02224                                     cs,
<a name="l02225"></a>02225                                     checkpointTimestep,
<a name="l02226"></a>02226                                     maxCheckpointsOnDisk,
<a name="l02227"></a>02227                                     <span class="stringliteral">&quot;ms&quot;</span>);
<a name="l02228"></a>02228         <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;CheckpointSimulation().set(cs);
<a name="l02229"></a>02229     }
<a name="l02230"></a>02230     <span class="keywordflow">else</span>
<a name="l02231"></a>02231     {
<a name="l02232"></a>02232         <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;CheckpointSimulation().reset();
<a name="l02233"></a>02233     }
<a name="l02234"></a>02234 
<a name="l02235"></a>02235     <a class="code" href="classHeartConfig.html#aef79708e5e663a9ea5ff236ecc0bbd85">CheckTimeSteps</a>();
<a name="l02236"></a>02236 }
<a name="l02237"></a>02237 
<a name="l02238"></a>02238 <span class="comment">// Physiological</span>
<a name="l02239"></a>02239 
<a name="l02240"></a><a class="code" href="classHeartConfig.html#a0e141c92e1f34c89d3f397027fcbaf4f">02240</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a0e141c92e1f34c89d3f397027fcbaf4f">HeartConfig::SetIntracellularConductivities</a>(<span class="keyword">const</span> c_vector&lt;double, 3&gt;&amp; intraConductivities)
<a name="l02241"></a>02241 {
<a name="l02242"></a>02242     XSD_CREATE_WITH_FIXED_ATTR3(cp::conductivities_type, intra,
<a name="l02243"></a>02243                                 intraConductivities[0],
<a name="l02244"></a>02244                                 intraConductivities[1],
<a name="l02245"></a>02245                                 intraConductivities[2],
<a name="l02246"></a>02246                                 <span class="stringliteral">&quot;mS/cm&quot;</span>);
<a name="l02247"></a>02247 
<a name="l02248"></a>02248     <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().IntracellularConductivities().set(intra);
<a name="l02249"></a>02249 }
<a name="l02250"></a>02250 
<a name="l02251"></a><a class="code" href="classHeartConfig.html#a8d50f87b6a8dda6a0ccde7d22f0f96ef">02251</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a0e141c92e1f34c89d3f397027fcbaf4f">HeartConfig::SetIntracellularConductivities</a>(<span class="keyword">const</span> c_vector&lt;double, 2&gt;&amp; intraConductivities)
<a name="l02252"></a>02252 {
<a name="l02253"></a>02253     XSD_CREATE_WITH_FIXED_ATTR3(cp::conductivities_type, intra,
<a name="l02254"></a>02254                                 intraConductivities[0],
<a name="l02255"></a>02255                                 intraConductivities[1],
<a name="l02256"></a>02256                                 0.0, <span class="stringliteral">&quot;mS/cm&quot;</span>);
<a name="l02257"></a>02257 
<a name="l02258"></a>02258     <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().IntracellularConductivities().set(intra);
<a name="l02259"></a>02259 }
<a name="l02260"></a>02260 
<a name="l02261"></a><a class="code" href="classHeartConfig.html#a7f0f10e4ab23fca3436ee9aeb7a73d75">02261</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a0e141c92e1f34c89d3f397027fcbaf4f">HeartConfig::SetIntracellularConductivities</a>(<span class="keyword">const</span> c_vector&lt;double, 1&gt;&amp; intraConductivities)
<a name="l02262"></a>02262 {
<a name="l02263"></a>02263     XSD_CREATE_WITH_FIXED_ATTR3(cp::conductivities_type, intra,
<a name="l02264"></a>02264                                 intraConductivities[0],
<a name="l02265"></a>02265                                 0.0, 0.0, <span class="stringliteral">&quot;mS/cm&quot;</span>);
<a name="l02266"></a>02266 
<a name="l02267"></a>02267     <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().IntracellularConductivities().set(intra);
<a name="l02268"></a>02268 }
<a name="l02269"></a>02269 
<a name="l02270"></a><a class="code" href="classHeartConfig.html#aa69b80a3c82b3a095a5a3decde05eaba">02270</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#aa69b80a3c82b3a095a5a3decde05eaba">HeartConfig::SetExtracellularConductivities</a>(<span class="keyword">const</span> c_vector&lt;double, 3&gt;&amp; extraConductivities)
<a name="l02271"></a>02271 {
<a name="l02272"></a>02272     XSD_CREATE_WITH_FIXED_ATTR3(cp::conductivities_type, extra,
<a name="l02273"></a>02273                                 extraConductivities[0],
<a name="l02274"></a>02274                                 extraConductivities[1],
<a name="l02275"></a>02275                                 extraConductivities[2],
<a name="l02276"></a>02276                                 <span class="stringliteral">&quot;mS/cm&quot;</span>);
<a name="l02277"></a>02277 
<a name="l02278"></a>02278     <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().ExtracellularConductivities().set(extra);
<a name="l02279"></a>02279 }
<a name="l02280"></a>02280 
<a name="l02281"></a><a class="code" href="classHeartConfig.html#a5b786bc27fda207b790c0a09b0584f45">02281</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#aa69b80a3c82b3a095a5a3decde05eaba">HeartConfig::SetExtracellularConductivities</a>(<span class="keyword">const</span> c_vector&lt;double, 2&gt;&amp; extraConductivities)
<a name="l02282"></a>02282 {
<a name="l02283"></a>02283     XSD_CREATE_WITH_FIXED_ATTR3(cp::conductivities_type, extra,
<a name="l02284"></a>02284                                 extraConductivities[0],
<a name="l02285"></a>02285                                 extraConductivities[1],
<a name="l02286"></a>02286                                 0.0, <span class="stringliteral">&quot;mS/cm&quot;</span>);
<a name="l02287"></a>02287 
<a name="l02288"></a>02288     <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().ExtracellularConductivities().set(extra);
<a name="l02289"></a>02289 }
<a name="l02290"></a>02290 
<a name="l02291"></a><a class="code" href="classHeartConfig.html#ad90b3240afadc81d15959825685bb16e">02291</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#aa69b80a3c82b3a095a5a3decde05eaba">HeartConfig::SetExtracellularConductivities</a>(<span class="keyword">const</span> c_vector&lt;double, 1&gt;&amp; extraConductivities)
<a name="l02292"></a>02292 {
<a name="l02293"></a>02293     XSD_CREATE_WITH_FIXED_ATTR3(cp::conductivities_type, extra,
<a name="l02294"></a>02294                                 extraConductivities[0],
<a name="l02295"></a>02295                                 0.0, 0.0, <span class="stringliteral">&quot;mS/cm&quot;</span>);
<a name="l02296"></a>02296 
<a name="l02297"></a>02297     <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().ExtracellularConductivities().set(extra);
<a name="l02298"></a>02298 }
<a name="l02299"></a>02299 
<a name="l02300"></a><a class="code" href="classHeartConfig.html#a994cb2f7b3edc1c45ba43fc967a98a8a">02300</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a994cb2f7b3edc1c45ba43fc967a98a8a">HeartConfig::SetBathConductivity</a>(<span class="keywordtype">double</span> bathConductivity)
<a name="l02301"></a>02301 {
<a name="l02302"></a>02302     XSD_CREATE_WITH_FIXED_ATTR1(cp::conductivity_type, cond, bathConductivity, <span class="stringliteral">&quot;mS/cm&quot;</span>);
<a name="l02303"></a>02303     <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().BathConductivity().set(cond);
<a name="l02304"></a>02304 }
<a name="l02305"></a>02305 
<a name="l02306"></a><a class="code" href="classHeartConfig.html#a1ed47d4bfc27b26595496006fd941463">02306</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a1ed47d4bfc27b26595496006fd941463">HeartConfig::SetBathMultipleConductivities</a>(std::map&lt;unsigned, double&gt; bathConductivities)
<a name="l02307"></a>02307 {
<a name="l02309"></a>02309     <a class="code" href="classHeartConfig.html#a5f7071e5af04a3024ef80365f8eb2780">mBathConductivities</a> = bathConductivities;
<a name="l02310"></a>02310 }
<a name="l02311"></a>02311 
<a name="l02312"></a>02312 <span class="comment">//void HeartConfig::SetTissueIdentifiers(const std::set&lt;unsigned&gt;&amp; tissueIds)</span>
<a name="l02313"></a>02313 <span class="comment">//{</span>
<a name="l02314"></a>02314 <span class="comment">//    std::set&lt;unsigned&gt; empty_bath_identifiers;  //Too dangerous (see GetValidBathId)</span>
<a name="l02315"></a>02315 <span class="comment">//    SetTissueAndBathIdentifiers(tissueIds, mBathIdentifiers);</span>
<a name="l02316"></a>02316 <span class="comment">//}</span>
<a name="l02317"></a>02317 
<a name="l02318"></a><a class="code" href="classHeartConfig.html#a30a5a763ea093dbd6e9bba7141455281">02318</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a30a5a763ea093dbd6e9bba7141455281">HeartConfig::SetTissueAndBathIdentifiers</a>(<span class="keyword">const</span> std::set&lt;unsigned&gt;&amp; tissueIds, <span class="keyword">const</span> std::set&lt;unsigned&gt;&amp; bathIds)
<a name="l02319"></a>02319 {
<a name="l02320"></a>02320     <span class="keywordflow">if</span> (tissueIds.empty() || bathIds.empty() )
<a name="l02321"></a>02321     {
<a name="l02322"></a>02322         <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a>(<span class="stringliteral">&quot;Identifying set must be non-empty&quot;</span>);
<a name="l02323"></a>02323     }
<a name="l02324"></a>02324     std::set&lt;unsigned&gt; shared_identifiers;
<a name="l02325"></a>02325     std::set_intersection(tissueIds.begin(),
<a name="l02326"></a>02326                           tissueIds.end(),
<a name="l02327"></a>02327                           bathIds.begin(),
<a name="l02328"></a>02328                           bathIds.end(),
<a name="l02329"></a>02329                           std::inserter(shared_identifiers, shared_identifiers.begin()));
<a name="l02330"></a>02330 
<a name="l02331"></a>02331     <span class="keywordflow">if</span> (!shared_identifiers.empty())
<a name="l02332"></a>02332     {
<a name="l02333"></a>02333         <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a>(<span class="stringliteral">&quot;Tissue identifiers and bath identifiers overlap&quot;</span>);
<a name="l02334"></a>02334     }
<a name="l02335"></a>02335     <a class="code" href="classHeartConfig.html#ac657f43ca4d92bfd3c5e2270e7470429">mTissueIdentifiers</a>=tissueIds;
<a name="l02336"></a>02336     <a class="code" href="classHeartConfig.html#a1471127f954fea7a8eb5811ec448f0cc">mBathIdentifiers</a>=bathIds;
<a name="l02337"></a>02337 }
<a name="l02338"></a>02338 
<a name="l02339"></a><a class="code" href="classHeartConfig.html#a8a91b9567843043c5b9f1d05779816a9">02339</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a8a91b9567843043c5b9f1d05779816a9">HeartConfig::SetSurfaceAreaToVolumeRatio</a>(<span class="keywordtype">double</span> ratio)
<a name="l02340"></a>02340 {
<a name="l02341"></a>02341     XSD_CREATE_WITH_FIXED_ATTR1(cp::inverse_length_type, ratio_object, ratio, <span class="stringliteral">&quot;1/cm&quot;</span>);
<a name="l02342"></a>02342     <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().SurfaceAreaToVolumeRatio().set(ratio_object);
<a name="l02343"></a>02343 }
<a name="l02344"></a>02344 
<a name="l02345"></a><a class="code" href="classHeartConfig.html#aaed8e9a14106071416be8e010fed3875">02345</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#aaed8e9a14106071416be8e010fed3875">HeartConfig::SetCapacitance</a>(<span class="keywordtype">double</span> capacitance)
<a name="l02346"></a>02346 {
<a name="l02347"></a>02347     XSD_CREATE_WITH_FIXED_ATTR1(cp::capacitance_type, capacitance_object, capacitance, <span class="stringliteral">&quot;uF/cm^2&quot;</span>);
<a name="l02348"></a>02348     <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().Capacitance().set(capacitance_object);
<a name="l02349"></a>02349 }
<a name="l02350"></a>02350 
<a name="l02351"></a>02351 
<a name="l02352"></a>02352 <span class="comment">// Numerical</span>
<a name="l02353"></a><a class="code" href="classHeartConfig.html#afae11c8b1e28bbe357b62a6aff92ed26">02353</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#afae11c8b1e28bbe357b62a6aff92ed26">HeartConfig::SetOdePdeAndPrintingTimeSteps</a>(<span class="keywordtype">double</span> odeTimeStep, <span class="keywordtype">double</span> pdeTimeStep, <span class="keywordtype">double</span> printingTimeStep)
<a name="l02354"></a>02354 {
<a name="l02355"></a>02355     XSD_CREATE_WITH_FIXED_ATTR3(cp::time_steps_type, time_steps,
<a name="l02356"></a>02356                                 odeTimeStep, pdeTimeStep, printingTimeStep, <span class="stringliteral">&quot;ms&quot;</span>);
<a name="l02357"></a>02357     <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().TimeSteps().set(time_steps);
<a name="l02358"></a>02358     <a class="code" href="classHeartConfig.html#aef79708e5e663a9ea5ff236ecc0bbd85">CheckTimeSteps</a>();
<a name="l02359"></a>02359 }
<a name="l02360"></a>02360 
<a name="l02361"></a><a class="code" href="classHeartConfig.html#a937009fb9049e72e963d21a9962d2d2f">02361</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a937009fb9049e72e963d21a9962d2d2f">HeartConfig::SetOdeTimeStep</a>(<span class="keywordtype">double</span> odeTimeStep)
<a name="l02362"></a>02362 {
<a name="l02363"></a>02363     <a class="code" href="classHeartConfig.html#afae11c8b1e28bbe357b62a6aff92ed26">SetOdePdeAndPrintingTimeSteps</a>(odeTimeStep, <a class="code" href="classHeartConfig.html#ac20bbc4140281b206a260a82cb59ab0f">GetPdeTimeStep</a>(), <a class="code" href="classHeartConfig.html#a33ae21f4b16476aa5cb975a455c5ba19">GetPrintingTimeStep</a>());
<a name="l02364"></a>02364 }
<a name="l02365"></a>02365 
<a name="l02366"></a><a class="code" href="classHeartConfig.html#a7f6b79cb359a97a70ab489d6eebc3183">02366</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a7f6b79cb359a97a70ab489d6eebc3183">HeartConfig::SetPdeTimeStep</a>(<span class="keywordtype">double</span> pdeTimeStep)
<a name="l02367"></a>02367 {
<a name="l02368"></a>02368     <a class="code" href="classHeartConfig.html#afae11c8b1e28bbe357b62a6aff92ed26">SetOdePdeAndPrintingTimeSteps</a>(<a class="code" href="classHeartConfig.html#a383ab1c116a88ecd3f973ef371a2c8d9">GetOdeTimeStep</a>(), pdeTimeStep, <a class="code" href="classHeartConfig.html#a33ae21f4b16476aa5cb975a455c5ba19">GetPrintingTimeStep</a>());
<a name="l02369"></a>02369 }
<a name="l02370"></a>02370 
<a name="l02371"></a><a class="code" href="classHeartConfig.html#a3b331a2888f584fdcf391e012bb36062">02371</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a3b331a2888f584fdcf391e012bb36062">HeartConfig::SetPrintingTimeStep</a>(<span class="keywordtype">double</span> printingTimeStep)
<a name="l02372"></a>02372 {
<a name="l02373"></a>02373     <a class="code" href="classHeartConfig.html#afae11c8b1e28bbe357b62a6aff92ed26">SetOdePdeAndPrintingTimeSteps</a>(<a class="code" href="classHeartConfig.html#a383ab1c116a88ecd3f973ef371a2c8d9">GetOdeTimeStep</a>(), <a class="code" href="classHeartConfig.html#ac20bbc4140281b206a260a82cb59ab0f">GetPdeTimeStep</a>(), printingTimeStep);
<a name="l02374"></a>02374 }
<a name="l02375"></a>02375 
<a name="l02376"></a><a class="code" href="classHeartConfig.html#aef79708e5e663a9ea5ff236ecc0bbd85">02376</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#aef79708e5e663a9ea5ff236ecc0bbd85">HeartConfig::CheckTimeSteps</a>()<span class="keyword"> const</span>
<a name="l02377"></a>02377 <span class="keyword"></span>{
<a name="l02378"></a>02378     <span class="keywordflow">if</span> (<a class="code" href="classHeartConfig.html#a383ab1c116a88ecd3f973ef371a2c8d9">GetOdeTimeStep</a>() &lt;= 0)
<a name="l02379"></a>02379     {
<a name="l02380"></a>02380         <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a>(<span class="stringliteral">&quot;Ode time-step should be positive&quot;</span>);
<a name="l02381"></a>02381     }
<a name="l02382"></a>02382     <span class="keywordflow">if</span> (<a class="code" href="classHeartConfig.html#ac20bbc4140281b206a260a82cb59ab0f">GetPdeTimeStep</a>() &lt;= 0)
<a name="l02383"></a>02383     {
<a name="l02384"></a>02384         <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a>(<span class="stringliteral">&quot;Pde time-step should be positive&quot;</span>);
<a name="l02385"></a>02385     }
<a name="l02386"></a>02386     <span class="keywordflow">if</span> (<a class="code" href="classHeartConfig.html#a33ae21f4b16476aa5cb975a455c5ba19">GetPrintingTimeStep</a>() &lt;= 0.0)
<a name="l02387"></a>02387     {
<a name="l02388"></a>02388         <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a>(<span class="stringliteral">&quot;Printing time-step should be positive&quot;</span>);
<a name="l02389"></a>02389     }
<a name="l02390"></a>02390 
<a name="l02391"></a>02391     <span class="keywordflow">if</span> (<a class="code" href="classHeartConfig.html#ac20bbc4140281b206a260a82cb59ab0f">GetPdeTimeStep</a>()&gt;<a class="code" href="classHeartConfig.html#a33ae21f4b16476aa5cb975a455c5ba19">GetPrintingTimeStep</a>())
<a name="l02392"></a>02392     {
<a name="l02393"></a>02393         <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a>(<span class="stringliteral">&quot;Printing time-step should not be smaller than PDE time-step&quot;</span>);
<a name="l02394"></a>02394     }
<a name="l02395"></a>02395 
<a name="l02396"></a>02396     <span class="keywordflow">if</span> ( !Divides(<a class="code" href="classHeartConfig.html#ac20bbc4140281b206a260a82cb59ab0f">GetPdeTimeStep</a>(), <a class="code" href="classHeartConfig.html#a33ae21f4b16476aa5cb975a455c5ba19">GetPrintingTimeStep</a>()) )
<a name="l02397"></a>02397     {
<a name="l02398"></a>02398         <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a>(<span class="stringliteral">&quot;Printing time-step should be a multiple of PDE time step&quot;</span>);
<a name="l02399"></a>02399     }
<a name="l02400"></a>02400 
<a name="l02401"></a>02401     <span class="keywordflow">if</span> ( <a class="code" href="classHeartConfig.html#a383ab1c116a88ecd3f973ef371a2c8d9">GetOdeTimeStep</a>() &gt; <a class="code" href="classHeartConfig.html#ac20bbc4140281b206a260a82cb59ab0f">GetPdeTimeStep</a>() )
<a name="l02402"></a>02402     {
<a name="l02403"></a>02403         <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a>(<span class="stringliteral">&quot;Ode time-step should not be greater than PDE time-step&quot;</span>);
<a name="l02404"></a>02404     }
<a name="l02405"></a>02405 
<a name="l02406"></a>02406     <span class="keywordflow">if</span> (<a class="code" href="classHeartConfig.html#a34e25b3a25618f0f8721c678e6b12f95">GetCheckpointSimulation</a>())
<a name="l02407"></a>02407     {
<a name="l02408"></a>02408         <span class="keywordflow">if</span> (<a class="code" href="classHeartConfig.html#a80bb45c8945a0a3b98b5a1151d79143a">GetCheckpointTimestep</a>() &lt;= 0.0)
<a name="l02409"></a>02409         {
<a name="l02410"></a>02410             <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a>(<span class="stringliteral">&quot;Checkpoint time-step should be positive&quot;</span>);
<a name="l02411"></a>02411         }
<a name="l02412"></a>02412 
<a name="l02413"></a>02413         <span class="keywordflow">if</span> ( !Divides(<a class="code" href="classHeartConfig.html#a33ae21f4b16476aa5cb975a455c5ba19">GetPrintingTimeStep</a>(), <a class="code" href="classHeartConfig.html#a80bb45c8945a0a3b98b5a1151d79143a">GetCheckpointTimestep</a>()) )
<a name="l02414"></a>02414         {
<a name="l02415"></a>02415             <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a>(<span class="stringliteral">&quot;Checkpoint time-step should be a multiple of printing time-step&quot;</span>);
<a name="l02416"></a>02416         }
<a name="l02417"></a>02417     }
<a name="l02418"></a>02418 }
<a name="l02419"></a>02419 
<a name="l02420"></a>02420 
<a name="l02421"></a><a class="code" href="classHeartConfig.html#a7af488fdbe5832371862ac122a174f2f">02421</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a7af488fdbe5832371862ac122a174f2f">HeartConfig::SetUseRelativeTolerance</a>(<span class="keywordtype">double</span> relativeTolerance)
<a name="l02422"></a>02422 {
<a name="l02423"></a>02423     ENSURE_SECTION_PRESENT(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().KSPTolerances(), cp::ksp_tolerances_type);
<a name="l02424"></a>02424     <span class="comment">//Remove any reference to tolerances is user parameters</span>
<a name="l02425"></a>02425     <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().KSPTolerances()-&gt;KSPAbsolute().reset();
<a name="l02426"></a>02426     <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().KSPTolerances()-&gt;KSPRelative().set(relativeTolerance);
<a name="l02427"></a>02427 }
<a name="l02428"></a>02428 
<a name="l02429"></a><a class="code" href="classHeartConfig.html#a8d20fbbb42fd8f8d6afcc725f2b10acf">02429</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a8d20fbbb42fd8f8d6afcc725f2b10acf">HeartConfig::SetUseAbsoluteTolerance</a>(<span class="keywordtype">double</span> absoluteTolerance)
<a name="l02430"></a>02430 {
<a name="l02431"></a>02431     ENSURE_SECTION_PRESENT(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().KSPTolerances(), cp::ksp_tolerances_type);
<a name="l02432"></a>02432     <span class="comment">//Remove any reference to tolerances is user parameters</span>
<a name="l02433"></a>02433     <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().KSPTolerances()-&gt;KSPRelative().reset();
<a name="l02434"></a>02434     <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().KSPTolerances()-&gt;KSPAbsolute().set(absoluteTolerance);
<a name="l02435"></a>02435 }
<a name="l02436"></a>02436 
<a name="l02437"></a><a class="code" href="classHeartConfig.html#a51f3c41544800db334d954246454423c">02437</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a51f3c41544800db334d954246454423c">HeartConfig::SetKSPSolver</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* kspSolver, <span class="keywordtype">bool</span> warnOfChange)
<a name="l02438"></a>02438 {
<a name="l02439"></a>02439     <span class="keywordflow">if</span> (warnOfChange &amp;&amp; strcmp(<a class="code" href="classHeartConfig.html#ac50d7e66e3a6127cf337d2f65638ad6b">GetKSPSolver</a>(), kspSolver) != 0)
<a name="l02440"></a>02440     {
<a name="l02441"></a>02441         <span class="comment">//Warn</span>
<a name="l02442"></a>02442         WARNING(<span class="stringliteral">&quot;Code has changed the KSP solver type from &quot;</span>&lt;&lt;<a class="code" href="classHeartConfig.html#ac50d7e66e3a6127cf337d2f65638ad6b">GetKSPSolver</a>()&lt;&lt;<span class="stringliteral">&quot; to &quot;</span>&lt;&lt; kspSolver);
<a name="l02443"></a>02443     }
<a name="l02444"></a>02444 
<a name="l02445"></a>02445     <span class="comment">/* Note that changes in these conditions need to be reflected in the Doxygen*/</span>
<a name="l02446"></a>02446     <span class="keywordflow">if</span> ( strcmp(kspSolver, <span class="stringliteral">&quot;gmres&quot;</span>) == 0)
<a name="l02447"></a>02447     {
<a name="l02448"></a>02448         <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().KSPSolver().set(cp::ksp_solver_type::gmres);
<a name="l02449"></a>02449         <span class="keywordflow">return</span>;
<a name="l02450"></a>02450     }
<a name="l02451"></a>02451     <span class="keywordflow">if</span> ( strcmp(kspSolver, <span class="stringliteral">&quot;cg&quot;</span>) == 0)
<a name="l02452"></a>02452     {
<a name="l02453"></a>02453         <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().KSPSolver().set(cp::ksp_solver_type::cg);
<a name="l02454"></a>02454         <span class="keywordflow">return</span>;
<a name="l02455"></a>02455     }
<a name="l02456"></a>02456     <span class="keywordflow">if</span> ( strcmp(kspSolver, <span class="stringliteral">&quot;symmlq&quot;</span>) == 0)
<a name="l02457"></a>02457     {
<a name="l02458"></a>02458         <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().KSPSolver().set(cp::ksp_solver_type::symmlq);
<a name="l02459"></a>02459         <span class="keywordflow">return</span>;
<a name="l02460"></a>02460     }
<a name="l02461"></a>02461     <span class="keywordflow">if</span> ( strcmp(kspSolver, <span class="stringliteral">&quot;chebychev&quot;</span>) == 0)
<a name="l02462"></a>02462     {
<a name="l02463"></a>02463         <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().KSPSolver().set(cp::ksp_solver_type::chebychev);
<a name="l02464"></a>02464         <span class="keywordflow">return</span>;
<a name="l02465"></a>02465     }
<a name="l02466"></a>02466 
<a name="l02467"></a>02467     <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a>(<span class="stringliteral">&quot;Unknown solver type provided&quot;</span>);
<a name="l02468"></a>02468 }
<a name="l02469"></a>02469 
<a name="l02470"></a><a class="code" href="classHeartConfig.html#a913a9b2cab5c9223e61ec8033c60c20d">02470</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a913a9b2cab5c9223e61ec8033c60c20d">HeartConfig::SetKSPPreconditioner</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* kspPreconditioner)
<a name="l02471"></a>02471 {
<a name="l02472"></a>02472     <span class="comment">/* Note that changes in these conditions need to be reflected in the Doxygen*/</span>
<a name="l02473"></a>02473     <span class="keywordflow">if</span> ( strcmp(kspPreconditioner, <span class="stringliteral">&quot;jacobi&quot;</span>) == 0)
<a name="l02474"></a>02474     {
<a name="l02475"></a>02475         <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().KSPPreconditioner().set(cp::ksp_preconditioner_type::jacobi);
<a name="l02476"></a>02476         <span class="keywordflow">return</span>;
<a name="l02477"></a>02477     }
<a name="l02478"></a>02478     <span class="keywordflow">if</span> ( strcmp(kspPreconditioner, <span class="stringliteral">&quot;bjacobi&quot;</span>) == 0)
<a name="l02479"></a>02479     {
<a name="l02480"></a>02480         <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().KSPPreconditioner().set(cp::ksp_preconditioner_type::bjacobi);
<a name="l02481"></a>02481         <span class="keywordflow">return</span>;
<a name="l02482"></a>02482     }
<a name="l02483"></a>02483     <span class="keywordflow">if</span> ( strcmp(kspPreconditioner, <span class="stringliteral">&quot;hypre&quot;</span>) == 0)
<a name="l02484"></a>02484     {
<a name="l02485"></a>02485         <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().KSPPreconditioner().set(cp::ksp_preconditioner_type::hypre);
<a name="l02486"></a>02486         <span class="keywordflow">return</span>;
<a name="l02487"></a>02487     }
<a name="l02488"></a>02488     <span class="keywordflow">if</span> ( strcmp(kspPreconditioner, <span class="stringliteral">&quot;ml&quot;</span>) == 0)
<a name="l02489"></a>02489     {
<a name="l02490"></a>02490         <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().KSPPreconditioner().set(cp::ksp_preconditioner_type::ml);
<a name="l02491"></a>02491         <span class="keywordflow">return</span>;
<a name="l02492"></a>02492     }
<a name="l02493"></a>02493     <span class="keywordflow">if</span> ( strcmp(kspPreconditioner, <span class="stringliteral">&quot;spai&quot;</span>) == 0)
<a name="l02494"></a>02494     {
<a name="l02495"></a>02495         <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().KSPPreconditioner().set(cp::ksp_preconditioner_type::spai);
<a name="l02496"></a>02496         <span class="keywordflow">return</span>;
<a name="l02497"></a>02497     }
<a name="l02498"></a>02498     <span class="keywordflow">if</span> ( strcmp(kspPreconditioner, <span class="stringliteral">&quot;twolevelsblockdiagonal&quot;</span>) == 0)
<a name="l02499"></a>02499     {
<a name="l02500"></a>02500         <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().KSPPreconditioner().set(cp::ksp_preconditioner_type::twolevelsblockdiagonal);
<a name="l02501"></a>02501         <span class="keywordflow">return</span>;
<a name="l02502"></a>02502     }
<a name="l02503"></a>02503     <span class="keywordflow">if</span> ( strcmp(kspPreconditioner, <span class="stringliteral">&quot;blockdiagonal&quot;</span>) == 0)
<a name="l02504"></a>02504     {
<a name="l02505"></a>02505         <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().KSPPreconditioner().set(cp::ksp_preconditioner_type::blockdiagonal);
<a name="l02506"></a>02506         <span class="keywordflow">return</span>;
<a name="l02507"></a>02507     }
<a name="l02508"></a>02508     <span class="keywordflow">if</span> ( strcmp(kspPreconditioner, <span class="stringliteral">&quot;ldufactorisation&quot;</span>) == 0)
<a name="l02509"></a>02509     {
<a name="l02510"></a>02510         <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().KSPPreconditioner().set(cp::ksp_preconditioner_type::ldufactorisation);
<a name="l02511"></a>02511         <span class="keywordflow">return</span>;
<a name="l02512"></a>02512     }
<a name="l02513"></a>02513     <span class="keywordflow">if</span> ( strcmp(kspPreconditioner, <span class="stringliteral">&quot;none&quot;</span>) == 0)
<a name="l02514"></a>02514     {
<a name="l02515"></a>02515         <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().KSPPreconditioner().set(cp::ksp_preconditioner_type::none);
<a name="l02516"></a>02516         <span class="keywordflow">return</span>;
<a name="l02517"></a>02517     }
<a name="l02518"></a>02518 
<a name="l02519"></a>02519     <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a>(<span class="stringliteral">&quot;Unknown preconditioner type provided&quot;</span>);
<a name="l02520"></a>02520 }
<a name="l02521"></a>02521 
<a name="l02522"></a><a class="code" href="classHeartConfig.html#a77b2a1b00344f7012ea8610d6315324c">02522</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a77b2a1b00344f7012ea8610d6315324c">HeartConfig::SetMeshPartitioning</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* meshPartioningMethod)
<a name="l02523"></a>02523 {
<a name="l02524"></a>02524     <span class="comment">/* Note that changes in these conditions need to be reflected in the Doxygen*/</span>
<a name="l02525"></a>02525     <span class="keywordflow">if</span> ( strcmp(meshPartioningMethod, <span class="stringliteral">&quot;dumb&quot;</span>) == 0)
<a name="l02526"></a>02526     {
<a name="l02527"></a>02527         <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().MeshPartitioning().set(cp::mesh_partitioning_type::dumb);
<a name="l02528"></a>02528         <span class="keywordflow">return</span>;
<a name="l02529"></a>02529     }
<a name="l02530"></a>02530     <span class="keywordflow">if</span> ( strcmp(meshPartioningMethod, <span class="stringliteral">&quot;metis&quot;</span>) == 0)
<a name="l02531"></a>02531     {
<a name="l02532"></a>02532         <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().MeshPartitioning().set(cp::mesh_partitioning_type::metis);
<a name="l02533"></a>02533         <span class="keywordflow">return</span>;
<a name="l02534"></a>02534     }
<a name="l02535"></a>02535     <span class="keywordflow">if</span> ( strcmp(meshPartioningMethod, <span class="stringliteral">&quot;parmetis&quot;</span>) == 0)
<a name="l02536"></a>02536     {
<a name="l02537"></a>02537         <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().MeshPartitioning().set(cp::mesh_partitioning_type::parmetis);
<a name="l02538"></a>02538         <span class="keywordflow">return</span>;
<a name="l02539"></a>02539     }
<a name="l02540"></a>02540     <span class="keywordflow">if</span> ( strcmp(meshPartioningMethod, <span class="stringliteral">&quot;petsc&quot;</span>) == 0)
<a name="l02541"></a>02541     {
<a name="l02542"></a>02542         <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().MeshPartitioning().set(cp::mesh_partitioning_type::petsc);
<a name="l02543"></a>02543         <span class="keywordflow">return</span>;
<a name="l02544"></a>02544     }
<a name="l02545"></a>02545 
<a name="l02546"></a>02546     <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a>(<span class="stringliteral">&quot;Unknown mesh partitioning method provided&quot;</span>);
<a name="l02547"></a>02547 }
<a name="l02548"></a>02548 
<a name="l02549"></a>02549 
<a name="l02550"></a><a class="code" href="classHeartConfig.html#a46a0aee372225151c523f521b2e70354">02550</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a46a0aee372225151c523f521b2e70354">HeartConfig::SetApdMaps</a>(<span class="keyword">const</span> std::vector&lt;std::pair&lt;double,double&gt; &gt;&amp; apdMaps)
<a name="l02551"></a>02551 {
<a name="l02552"></a>02552     <a class="code" href="classHeartConfig.html#a66b61cef16319298971d3961516229db">EnsurePostProcessingSectionPresent</a>();
<a name="l02553"></a>02553     XSD_SEQUENCE_TYPE(cp::postprocessing_type::ActionPotentialDurationMap)&amp; apd_maps_sequence
<a name="l02554"></a>02554         = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;PostProcessing()-&gt;ActionPotentialDurationMap();
<a name="l02555"></a>02555     <span class="comment">//Erase or create a sequence</span>
<a name="l02556"></a>02556     apd_maps_sequence.clear();
<a name="l02557"></a>02557 
<a name="l02558"></a>02558     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0; i&lt;apdMaps.size(); i++)
<a name="l02559"></a>02559     {
<a name="l02560"></a>02560         XSD_CREATE_WITH_FIXED_ATTR2(cp::apd_map_type, temp,
<a name="l02561"></a>02561                                     apdMaps[i].first, apdMaps[i].second,
<a name="l02562"></a>02562                                     <span class="stringliteral">&quot;mV&quot;</span>);
<a name="l02563"></a>02563         apd_maps_sequence.push_back( temp);
<a name="l02564"></a>02564     }
<a name="l02565"></a>02565 }
<a name="l02566"></a>02566 
<a name="l02567"></a>02567 
<a name="l02568"></a><a class="code" href="classHeartConfig.html#a44efaadc8d2d6d415bac30db41c10604">02568</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a44efaadc8d2d6d415bac30db41c10604">HeartConfig::SetUpstrokeTimeMaps</a> (std::vector&lt;double&gt;&amp; upstrokeTimeMaps)
<a name="l02569"></a>02569 {
<a name="l02570"></a>02570     <a class="code" href="classHeartConfig.html#a66b61cef16319298971d3961516229db">EnsurePostProcessingSectionPresent</a>();
<a name="l02571"></a>02571     XSD_SEQUENCE_TYPE(cp::postprocessing_type::UpstrokeTimeMap)&amp; var_type_sequence
<a name="l02572"></a>02572         = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;PostProcessing()-&gt;UpstrokeTimeMap();
<a name="l02573"></a>02573 
<a name="l02574"></a>02574     <span class="comment">//Erase or create a sequence</span>
<a name="l02575"></a>02575     var_type_sequence.clear();
<a name="l02576"></a>02576 
<a name="l02577"></a>02577     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0; i&lt;upstrokeTimeMaps.size(); i++)
<a name="l02578"></a>02578     {
<a name="l02579"></a>02579         XSD_CREATE_WITH_FIXED_ATTR1(cp::upstrokes_map_type, temp,
<a name="l02580"></a>02580                                     upstrokeTimeMaps[i],
<a name="l02581"></a>02581                                     <span class="stringliteral">&quot;mV&quot;</span>);
<a name="l02582"></a>02582         var_type_sequence.push_back(temp);
<a name="l02583"></a>02583     }
<a name="l02584"></a>02584 }
<a name="l02585"></a>02585 
<a name="l02586"></a><a class="code" href="classHeartConfig.html#a16bdac7c8f00948b957b99d4c606bf80">02586</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a16bdac7c8f00948b957b99d4c606bf80">HeartConfig::SetMaxUpstrokeVelocityMaps</a> (std::vector&lt;double&gt;&amp; maxUpstrokeVelocityMaps)
<a name="l02587"></a>02587 {
<a name="l02588"></a>02588     <a class="code" href="classHeartConfig.html#a66b61cef16319298971d3961516229db">EnsurePostProcessingSectionPresent</a>();
<a name="l02589"></a>02589     XSD_SEQUENCE_TYPE(cp::postprocessing_type::MaxUpstrokeVelocityMap)&amp; max_upstroke_velocity_maps_sequence
<a name="l02590"></a>02590         = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;PostProcessing()-&gt;MaxUpstrokeVelocityMap();
<a name="l02591"></a>02591 
<a name="l02592"></a>02592     <span class="comment">//Erase or create a sequence</span>
<a name="l02593"></a>02593     max_upstroke_velocity_maps_sequence.clear();
<a name="l02594"></a>02594 
<a name="l02595"></a>02595     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0; i&lt;maxUpstrokeVelocityMaps.size(); i++)
<a name="l02596"></a>02596     {
<a name="l02597"></a>02597         XSD_CREATE_WITH_FIXED_ATTR1(cp::max_upstrokes_velocity_map_type, temp,
<a name="l02598"></a>02598                                     maxUpstrokeVelocityMaps[i],
<a name="l02599"></a>02599                                     <span class="stringliteral">&quot;mV&quot;</span>);
<a name="l02600"></a>02600 
<a name="l02601"></a>02601 
<a name="l02602"></a>02602         max_upstroke_velocity_maps_sequence.push_back(temp);
<a name="l02603"></a>02603     }
<a name="l02604"></a>02604 
<a name="l02605"></a>02605 }
<a name="l02606"></a>02606 
<a name="l02607"></a><a class="code" href="classHeartConfig.html#ab109643161a85ddcbbe620065d14d186">02607</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#ab109643161a85ddcbbe620065d14d186">HeartConfig::SetConductionVelocityMaps</a> (std::vector&lt;unsigned&gt;&amp; conductionVelocityMaps)
<a name="l02608"></a>02608 {
<a name="l02609"></a>02609     <a class="code" href="classHeartConfig.html#a66b61cef16319298971d3961516229db">EnsurePostProcessingSectionPresent</a>();
<a name="l02610"></a>02610     XSD_SEQUENCE_TYPE(cp::postprocessing_type::ConductionVelocityMap)&amp; conduction_velocity_maps_sequence
<a name="l02611"></a>02611         = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;PostProcessing()-&gt;ConductionVelocityMap();
<a name="l02612"></a>02612 
<a name="l02613"></a>02613     <span class="comment">//Erase or create a sequence</span>
<a name="l02614"></a>02614     conduction_velocity_maps_sequence.clear();
<a name="l02615"></a>02615 
<a name="l02616"></a>02616     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0; i&lt;conductionVelocityMaps.size(); i++)
<a name="l02617"></a>02617     {
<a name="l02618"></a>02618         cp::conduction_velocity_map_type temp(conductionVelocityMaps[i]);
<a name="l02619"></a>02619         conduction_velocity_maps_sequence.push_back(temp);
<a name="l02620"></a>02620     }
<a name="l02621"></a>02621 }
<a name="l02622"></a>02622 
<a name="l02623"></a><a class="code" href="classHeartConfig.html#a039813d26b718f5811ed09da0dda0306">02623</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a039813d26b718f5811ed09da0dda0306">HeartConfig::SetRequestedNodalTimeTraces</a> (std::vector&lt;unsigned&gt;&amp; requestedNodes)
<a name="l02624"></a>02624 {
<a name="l02625"></a>02625     <a class="code" href="classHeartConfig.html#a66b61cef16319298971d3961516229db">EnsurePostProcessingSectionPresent</a>();
<a name="l02626"></a>02626     XSD_SEQUENCE_TYPE(cp::postprocessing_type::TimeTraceAtNode)&amp; requested_nodes_sequence
<a name="l02627"></a>02627         = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;PostProcessing()-&gt;TimeTraceAtNode();
<a name="l02628"></a>02628 
<a name="l02629"></a>02629     <span class="comment">//Erase or create a sequence</span>
<a name="l02630"></a>02630     requested_nodes_sequence.clear();
<a name="l02631"></a>02631 
<a name="l02632"></a>02632     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0; i&lt;requestedNodes.size(); i++)
<a name="l02633"></a>02633     {
<a name="l02634"></a>02634         cp::node_number_type temp(requestedNodes[i]);
<a name="l02635"></a>02635         requested_nodes_sequence.push_back(temp);
<a name="l02636"></a>02636     }
<a name="l02637"></a>02637 }
<a name="l02638"></a>02638 
<a name="l02639"></a>02639 <span class="keyword">template</span>&lt;<span class="keywordtype">unsigned</span> SPACE_DIM&gt;
<a name="l02640"></a><a class="code" href="classHeartConfig.html#a31c997d4d91e1bb1cbb0177d29186cd8">02640</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a31c997d4d91e1bb1cbb0177d29186cd8">HeartConfig::SetPseudoEcgElectrodePositions</a>(<span class="keyword">const</span> std::vector&lt;<a class="code" href="classChastePoint.html">ChastePoint&lt;SPACE_DIM&gt;</a> &gt;&amp; rPseudoEcgElectrodePositions)
<a name="l02641"></a>02641 {
<a name="l02642"></a>02642     <a class="code" href="classHeartConfig.html#a66b61cef16319298971d3961516229db">EnsurePostProcessingSectionPresent</a>();
<a name="l02643"></a>02643     XSD_SEQUENCE_TYPE(cp::postprocessing_type::PseudoEcgElectrodePosition)&amp; electrodes_sequence
<a name="l02644"></a>02644         = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;PostProcessing()-&gt;PseudoEcgElectrodePosition();
<a name="l02645"></a>02645 
<a name="l02646"></a>02646     <span class="comment">//Erase or create a sequence</span>
<a name="l02647"></a>02647     electrodes_sequence.clear();
<a name="l02648"></a>02648 
<a name="l02649"></a>02649     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0; i&lt;rPseudoEcgElectrodePositions.size(); i++)
<a name="l02650"></a>02650     {
<a name="l02651"></a>02651         cp::point_type temp(rPseudoEcgElectrodePositions[i].GetWithDefault(0),
<a name="l02652"></a>02652                             rPseudoEcgElectrodePositions[i].GetWithDefault(1),
<a name="l02653"></a>02653                             rPseudoEcgElectrodePositions[i].GetWithDefault(2));
<a name="l02654"></a>02654         electrodes_sequence.push_back(temp);
<a name="l02655"></a>02655     }
<a name="l02656"></a>02656 }
<a name="l02657"></a>02657 
<a name="l02658"></a>02658 
<a name="l02659"></a>02659 <span class="comment">/*</span>
<a name="l02660"></a>02660 <span class="comment"> * Output visualizer</span>
<a name="l02661"></a>02661 <span class="comment"> */</span>
<a name="l02662"></a>02662 
<a name="l02663"></a><a class="code" href="classHeartConfig.html#a73fef33f054b532719b5f83a784b2c0c">02663</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a73fef33f054b532719b5f83a784b2c0c">HeartConfig::EnsureOutputVisualizerExists</a>()
<a name="l02664"></a>02664 {
<a name="l02665"></a>02665     ENSURE_SECTION_PRESENT(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;OutputVisualizer(), cp::output_visualizer_type);
<a name="l02666"></a>02666 }
<a name="l02667"></a>02667 
<a name="l02668"></a><a class="code" href="classHeartConfig.html#a7ef84b9090f708031aac64b7504742e0">02668</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a7ef84b9090f708031aac64b7504742e0">HeartConfig::SetVisualizeWithMeshalyzer</a>(<span class="keywordtype">bool</span> useMeshalyzer)
<a name="l02669"></a>02669 {
<a name="l02670"></a>02670     <a class="code" href="classHeartConfig.html#a73fef33f054b532719b5f83a784b2c0c">EnsureOutputVisualizerExists</a>();
<a name="l02671"></a>02671 
<a name="l02672"></a>02672     <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;OutputVisualizer()-&gt;meshalyzer(
<a name="l02673"></a>02673         useMeshalyzer ? cp::yesno_type::yes : cp::yesno_type::no);
<a name="l02674"></a>02674 }
<a name="l02675"></a>02675 
<a name="l02676"></a><a class="code" href="classHeartConfig.html#af1c744570c4f03ee01b52c62ca4ef40f">02676</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#af1c744570c4f03ee01b52c62ca4ef40f">HeartConfig::SetVisualizeWithCmgui</a>(<span class="keywordtype">bool</span> useCmgui)
<a name="l02677"></a>02677 {
<a name="l02678"></a>02678     <a class="code" href="classHeartConfig.html#a73fef33f054b532719b5f83a784b2c0c">EnsureOutputVisualizerExists</a>();
<a name="l02679"></a>02679 
<a name="l02680"></a>02680     <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;OutputVisualizer()-&gt;cmgui(
<a name="l02681"></a>02681         useCmgui ? cp::yesno_type::yes : cp::yesno_type::no);
<a name="l02682"></a>02682 }
<a name="l02683"></a>02683 
<a name="l02684"></a><a class="code" href="classHeartConfig.html#aa64153e80db50c971a58069dd3e1350e">02684</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#aa64153e80db50c971a58069dd3e1350e">HeartConfig::SetVisualizeWithVtk</a>(<span class="keywordtype">bool</span> useVtk)
<a name="l02685"></a>02685 {
<a name="l02686"></a>02686     <a class="code" href="classHeartConfig.html#a73fef33f054b532719b5f83a784b2c0c">EnsureOutputVisualizerExists</a>();
<a name="l02687"></a>02687 
<a name="l02688"></a>02688     <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;OutputVisualizer()-&gt;vtk(
<a name="l02689"></a>02689         useVtk ? cp::yesno_type::yes : cp::yesno_type::no);
<a name="l02690"></a>02690 }
<a name="l02691"></a>02691 
<a name="l02692"></a><a class="code" href="classHeartConfig.html#af43426509538104d4a68b88328c470a6">02692</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#af43426509538104d4a68b88328c470a6">HeartConfig::SetVisualizeWithParallelVtk</a>(<span class="keywordtype">bool</span> useParallelVtk)
<a name="l02693"></a>02693 {
<a name="l02694"></a>02694     <a class="code" href="classHeartConfig.html#a73fef33f054b532719b5f83a784b2c0c">EnsureOutputVisualizerExists</a>();
<a name="l02695"></a>02695 
<a name="l02696"></a>02696     <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;OutputVisualizer()-&gt;parallel_vtk(
<a name="l02697"></a>02697         useParallelVtk ? cp::yesno_type::yes : cp::yesno_type::no);
<a name="l02698"></a>02698 }
<a name="l02699"></a>02699 
<a name="l02700"></a><a class="code" href="classHeartConfig.html#af97cd21d7a5db1698c1072738cba0623">02700</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#af97cd21d7a5db1698c1072738cba0623">HeartConfig::SetVisualizerOutputPrecision</a>(<span class="keywordtype">unsigned</span> numberOfDigits)
<a name="l02701"></a>02701 {
<a name="l02702"></a>02702     <a class="code" href="classHeartConfig.html#a73fef33f054b532719b5f83a784b2c0c">EnsureOutputVisualizerExists</a>();
<a name="l02703"></a>02703 
<a name="l02704"></a>02704     <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;OutputVisualizer()-&gt;precision(numberOfDigits);
<a name="l02705"></a>02705 }
<a name="l02706"></a>02706 
<a name="l02707"></a>02707 
<a name="l02708"></a><a class="code" href="classHeartConfig.html#a37e6290f609b9921dc5a0f25a38dcdee">02708</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a37e6290f609b9921dc5a0f25a38dcdee">HeartConfig::SetElectrodeParameters</a>(<span class="keywordtype">bool</span> groundSecondElectrode,
<a name="l02709"></a>02709                                          <span class="keywordtype">unsigned</span> index, <span class="keywordtype">double</span> magnitude,
<a name="l02710"></a>02710                                          <span class="keywordtype">double</span> startTime, <span class="keywordtype">double</span> duration )
<a name="l02711"></a>02711 {
<a name="l02712"></a>02712     assert(index &lt; 3);
<a name="l02713"></a>02713 
<a name="l02714"></a>02714     cp::axis_type axis = cp::axis_type::x;
<a name="l02715"></a>02715     <span class="keywordflow">if</span> (index==1)
<a name="l02716"></a>02716     {
<a name="l02717"></a>02717         axis = cp::axis_type::y;
<a name="l02718"></a>02718     }
<a name="l02719"></a>02719     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (index==2)
<a name="l02720"></a>02720     {
<a name="l02721"></a>02721         axis = cp::axis_type::z;
<a name="l02722"></a>02722     }
<a name="l02723"></a>02723 
<a name="l02724"></a>02724     XSD_CREATE_WITH_FIXED_ATTR1(cp::surface_stimulus_strength_type, strength, magnitude, <span class="stringliteral">&quot;uA/cm^2&quot;</span>);
<a name="l02725"></a>02725     XSD_CREATE_WITH_FIXED_ATTR1(cp::time_type, start_time, startTime, <span class="stringliteral">&quot;ms&quot;</span>);
<a name="l02726"></a>02726     XSD_CREATE_WITH_FIXED_ATTR1(cp::time_type, duration_time, duration, <span class="stringliteral">&quot;ms&quot;</span>);
<a name="l02727"></a>02727 
<a name="l02728"></a>02728     <span class="keywordflow">if</span> (!<a class="code" href="classHeartConfig.html#ae8af113affbf405e11b536a995bb8530">IsElectrodesPresent</a>())
<a name="l02729"></a>02729     {
<a name="l02730"></a>02730         cp::electrodes_type element( groundSecondElectrode ? cp::yesno_type::yes : cp::yesno_type::no,
<a name="l02731"></a>02731                                      axis,
<a name="l02732"></a>02732                                      strength,
<a name="l02733"></a>02733                                      start_time,
<a name="l02734"></a>02734                                      duration_time );
<a name="l02735"></a>02735         <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Electrodes().set(element);
<a name="l02736"></a>02736     }
<a name="l02737"></a>02737     <span class="keywordflow">else</span>
<a name="l02738"></a>02738     {
<a name="l02739"></a>02739         <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Electrodes()-&gt;GroundSecondElectrode(groundSecondElectrode ? cp::yesno_type::yes : cp::yesno_type::no);
<a name="l02740"></a>02740         <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Electrodes()-&gt;PerpendicularToAxis(axis);
<a name="l02741"></a>02741         <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Electrodes()-&gt;Strength(strength);
<a name="l02742"></a>02742         <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Electrodes()-&gt;StartTime(start_time);
<a name="l02743"></a>02743         <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Electrodes()-&gt;Duration(duration_time);
<a name="l02744"></a>02744     }
<a name="l02745"></a>02745 }
<a name="l02746"></a>02746 
<a name="l02747"></a><a class="code" href="classHeartConfig.html#abbfee3679dfe3964f5db187145084dc9">02747</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#abbfee3679dfe3964f5db187145084dc9">HeartConfig::GetElectrodeParameters</a>(<span class="keywordtype">bool</span>&amp; rGroundSecondElectrode,
<a name="l02748"></a>02748                                          <span class="keywordtype">unsigned</span>&amp; rIndex, <span class="keywordtype">double</span>&amp; rMagnitude,
<a name="l02749"></a>02749                                          <span class="keywordtype">double</span>&amp; rStartTime, <span class="keywordtype">double</span>&amp; rDuration )
<a name="l02750"></a>02750 {
<a name="l02751"></a>02751     <span class="keywordflow">if</span> (!<a class="code" href="classHeartConfig.html#ae8af113affbf405e11b536a995bb8530">IsElectrodesPresent</a>())
<a name="l02752"></a>02752     {
<a name="l02753"></a>02753         <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a>(<span class="stringliteral">&quot;Attempted to get electrodes that have not been defined.&quot;</span>);
<a name="l02754"></a>02754     }
<a name="l02755"></a>02755     <span class="keywordflow">else</span>
<a name="l02756"></a>02756     {
<a name="l02757"></a>02757         rGroundSecondElectrode = (<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Electrodes()-&gt;GroundSecondElectrode()==cp::yesno_type::yes);
<a name="l02758"></a>02758 
<a name="l02759"></a>02759         cp::axis_type axis = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Electrodes()-&gt;PerpendicularToAxis();
<a name="l02760"></a>02760         <span class="keywordflow">if</span> (axis==cp::axis_type::x)
<a name="l02761"></a>02761         {
<a name="l02762"></a>02762             rIndex = 0;
<a name="l02763"></a>02763         }
<a name="l02764"></a>02764         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (axis==cp::axis_type::y)
<a name="l02765"></a>02765         {
<a name="l02766"></a>02766             rIndex = 1;
<a name="l02767"></a>02767         }
<a name="l02768"></a>02768         <span class="keywordflow">else</span>
<a name="l02769"></a>02769         {
<a name="l02770"></a>02770             rIndex = 2;
<a name="l02771"></a>02771         }
<a name="l02772"></a>02772 
<a name="l02773"></a>02773         rMagnitude = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Electrodes()-&gt;Strength();
<a name="l02774"></a>02774         rStartTime = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Electrodes()-&gt;StartTime();
<a name="l02775"></a>02775         rDuration = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Electrodes()-&gt;Duration();
<a name="l02776"></a>02776     }
<a name="l02777"></a>02777 
<a name="l02778"></a>02778 }
<a name="l02779"></a>02779 
<a name="l02780"></a><a class="code" href="classHeartConfig.html#afbfe229dd570539f508a395ef7c0cdf6">02780</a> <span class="keywordtype">bool</span> <a class="code" href="classHeartConfig.html#afbfe229dd570539f508a395ef7c0cdf6">HeartConfig::GetUseStateVariableInterpolation</a>()<span class="keyword"> const</span>
<a name="l02781"></a>02781 <span class="keyword"></span>{
<a name="l02782"></a>02782     <span class="comment">// If it&#39;s an older version parameters &amp; defaults (we&#39;re loading a checkpoint) say &#39;no&#39;</span>
<a name="l02783"></a>02783     <span class="keywordtype">bool</span> result = <span class="keyword">false</span>;
<a name="l02784"></a>02784     <span class="keywordflow">if</span> (<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().UseStateVariableInterpolation().present())
<a name="l02785"></a>02785     {
<a name="l02786"></a>02786         result = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().UseStateVariableInterpolation().get() == cp::yesno_type::yes;
<a name="l02787"></a>02787     }
<a name="l02788"></a>02788     <span class="keywordflow">return</span> result;
<a name="l02789"></a>02789 }
<a name="l02790"></a>02790 
<a name="l02791"></a><a class="code" href="classHeartConfig.html#a7515aa0d0eda9b74eee15ba3e3bc94ca">02791</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a7515aa0d0eda9b74eee15ba3e3bc94ca">HeartConfig::SetUseStateVariableInterpolation</a>(<span class="keywordtype">bool</span> useStateVariableInterpolation)
<a name="l02792"></a>02792 {
<a name="l02793"></a>02793     <span class="keywordflow">if</span> (useStateVariableInterpolation)
<a name="l02794"></a>02794     {
<a name="l02795"></a>02795         <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().UseStateVariableInterpolation().set(cp::yesno_type::yes);
<a name="l02796"></a>02796     }
<a name="l02797"></a>02797     <span class="keywordflow">else</span>
<a name="l02798"></a>02798     {
<a name="l02799"></a>02799         <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Numerical().UseStateVariableInterpolation().set(cp::yesno_type::no);
<a name="l02800"></a>02800     }
<a name="l02801"></a>02801 }
<a name="l02802"></a>02802 
<a name="l02803"></a>02803 
<a name="l02804"></a>02804 
<a name="l02805"></a><a class="code" href="classHeartConfig.html#a23c9c1ad89e590979fa482ff51c2e57a">02805</a> <span class="keywordtype">bool</span> <a class="code" href="classHeartConfig.html#a23c9c1ad89e590979fa482ff51c2e57a">HeartConfig::HasDrugDose</a>()<span class="keyword"> const</span>
<a name="l02806"></a>02806 <span class="keyword"></span>{
<a name="l02807"></a>02807     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().ApplyDrug().present();
<a name="l02808"></a>02808 }
<a name="l02809"></a>02809 
<a name="l02810"></a><a class="code" href="classHeartConfig.html#a5c527c55741ca679a4d017b72126700a">02810</a> <span class="keywordtype">double</span> <a class="code" href="classHeartConfig.html#a5c527c55741ca679a4d017b72126700a">HeartConfig::GetDrugDose</a>()<span class="keyword"> const</span>
<a name="l02811"></a>02811 <span class="keyword"></span>{
<a name="l02812"></a>02812     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a23c9c1ad89e590979fa482ff51c2e57a">HasDrugDose</a>(), <span class="stringliteral">&quot;Physiological/ApplyDrug&quot;</span>);
<a name="l02813"></a>02813     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().ApplyDrug()-&gt;concentration();
<a name="l02814"></a>02814 }
<a name="l02815"></a>02815 
<a name="l02816"></a><a class="code" href="classHeartConfig.html#a4d4dbabe117107031e2451e05fdf1b35">02816</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a4d4dbabe117107031e2451e05fdf1b35">HeartConfig::SetDrugDose</a>(<span class="keywordtype">double</span> drugDose)
<a name="l02817"></a>02817 {
<a name="l02818"></a>02818     <span class="keywordflow">if</span> (!<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().ApplyDrug().present())
<a name="l02819"></a>02819     {
<a name="l02820"></a>02820         cp::apply_drug_type drug(drugDose);
<a name="l02821"></a>02821         <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().ApplyDrug().set(drug);
<a name="l02822"></a>02822     }
<a name="l02823"></a>02823     <span class="keywordflow">else</span>
<a name="l02824"></a>02824     {
<a name="l02825"></a>02825         <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().ApplyDrug()-&gt;concentration(drugDose);
<a name="l02826"></a>02826     }
<a name="l02827"></a>02827 }
<a name="l02828"></a>02828 
<a name="l02829"></a><a class="code" href="classHeartConfig.html#ac5924ffcb6b5c5202eafbf87bc499acb">02829</a> std::map&lt;std::string, std::pair&lt;double, double&gt; &gt; <a class="code" href="classHeartConfig.html#ac5924ffcb6b5c5202eafbf87bc499acb">HeartConfig::GetIc50Values</a>()
<a name="l02830"></a>02830 {
<a name="l02831"></a>02831     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a23c9c1ad89e590979fa482ff51c2e57a">HasDrugDose</a>(), <span class="stringliteral">&quot;Physiological/ApplyDrug&quot;</span>);
<a name="l02832"></a>02832     std::map&lt;std::string, std::pair&lt;double, double&gt; &gt; ic50s;
<a name="l02833"></a>02833 
<a name="l02834"></a>02834     XSD_SEQUENCE_TYPE(cp::apply_drug_type::IC50)&amp;
<a name="l02835"></a>02835         ic50_seq = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().ApplyDrug()-&gt;IC50();
<a name="l02836"></a>02836 
<a name="l02837"></a>02837     <span class="keywordflow">for</span> (XSD_ITERATOR_TYPE(cp::apply_drug_type::IC50) i = ic50_seq.begin();
<a name="l02838"></a>02838          i != ic50_seq.end();
<a name="l02839"></a>02839          ++i)
<a name="l02840"></a>02840     {
<a name="l02841"></a>02841         std::pair&lt;double, double&gt; ic50_hill(*i, i-&gt;hill());
<a name="l02842"></a>02842         std::string current = i-&gt;current();
<a name="l02843"></a>02843         ic50s[current] = ic50_hill;
<a name="l02844"></a>02844     }
<a name="l02845"></a>02845 
<a name="l02846"></a>02846     <span class="keywordflow">return</span> ic50s;
<a name="l02847"></a>02847 }
<a name="l02848"></a>02848 
<a name="l02849"></a><a class="code" href="classHeartConfig.html#a5f10bf2e6cd00ccead4b501e6e66a369">02849</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a5f10bf2e6cd00ccead4b501e6e66a369">HeartConfig::SetIc50Value</a>(<span class="keyword">const</span> std::string&amp; rCurrentName, <span class="keywordtype">double</span> ic50, <span class="keywordtype">double</span> hill)
<a name="l02850"></a>02850 {
<a name="l02851"></a>02851     <span class="keywordflow">if</span> (!<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().ApplyDrug().present())
<a name="l02852"></a>02852     {
<a name="l02853"></a>02853         <a class="code" href="classHeartConfig.html#a4d4dbabe117107031e2451e05fdf1b35">SetDrugDose</a>(0.0);
<a name="l02854"></a>02854     }
<a name="l02855"></a>02855     XSD_SEQUENCE_TYPE(cp::apply_drug_type::IC50)&amp; ic50_seq = <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().ApplyDrug()-&gt;IC50();
<a name="l02856"></a>02856     <span class="keywordflow">if</span> (ic50_seq.empty())
<a name="l02857"></a>02857     {
<a name="l02858"></a>02858         <span class="comment">// Erase or create a sequence</span>
<a name="l02859"></a>02859         ic50_seq.clear();
<a name="l02860"></a>02860     }
<a name="l02861"></a>02861     <span class="keywordtype">bool</span> entry_exists = <span class="keyword">false</span>;
<a name="l02862"></a>02862     cp::ic50_type ic50_elt(ic50, rCurrentName);
<a name="l02863"></a>02863     ic50_elt.hill(hill);
<a name="l02864"></a>02864     <span class="keywordflow">for</span> (XSD_ITERATOR_TYPE(cp::apply_drug_type::IC50) i = ic50_seq.begin();
<a name="l02865"></a>02865          i != ic50_seq.end();
<a name="l02866"></a>02866          ++i)
<a name="l02867"></a>02867     {
<a name="l02868"></a>02868         <span class="keywordflow">if</span> (i-&gt;current() == rCurrentName)
<a name="l02869"></a>02869         {
<a name="l02870"></a>02870             entry_exists = <span class="keyword">true</span>;
<a name="l02871"></a>02871             *i = ic50_elt;
<a name="l02872"></a>02872             <span class="keywordflow">break</span>;
<a name="l02873"></a>02873         }
<a name="l02874"></a>02874     }
<a name="l02875"></a>02875     <span class="keywordflow">if</span> (!entry_exists)
<a name="l02876"></a>02876     {
<a name="l02877"></a>02877         ic50_seq.push_back(ic50_elt);
<a name="l02878"></a>02878     }
<a name="l02879"></a>02879 }
<a name="l02880"></a>02880 
<a name="l02881"></a>02881 
<a name="l02882"></a>02882 
<a name="l02883"></a><a class="code" href="classHeartConfig.html#aec6e4d8eae6507dcc71a5725a2687eb2">02883</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#aec6e4d8eae6507dcc71a5725a2687eb2">HeartConfig::SetUseMassLumping</a>(<span class="keywordtype">bool</span> useMassLumping)
<a name="l02884"></a>02884 {
<a name="l02885"></a>02885     <a class="code" href="classHeartConfig.html#a8dec021b51fe856a7fa9f9f4efdb75bd">mUseMassLumping</a> = useMassLumping;
<a name="l02886"></a>02886 }
<a name="l02887"></a>02887 
<a name="l02888"></a><a class="code" href="classHeartConfig.html#a6a885095c6fc46a6bb7e68774e57227f">02888</a> <span class="keywordtype">bool</span> <a class="code" href="classHeartConfig.html#a6a885095c6fc46a6bb7e68774e57227f">HeartConfig::GetUseMassLumping</a>()
<a name="l02889"></a>02889 {
<a name="l02890"></a>02890     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a8dec021b51fe856a7fa9f9f4efdb75bd">mUseMassLumping</a>;
<a name="l02891"></a>02891 }
<a name="l02892"></a>02892 
<a name="l02893"></a><a class="code" href="classHeartConfig.html#a0d1a94db0e34ed8795d59ac46944fe17">02893</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a0d1a94db0e34ed8795d59ac46944fe17">HeartConfig::SetUseMassLumpingForPrecond</a>(<span class="keywordtype">bool</span> useMassLumping)
<a name="l02894"></a>02894 {
<a name="l02895"></a>02895     <a class="code" href="classHeartConfig.html#ac92f76dda02e32251cb54ab8db4e4731">mUseMassLumpingForPrecond</a> = useMassLumping;
<a name="l02896"></a>02896 }
<a name="l02897"></a>02897 
<a name="l02898"></a><a class="code" href="classHeartConfig.html#ad80730768d7bcee8bcda3b44315a172b">02898</a> <span class="keywordtype">bool</span> <a class="code" href="classHeartConfig.html#ad80730768d7bcee8bcda3b44315a172b">HeartConfig::GetUseMassLumpingForPrecond</a>()
<a name="l02899"></a>02899 {
<a name="l02900"></a>02900     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#ac92f76dda02e32251cb54ab8db4e4731">mUseMassLumpingForPrecond</a>;
<a name="l02901"></a>02901 }
<a name="l02902"></a>02902 
<a name="l02903"></a><a class="code" href="classHeartConfig.html#a67e90f1a2973f64e52353bde6c5ca0dd">02903</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a67e90f1a2973f64e52353bde6c5ca0dd">HeartConfig::SetUseReactionDiffusionOperatorSplitting</a>(<span class="keywordtype">bool</span> useOperatorSplitting)
<a name="l02904"></a>02904 {
<a name="l02905"></a>02905     <a class="code" href="classHeartConfig.html#ae42bb9c3f734dfaa2247de53cf3543a1">mUseReactionDiffusionOperatorSplitting</a> = useOperatorSplitting;
<a name="l02906"></a>02906 }
<a name="l02907"></a>02907 
<a name="l02908"></a><a class="code" href="classHeartConfig.html#aa4c07337945a4b2992a23d99162a50f3">02908</a> <span class="keywordtype">bool</span> <a class="code" href="classHeartConfig.html#aa4c07337945a4b2992a23d99162a50f3">HeartConfig::GetUseReactionDiffusionOperatorSplitting</a>()
<a name="l02909"></a>02909 {
<a name="l02910"></a>02910     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#ae42bb9c3f734dfaa2247de53cf3543a1">mUseReactionDiffusionOperatorSplitting</a>;
<a name="l02911"></a>02911 }
<a name="l02912"></a>02912 
<a name="l02913"></a><a class="code" href="classHeartConfig.html#a1c2e9fe97d37940788e7f815abf177d9">02913</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a1c2e9fe97d37940788e7f815abf177d9">HeartConfig::SetUseFixedNumberIterationsLinearSolver</a>(<span class="keywordtype">bool</span> useFixedNumberIterations, <span class="keywordtype">unsigned</span> evaluateNumItsEveryNSolves)
<a name="l02914"></a>02914 {
<a name="l02915"></a>02915     <a class="code" href="classHeartConfig.html#a2b62de1b5893819e228fa281b33bcb7c">mUseFixedNumberIterations</a> = useFixedNumberIterations;
<a name="l02916"></a>02916     <a class="code" href="classHeartConfig.html#a88ce4e48dfccc4028c6b8718314f4f55">mEvaluateNumItsEveryNSolves</a> = evaluateNumItsEveryNSolves;
<a name="l02917"></a>02917 }
<a name="l02918"></a>02918 
<a name="l02919"></a><a class="code" href="classHeartConfig.html#a3332318bea3eb41149090030ad38e309">02919</a> <span class="keywordtype">bool</span> <a class="code" href="classHeartConfig.html#a3332318bea3eb41149090030ad38e309">HeartConfig::GetUseFixedNumberIterationsLinearSolver</a>()
<a name="l02920"></a>02920 {
<a name="l02921"></a>02921     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a2b62de1b5893819e228fa281b33bcb7c">mUseFixedNumberIterations</a>;
<a name="l02922"></a>02922 }
<a name="l02923"></a>02923 
<a name="l02924"></a><a class="code" href="classHeartConfig.html#a82a57b9262a618cf827865d9ad2f1ca4">02924</a> <span class="keywordtype">unsigned</span> <a class="code" href="classHeartConfig.html#a82a57b9262a618cf827865d9ad2f1ca4">HeartConfig::GetEvaluateNumItsEveryNSolves</a>()
<a name="l02925"></a>02925 {
<a name="l02926"></a>02926     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a88ce4e48dfccc4028c6b8718314f4f55">mEvaluateNumItsEveryNSolves</a>;
<a name="l02927"></a>02927 }
<a name="l02928"></a>02928 
<a name="l02929"></a>02929 <span class="comment">//</span>
<a name="l02930"></a>02930 <span class="comment">// Purkinje methods</span>
<a name="l02931"></a>02931 <span class="comment">//</span>
<a name="l02932"></a>02932 
<a name="l02933"></a><a class="code" href="classHeartConfig.html#a1114f2fa865659f7db8045196ab0a85f">02933</a> <span class="keywordtype">bool</span> <a class="code" href="classHeartConfig.html#a1114f2fa865659f7db8045196ab0a85f">HeartConfig::HasPurkinje</a>()
<a name="l02934"></a>02934 {
<a name="l02935"></a>02935     <a class="code" href="classHeartConfig.html#aab7ea75d3f83c1202127db592d934532">CheckSimulationIsDefined</a>(<span class="stringliteral">&quot;Purkinje&quot;</span>);
<a name="l02936"></a>02936     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Simulation()-&gt;Purkinje().present();
<a name="l02937"></a>02937 }
<a name="l02938"></a>02938 
<a name="l02939"></a><a class="code" href="classHeartConfig.html#a97cbdd7d897362f4f821daa25fd804f4">02939</a> <span class="keywordtype">double</span> <a class="code" href="classHeartConfig.html#a97cbdd7d897362f4f821daa25fd804f4">HeartConfig::GetPurkinjeCapacitance</a>()
<a name="l02940"></a>02940 {
<a name="l02941"></a>02941     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().Purkinje().present(), <span class="stringliteral">&quot;Physiological/Purkinje&quot;</span>);
<a name="l02942"></a>02942     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().Purkinje()-&gt;Capacitance().present(),
<a name="l02943"></a>02943                  <span class="stringliteral">&quot;Physiological/Purkinje/Capacitance&quot;</span>);
<a name="l02944"></a>02944     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().Purkinje()-&gt;Capacitance().get();
<a name="l02945"></a>02945 }
<a name="l02946"></a>02946 
<a name="l02947"></a><a class="code" href="classHeartConfig.html#a423ba3ce70618cea0dd7e84be5e9b37e">02947</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a423ba3ce70618cea0dd7e84be5e9b37e">HeartConfig::SetPurkinjeCapacitance</a>(<span class="keywordtype">double</span> capacitance)
<a name="l02948"></a>02948 {
<a name="l02949"></a>02949     ENSURE_SECTION_PRESENT(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().Purkinje(), cp::purkinje_physiological_type);
<a name="l02950"></a>02950     XSD_CREATE_WITH_FIXED_ATTR1(cp::capacitance_type, purk_Cm, capacitance, <span class="stringliteral">&quot;uF/cm^2&quot;</span>);
<a name="l02951"></a>02951     <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().Purkinje()-&gt;Capacitance().set(purk_Cm);
<a name="l02952"></a>02952 }
<a name="l02953"></a>02953 
<a name="l02954"></a>02954 
<a name="l02955"></a><a class="code" href="classHeartConfig.html#a1f1482194324d15c3640553433de0876">02955</a> <span class="keywordtype">double</span> <a class="code" href="classHeartConfig.html#a1f1482194324d15c3640553433de0876">HeartConfig::GetPurkinjeSurfaceAreaToVolumeRatio</a>()
<a name="l02956"></a>02956 {
<a name="l02957"></a>02957     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().Purkinje().present(), <span class="stringliteral">&quot;Physiological/Purkinje&quot;</span>);
<a name="l02958"></a>02958     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().Purkinje()-&gt;SurfaceAreaToVolumeRatio().present(),
<a name="l02959"></a>02959                  <span class="stringliteral">&quot;Physiological/Purkinje/SurfaceAreaToVolumeRatio&quot;</span>);
<a name="l02960"></a>02960     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().Purkinje()-&gt;SurfaceAreaToVolumeRatio().get();
<a name="l02961"></a>02961 }
<a name="l02962"></a>02962 
<a name="l02963"></a><a class="code" href="classHeartConfig.html#a90b620e1effb5129fda81d839362b350">02963</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a90b620e1effb5129fda81d839362b350">HeartConfig::SetPurkinjeSurfaceAreaToVolumeRatio</a>(<span class="keywordtype">double</span> ratio)
<a name="l02964"></a>02964 {
<a name="l02965"></a>02965     ENSURE_SECTION_PRESENT(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().Purkinje(), cp::purkinje_physiological_type);
<a name="l02966"></a>02966     XSD_CREATE_WITH_FIXED_ATTR1(cp::inverse_length_type, purk_Am, ratio, <span class="stringliteral">&quot;1/cm&quot;</span>);
<a name="l02967"></a>02967     <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().Purkinje()-&gt;SurfaceAreaToVolumeRatio().set(purk_Am);
<a name="l02968"></a>02968 }
<a name="l02969"></a>02969 
<a name="l02970"></a><a class="code" href="classHeartConfig.html#a9aa42b672223ab649afb42986f2506b8">02970</a> <span class="keywordtype">double</span> <a class="code" href="classHeartConfig.html#a9aa42b672223ab649afb42986f2506b8">HeartConfig::GetPurkinjeConductivity</a>()
<a name="l02971"></a>02971 {
<a name="l02972"></a>02972     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().Purkinje().present(), <span class="stringliteral">&quot;Physiological/Purkinje&quot;</span>);
<a name="l02973"></a>02973     CHECK_EXISTS(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().Purkinje()-&gt;Conductivity().present(),
<a name="l02974"></a>02974             <span class="stringliteral">&quot;Physiological/Purkinje/Conductivity&quot;</span>);
<a name="l02975"></a>02975     <span class="keywordflow">return</span> <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().Purkinje()-&gt;Conductivity().get();
<a name="l02976"></a>02976 }
<a name="l02977"></a>02977 
<a name="l02978"></a><a class="code" href="classHeartConfig.html#ad7bc8d0fee39e71bb839c86731edeee4">02978</a> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#ad7bc8d0fee39e71bb839c86731edeee4">HeartConfig::SetPurkinjeConductivity</a>(<span class="keywordtype">double</span> conductivity)
<a name="l02979"></a>02979 {
<a name="l02980"></a>02980     ENSURE_SECTION_PRESENT(<a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().Purkinje(), cp::purkinje_physiological_type);
<a name="l02981"></a>02981     XSD_CREATE_WITH_FIXED_ATTR1(cp::conductivity_type, purkinje_conductivity, conductivity, <span class="stringliteral">&quot;mS/cm&quot;</span>);
<a name="l02982"></a>02982     <a class="code" href="classHeartConfig.html#a3e155f4ce1634137572805a259041c3c">mpParameters</a>-&gt;Physiological().Purkinje()-&gt;Conductivity().set(purkinje_conductivity);
<a name="l02983"></a>02983 }
<a name="l02984"></a>02984 
<a name="l02985"></a>02985 <span class="comment">/**********************************************************************</span>
<a name="l02986"></a>02986 <span class="comment"> *                                                                    *</span>
<a name="l02987"></a>02987 <span class="comment"> *                                                                    *</span>
<a name="l02988"></a>02988 <span class="comment"> *            Utility methods for reading/transforming XML            *</span>
<a name="l02989"></a>02989 <span class="comment"> *                                                                    *</span>
<a name="l02990"></a>02990 <span class="comment"> *                                                                    *</span>
<a name="l02991"></a>02991 <span class="comment"> **********************************************************************/</span>
<a name="l02992"></a>02992 
<a name="l02993"></a>02993 
<a name="l02994"></a><a class="code" href="classXmlTransforms.html#a0213cbf8bed42fa7e3236fdf4376bf64">02994</a> <span class="keywordtype">void</span> <a class="code" href="classXmlTransforms.html#a0213cbf8bed42fa7e3236fdf4376bf64">XmlTransforms::TransformArchiveDirectory</a>(xercesc::DOMDocument* pDocument,
<a name="l02995"></a>02995                                               xercesc::DOMElement* pRootElement)
<a name="l02996"></a>02996 {
<a name="l02997"></a>02997     <span class="keyword">using namespace </span>xercesc;
<a name="l02998"></a>02998     std::vector&lt;xercesc::DOMElement*&gt; elts = <a class="code" href="classXmlTools.html#a57cbd73759a3ed7dd07125c6e20158d3">XmlTools::FindElements</a>(
<a name="l02999"></a>02999         pRootElement,
<a name="l03000"></a>03000         <span class="stringliteral">&quot;ResumeSimulation/ArchiveDirectory&quot;</span>);
<a name="l03001"></a>03001     <span class="keywordflow">if</span> (elts.size() &gt; 0)
<a name="l03002"></a>03002     {
<a name="l03003"></a>03003         <span class="comment">// We have an ArchiveDirectory element, so add the relative_to=&#39;chaste_test_output&#39; attribute</span>
<a name="l03004"></a>03004         DOMElement* p_dir_elt = elts[0];
<a name="l03005"></a>03005         p_dir_elt-&gt;setAttribute(X(<span class="stringliteral">&quot;relative_to&quot;</span>), X(<span class="stringliteral">&quot;chaste_test_output&quot;</span>));
<a name="l03006"></a>03006     }
<a name="l03007"></a>03007 }
<a name="l03008"></a>03008 
<a name="l03009"></a><a class="code" href="classXmlTransforms.html#a1e5bd50d05c32cf8257cacbb2b650bbd">03009</a> <span class="keywordtype">void</span> <a class="code" href="classXmlTransforms.html#a1e5bd50d05c32cf8257cacbb2b650bbd">XmlTransforms::TransformIonicModelDefinitions</a>(xercesc::DOMDocument* pDocument,
<a name="l03010"></a>03010                                                    xercesc::DOMElement* pRootElement)
<a name="l03011"></a>03011 {
<a name="l03012"></a>03012     <span class="comment">// Default ionic model</span>
<a name="l03013"></a>03013     std::vector&lt;xercesc::DOMElement*&gt; p_elt_list = <a class="code" href="classXmlTools.html#a57cbd73759a3ed7dd07125c6e20158d3">XmlTools::FindElements</a>(
<a name="l03014"></a>03014         pRootElement,
<a name="l03015"></a>03015         <span class="stringliteral">&quot;Simulation/IonicModels/Default&quot;</span>);
<a name="l03016"></a>03016     <span class="keywordflow">if</span> (p_elt_list.size() &gt; 0)
<a name="l03017"></a>03017     {
<a name="l03018"></a>03018         assert(p_elt_list.size() == 1); <span class="comment">// Asserted by schema</span>
<a name="l03019"></a>03019         <a class="code" href="classXmlTools.html#ac1a9819d780ae39e68c297797fa25498">XmlTools::WrapContentInElement</a>(pDocument, p_elt_list[0], X(<span class="stringliteral">&quot;Hardcoded&quot;</span>));
<a name="l03020"></a>03020         <span class="comment">// Now do any region-specific definitions</span>
<a name="l03021"></a>03021         p_elt_list = <a class="code" href="classXmlTools.html#a57cbd73759a3ed7dd07125c6e20158d3">XmlTools::FindElements</a>(pRootElement, <span class="stringliteral">&quot;Simulation/IonicModels/Region/IonicModel&quot;</span>);
<a name="l03022"></a>03022         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0; i&lt;p_elt_list.size(); i++)
<a name="l03023"></a>03023         {
<a name="l03024"></a>03024             XmlTools::WrapContentInElement(pDocument, p_elt_list[i], X(<span class="stringliteral">&quot;Hardcoded&quot;</span>));
<a name="l03025"></a>03025         }
<a name="l03026"></a>03026     }
<a name="l03027"></a>03027 }
<a name="l03028"></a>03028 
<a name="l03029"></a><a class="code" href="classXmlTransforms.html#ab7c65c8fd2a2e9b07b70b7009df314ef">03029</a> <span class="keywordtype">void</span> <a class="code" href="classXmlTransforms.html#ab7c65c8fd2a2e9b07b70b7009df314ef">XmlTransforms::CheckForIluPreconditioner</a>(xercesc::DOMDocument* pDocument,
<a name="l03030"></a>03030                                               xercesc::DOMElement* pRootElement)
<a name="l03031"></a>03031 {
<a name="l03032"></a>03032     std::vector&lt;xercesc::DOMElement*&gt; p_elt_list = <a class="code" href="classXmlTools.html#a57cbd73759a3ed7dd07125c6e20158d3">XmlTools::FindElements</a>(
<a name="l03033"></a>03033         pRootElement,
<a name="l03034"></a>03034         <span class="stringliteral">&quot;Numerical/KSPPreconditioner&quot;</span>);
<a name="l03035"></a>03035     <span class="keywordflow">if</span> (p_elt_list.size() &gt; 0)
<a name="l03036"></a>03036     {
<a name="l03037"></a>03037         assert(p_elt_list.size() == 1); <span class="comment">// Asserted by schema</span>
<a name="l03038"></a>03038         std::string text_value = X2C(p_elt_list[0]-&gt;getTextContent());
<a name="l03039"></a>03039         <span class="keywordflow">if</span> (text_value == <span class="stringliteral">&quot;ilu&quot;</span>)
<a name="l03040"></a>03040         {
<a name="l03041"></a>03041             <a class="code" href="Exception_8hpp.html#aa49c727f91093a79c46ee6ecd83548bb">EXCEPTION</a>(<span class="stringliteral">&quot;PETSc does not have a parallel implementation of ilu, so we no longer allow it as an option.  Use bjacobi instead.&quot;</span>);
<a name="l03042"></a>03042         }
<a name="l03043"></a>03043     }
<a name="l03044"></a>03044 }
<a name="l03045"></a>03045 
<a name="l03046"></a><a class="code" href="classXmlTransforms.html#a66e900e4a1f476633d6abf749bad0987">03046</a> <span class="keywordtype">void</span> <a class="code" href="classXmlTransforms.html#a66e900e4a1f476633d6abf749bad0987">XmlTransforms::MoveConductivityHeterogeneities</a>(xercesc::DOMDocument* pDocument,
<a name="l03047"></a>03047                                                     xercesc::DOMElement* pRootElement)
<a name="l03048"></a>03048 {
<a name="l03049"></a>03049     std::vector&lt;xercesc::DOMElement*&gt; p_elt_list = <a class="code" href="classXmlTools.html#a57cbd73759a3ed7dd07125c6e20158d3">XmlTools::FindElements</a>(
<a name="l03050"></a>03050             pRootElement,
<a name="l03051"></a>03051             <span class="stringliteral">&quot;Simulation/ConductivityHeterogeneities&quot;</span>);
<a name="l03052"></a>03052     <span class="keywordflow">if</span> (p_elt_list.size() &gt; 0)
<a name="l03053"></a>03053     {
<a name="l03054"></a>03054         assert(p_elt_list.size() == 1); <span class="comment">// Asserted by schema</span>
<a name="l03055"></a>03055         xercesc::DOMNode* p_parent = p_elt_list[0]-&gt;getParentNode();
<a name="l03056"></a>03056         xercesc::DOMNode* p_child = p_parent-&gt;removeChild(p_elt_list[0]);
<a name="l03057"></a>03057         std::vector&lt;xercesc::DOMElement*&gt; p_phys_list = <a class="code" href="classXmlTools.html#a57cbd73759a3ed7dd07125c6e20158d3">XmlTools::FindElements</a>(pRootElement, <span class="stringliteral">&quot;Physiological&quot;</span>);
<a name="l03058"></a>03058         assert(p_phys_list.size() == 1); <span class="comment">// Asserted by schema</span>
<a name="l03059"></a>03059         p_phys_list[0]-&gt;appendChild(p_child);
<a name="l03060"></a>03060     }
<a name="l03061"></a>03061 }
<a name="l03062"></a>03062 
<a name="l03063"></a><a class="code" href="classXmlTransforms.html#a62b290bd956d1c9e9d013358e7a9daa6">03063</a> <span class="keywordtype">void</span> <a class="code" href="classXmlTransforms.html#a62b290bd956d1c9e9d013358e7a9daa6">XmlTransforms::SetDefaultVisualizer</a>(xercesc::DOMDocument* pDocument,
<a name="l03064"></a>03064                                          xercesc::DOMElement* pRootElement)
<a name="l03065"></a>03065 {
<a name="l03066"></a>03066     std::vector&lt;xercesc::DOMElement*&gt; p_sim_list = <a class="code" href="classXmlTools.html#a57cbd73759a3ed7dd07125c6e20158d3">XmlTools::FindElements</a>(pRootElement, <span class="stringliteral">&quot;Simulation&quot;</span>);
<a name="l03067"></a>03067     <span class="keywordflow">if</span> (p_sim_list.size() &gt; 0)
<a name="l03068"></a>03068     {
<a name="l03069"></a>03069         std::vector&lt;xercesc::DOMElement*&gt; p_viz_list = <a class="code" href="classXmlTools.html#a57cbd73759a3ed7dd07125c6e20158d3">XmlTools::FindElements</a>(p_sim_list[0], <span class="stringliteral">&quot;OutputVisualizer&quot;</span>);
<a name="l03070"></a>03070         <span class="keywordflow">if</span> (p_viz_list.empty())
<a name="l03071"></a>03071         {
<a name="l03072"></a>03072             <span class="comment">// Create the element and set meshalyzer (only) to on</span>
<a name="l03073"></a>03073             xercesc::DOMElement* p_viz_elt = pDocument-&gt;createElementNS(X(<span class="stringliteral">&quot;https://chaste.comlab.ox.ac.uk/nss/parameters/3_3&quot;</span>), X(<span class="stringliteral">&quot;OutputVisualizer&quot;</span>));
<a name="l03074"></a>03074             p_sim_list[0]-&gt;appendChild(p_viz_elt);
<a name="l03075"></a>03075             p_viz_elt-&gt;setAttribute(X(<span class="stringliteral">&quot;meshalyzer&quot;</span>), X(<span class="stringliteral">&quot;yes&quot;</span>));
<a name="l03076"></a>03076         }
<a name="l03077"></a>03077     }
<a name="l03078"></a>03078 }
<a name="l03079"></a>03079 
<a name="l03081"></a>03081 <span class="comment">// Explicit instantiation of the templated functions</span>
<a name="l03083"></a>03083 <span class="comment"></span><span class="preprocessor">#define COVERAGE_IGNORE //These methods are covered above with DIM=1,2,3 but the instantiations may fail spuriously</span>
<a name="l03084"></a>03084 <span class="preprocessor"></span>
<a name="l03088"></a>03088 <span class="keyword">template</span> <span class="keywordtype">void</span> HeartConfig::GetIonicModelRegions&lt;3u&gt;(std::vector&lt;boost::shared_ptr&lt;AbstractChasteRegion&lt;3u&gt; &gt; &gt;&amp; , std::vector&lt;cp::ionic_model_selection_type&gt;&amp;) <span class="keyword">const</span>;
<a name="l03089"></a>03089 <span class="keyword">template</span> <span class="keywordtype">void</span> HeartConfig::GetStimuli&lt;3u&gt;(std::vector&lt;boost::shared_ptr&lt;AbstractStimulusFunction&gt; &gt;&amp; , std::vector&lt;boost::shared_ptr&lt;AbstractChasteRegion&lt;3u&gt; &gt; &gt;&amp; ) <span class="keyword">const</span>;
<a name="l03090"></a>03090 <span class="keyword">template</span> <span class="keywordtype">void</span> HeartConfig::GetCellHeterogeneities&lt;3u&gt;(std::vector&lt;boost::shared_ptr&lt;AbstractChasteRegion&lt;3u&gt; &gt; &gt;&amp; ,std::vector&lt;double&gt;&amp; ,std::vector&lt;double&gt;&amp; ,std::vector&lt;double&gt;&amp; ,std::vector&lt;std::map&lt;std::string, double&gt; &gt;*) ;
<a name="l03091"></a>03091 <span class="keyword">template</span> <span class="keywordtype">void</span> HeartConfig::GetConductivityHeterogeneities&lt;3u&gt;(std::vector&lt;boost::shared_ptr&lt;AbstractChasteRegion&lt;3u&gt; &gt; &gt;&amp; ,std::vector&lt; c_vector&lt;double,3&gt; &gt;&amp; ,std::vector&lt; c_vector&lt;double,3&gt; &gt;&amp; ) <span class="keyword">const</span>;
<a name="l03092"></a>03092 
<a name="l03093"></a>03093 <span class="keyword">template</span> <span class="keywordtype">void</span> HeartConfig::GetIonicModelRegions&lt;2u&gt;(std::vector&lt;boost::shared_ptr&lt;AbstractChasteRegion&lt;2u&gt; &gt; &gt;&amp; , std::vector&lt;cp::ionic_model_selection_type&gt;&amp;) <span class="keyword">const</span>;
<a name="l03094"></a>03094 <span class="keyword">template</span> <span class="keywordtype">void</span> HeartConfig::GetStimuli&lt;2u&gt;(std::vector&lt;boost::shared_ptr&lt;AbstractStimulusFunction&gt; &gt;&amp; , std::vector&lt;boost::shared_ptr&lt;AbstractChasteRegion&lt;2u&gt; &gt; &gt;&amp; ) <span class="keyword">const</span>;
<a name="l03095"></a>03095 <span class="keyword">template</span> <span class="keywordtype">void</span> HeartConfig::GetCellHeterogeneities&lt;2u&gt;(std::vector&lt;boost::shared_ptr&lt;AbstractChasteRegion&lt;2u&gt; &gt; &gt;&amp; ,std::vector&lt;double&gt;&amp; ,std::vector&lt;double&gt;&amp; ,std::vector&lt;double&gt;&amp; ,std::vector&lt;std::map&lt;std::string, double&gt; &gt;*) ;
<a name="l03096"></a>03096 <span class="keyword">template</span> <span class="keywordtype">void</span> HeartConfig::GetConductivityHeterogeneities&lt;2u&gt;(std::vector&lt;boost::shared_ptr&lt;AbstractChasteRegion&lt;2u&gt; &gt; &gt;&amp; ,std::vector&lt; c_vector&lt;double,3&gt; &gt;&amp; ,std::vector&lt; c_vector&lt;double,3&gt; &gt;&amp; ) <span class="keyword">const</span>;
<a name="l03097"></a>03097 
<a name="l03098"></a>03098 <span class="keyword">template</span> <span class="keywordtype">void</span> HeartConfig::GetIonicModelRegions&lt;1u&gt;(std::vector&lt;boost::shared_ptr&lt;AbstractChasteRegion&lt;1u&gt; &gt; &gt;&amp; , std::vector&lt;cp::ionic_model_selection_type&gt;&amp;) <span class="keyword">const</span>;
<a name="l03099"></a>03099 <span class="keyword">template</span> <span class="keywordtype">void</span> HeartConfig::GetStimuli&lt;1u&gt;(std::vector&lt;boost::shared_ptr&lt;AbstractStimulusFunction&gt; &gt;&amp; , std::vector&lt;boost::shared_ptr&lt;AbstractChasteRegion&lt;1u&gt; &gt; &gt;&amp; ) <span class="keyword">const</span>;
<a name="l03100"></a>03100 <span class="keyword">template</span> <span class="keywordtype">void</span> HeartConfig::GetCellHeterogeneities&lt;1u&gt;(std::vector&lt;boost::shared_ptr&lt;AbstractChasteRegion&lt;1u&gt; &gt; &gt;&amp; ,std::vector&lt;double&gt;&amp; ,std::vector&lt;double&gt;&amp; ,std::vector&lt;double&gt;&amp; ,std::vector&lt;std::map&lt;std::string, double&gt; &gt;*);
<a name="l03101"></a>03101 <span class="keyword">template</span> <span class="keywordtype">void</span> HeartConfig::GetConductivityHeterogeneities&lt;1u&gt;(std::vector&lt;boost::shared_ptr&lt;AbstractChasteRegion&lt;1u&gt; &gt; &gt;&amp; ,std::vector&lt; c_vector&lt;double,3&gt; &gt;&amp; ,std::vector&lt; c_vector&lt;double,3&gt; &gt;&amp; ) <span class="keyword">const</span>;
<a name="l03102"></a>03102 
<a name="l03103"></a>03103 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a28e2c87ca9ef53288b40a12e724b01a5">HeartConfig::GetPseudoEcgElectrodePositions</a>(std::vector&lt;<a class="code" href="classChastePoint.html">ChastePoint&lt;1u&gt;</a> &gt;&amp; rPseudoEcgElectrodePositions) <span class="keyword">const</span>;
<a name="l03104"></a>03104 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a28e2c87ca9ef53288b40a12e724b01a5">HeartConfig::GetPseudoEcgElectrodePositions</a>(std::vector&lt;<a class="code" href="classChastePoint.html">ChastePoint&lt;2u&gt;</a> &gt;&amp; rPseudoEcgElectrodePositions) <span class="keyword">const</span>;
<a name="l03105"></a>03105 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a28e2c87ca9ef53288b40a12e724b01a5">HeartConfig::GetPseudoEcgElectrodePositions</a>(std::vector&lt;<a class="code" href="classChastePoint.html">ChastePoint&lt;3u&gt;</a> &gt;&amp; rPseudoEcgElectrodePositions) <span class="keyword">const</span>;
<a name="l03106"></a>03106 
<a name="l03107"></a>03107 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a31c997d4d91e1bb1cbb0177d29186cd8">HeartConfig::SetPseudoEcgElectrodePositions</a>(<span class="keyword">const</span> std::vector&lt;<a class="code" href="classChastePoint.html">ChastePoint&lt;1u&gt;</a> &gt;&amp; rPseudoEcgElectrodePositions);
<a name="l03108"></a>03108 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a31c997d4d91e1bb1cbb0177d29186cd8">HeartConfig::SetPseudoEcgElectrodePositions</a>(<span class="keyword">const</span> std::vector&lt;<a class="code" href="classChastePoint.html">ChastePoint&lt;2u&gt;</a> &gt;&amp; rPseudoEcgElectrodePositions);
<a name="l03109"></a>03109 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="classHeartConfig.html#a31c997d4d91e1bb1cbb0177d29186cd8">HeartConfig::SetPseudoEcgElectrodePositions</a>(<span class="keyword">const</span> std::vector&lt;<a class="code" href="classChastePoint.html">ChastePoint&lt;3u&gt;</a> &gt;&amp; rPseudoEcgElectrodePositions);
<a name="l03114"></a>03114 <span class="preprocessor">#undef COVERAGE_IGNORE //These methods are covered above with DIM=1,2,3 but the instantiations may fail spuriously</span>
<a name="l03115"></a>03115 <span class="preprocessor"></span>
<a name="l03116"></a>03116 
<a name="l03117"></a>03117 <span class="comment">// Serialization for Boost &gt;= 1.36</span>
<a name="l03118"></a>03118 <span class="preprocessor">#include &quot;<a class="code" href="SerializationExportWrapperForCpp_8hpp.html">SerializationExportWrapperForCpp.hpp</a>&quot;</span>
<a name="l03119"></a>03119 CHASTE_CLASS_EXPORT(<a class="code" href="classHeartConfig.html">HeartConfig</a>)
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.2 </small></address>
</body>
</html>
